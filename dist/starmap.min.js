var CanvasTexture=function(cb){var canvas=document.createElement("canvas");return"function"==typeof cb&&cb(canvas),PIXI.Texture.fromCanvas(canvas)},Particle=function(position,app){"use strict";var sprite=new PIXI.Sprite;sprite.blendMode=PIXI.BLEND_MODES.SCREEN,app.stage.addChild(sprite);var state={ALIVE:"ALIVE",DYING:"DYING",DEAD:"DEAD"},$scope={alpha:1,state:state.ALIVE,sprite:sprite,stage:app,radius:0,haloRadius:0,colour:{red:255,green:255,blue:255},acceleration:new Vector2,velocity:new Vector2(Math.random()-.5,Math.random()-.5),position:position,init:function(){$scope.radius=1.1*Math.random()+1,Math.random()>.7&&($scope.colour.red=Math.round(100*Math.random()+55),$scope.colour.green=Math.round(100*Math.random()+55),$scope.colour.blue=255),$scope.createTexture($scope.radius)},createTexture:function(radius){$scope.haloRadius=Math.ceil(20*radius),sprite.texture=new CanvasTexture(function(canvas){canvas.width=$scope.haloRadius,canvas.height=$scope.haloRadius;var ctx=canvas.getContext("2d");ctx.fillStyle="rgb("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+")",ctx.beginPath(),ctx.arc($scope.haloRadius/2,$scope.haloRadius/2,radius,0,360,!1),ctx.fill();var grd=ctx.createRadialGradient($scope.haloRadius/2,$scope.haloRadius/2,radius,$scope.haloRadius/2,$scope.haloRadius/2,Math.ceil($scope.haloRadius));grd.addColorStop(0,"rgba("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+",0.05)"),grd.addColorStop(.3,"rgba("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+",0)"),ctx.fillStyle=grd,ctx.beginPath(),ctx.arc($scope.haloRadius/2,$scope.haloRadius/2,$scope.haloRadius,0,360,!1)})},die:function(){$scope.state=state.DYING},tick:function(){if($scope.state!=state.DYING)sprite.alpha=.4*Math.random()+.6,$scope.acceleration.set(Math.random()-.5,Math.random()-.5).scale(app.maxSpeed),$scope.acceleration.clampAbs(app.maxSpeed),$scope.velocity.add($scope.acceleration,.1),($scope.position.x+$scope.velocity.x>window.innerWidth||$scope.position.x+$scope.velocity.x<1)&&($scope.velocity.x*=-.9,$scope.acceleration.x*=-.9),($scope.position.y+$scope.velocity.y>window.innerHeight||$scope.position.y+$scope.velocity.y<1)&&($scope.velocity.y*=-.9,$scope.acceleration.y*=-.9),$scope.velocity.clampAbs(app.maxSpeed),$scope.position.add($scope.velocity,.1),sprite.position.x=$scope.position.x-$scope.haloRadius/2,sprite.position.y=$scope.position.y-$scope.haloRadius/2;else if($scope.alpha-=.01,sprite.alpha=$scope.alpha,$scope.alpha<=0)return void($scope.state=state.DEAD)}};return $scope.init(),$scope},StarMap=function(width,height,maxStars){"use strict";var threshold=(width+height)/2/20,maxLines=7*maxStars,renderer=PIXI.autoDetectRenderer(width,height,{backgroundColor:1443889});document.body.appendChild(renderer.view);var stage=new PIXI.Container,joinLines=new PIXI.Graphics;joinLines.blendMode=PIXI.BLEND_MODES.ADD;var counter=$('<span class="counter"></span>').appendTo(document.body),backgroundTexture=new CanvasTexture(function(canvas){canvas.width=width,canvas.height=height;var ctx=canvas.getContext("2d"),grd=ctx.createRadialGradient(width/2,height/2,1,width/2,height/2,height);grd.addColorStop(0,"rgb(22,8,49)"),grd.addColorStop(.4,"rgb(22,8,49)"),grd.addColorStop(.6,"rgb(12,7,24)"),grd.addColorStop(1,"rgb(0,0,0)"),ctx.fillStyle=grd,ctx.fillRect(0,0,width,height)}),renderTexture=new PIXI.RenderTexture(renderer,width,height),renderTexture2=new PIXI.RenderTexture(renderer,width,height),backgroundSprite=new PIXI.Sprite(backgroundTexture),shadowSprite=new PIXI.Sprite(renderTexture),convolutionFilter=new PIXI.filters.ConvolutionFilter([.1,.4,.1,.4,0,.4,.1,.4,.1],width,height);shadowSprite.alpha=.41,shadowSprite.filters=[convolutionFilter],stage.addChild(backgroundSprite);var lineCount,joinCount,thresholdSquare=Math.pow(threshold,2),mouseThreshold=10*threshold,mouseThresholdSquare=10*thresholdSquare,$scope={maxSpeed:10,mouse:new Vector2,width:width,height:height,stage:stage,joinLines:joinLines,nodes:[],deadNodes:[],init:function(){for(var x=0;maxStars>x;x++)$scope.addStar(new Vector2(Math.random()*width,Math.random()*height),$scope);$scope.mouse.active=!1,stage.addChild(joinLines),stage.addChild(shadowSprite)},addStar:function(position){var p=new Particle(position,$scope);$scope.addNode(p),$scope.nodes.length>maxStars&&$scope.killNode()},addNode:function(node){$scope.nodes.push(node)},killNode:function(){var dead=$scope.nodes.shift();$scope.deadNodes.push(dead),dead.die()},tick:function(){var distance;counter.html($scope.nodes.length+$scope.deadNodes.length),$scope.nodes.length>maxStars&&$scope.killNode(),lineCount=0,requestAnimationFrame($scope.tick),joinLines.clear(),$scope.nodes.forEach(function(node,i){if(node.tick(),maxLines>lineCount&&(joinCount=0,$scope.nodes.slice(i).forEach(function(joinNode){if(!(lineCount>maxLines||joinCount>12)){var d2=joinNode.position.distanceSquare(node.position);if(thresholdSquare>d2){lineCount++,joinCount++,distance=Math.sqrt(d2);var alpha=(threshold-distance)/threshold*.4+.05*Math.random();joinLines.lineStyle(alpha*(node.radius+joinNode.radius)*3,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo(joinNode.position.x,joinNode.position.y)}}})),$scope.mouse.active){var mDist=node.position.distanceSquare($scope.mouse);if(mouseThresholdSquare>mDist){distance=Math.sqrt(mDist);var alpha=(mouseThreshold-distance)/mouseThreshold*.4+.05*Math.random();joinLines.lineStyle(1,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo($scope.mouse.x,$scope.mouse.y)}}}),$scope.deadNodes.forEach(function(node,i){node.tick(),"DEAD"==node.state&&(stage.removeChild(node.sprite),$scope.deadNodes.splice($scope.deadNodes.indexOf(node),1))}),backgroundSprite.alpha=0,joinLines.alpha=.1,renderTexture2.render($scope.stage,null,!0),joinLines.alpha=1,backgroundSprite.alpha=1;var temp=renderTexture;renderTexture=renderTexture2,renderTexture2=temp,shadowSprite.texture=renderTexture,renderer.render($scope.stage)}};return $scope.init(),$scope},Vector2=function(x,y){"use strict";x||(x=0),y||(y=0);var $scope={x:x,y:y,add:function(vector,scale){return scale=scale||1,$scope.x+=vector.x*scale,$scope.y+=vector.y*scale,$scope},set:function(x,y){return $scope.x=x,$scope.y=y,$scope},scale:function(multiplier){return $scope.x*=multiplier,$scope.y*=multiplier,$scope},clamp:function(min,max){return $scope.x=Math.min(Math.max($scope.x,min),max),$scope.y=Math.min(Math.max($scope.y,min),max),$scope},clampAbs:function(val){return $scope.clamp(-val,val),$scope},distance:function(vector){return Math.sqrt($scope.distanceSquare(vector))},distanceSquare:function(vector){var dX=Math.pow(vector.x-$scope.x,2),dY=Math.pow(vector.y-$scope.y,2);return dX+dY}};return $scope};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhbnZhc1RleHR1cmUuanMiLCJQYXJ0aWNsZS5qcyIsIlN0YXJNYXAuanMiLCJWZWN0b3IyLmpzIl0sIm5hbWVzIjpbIkNhbnZhc1RleHR1cmUiLCJjYiIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsIlBJWEkiLCJUZXh0dXJlIiwiZnJvbUNhbnZhcyIsIlBhcnRpY2xlIiwicG9zaXRpb24iLCJhcHAiLCJzcHJpdGUiLCJTcHJpdGUiLCJibGVuZE1vZGUiLCJCTEVORF9NT0RFUyIsIlNDUkVFTiIsInN0YWdlIiwiYWRkQ2hpbGQiLCJzdGF0ZSIsIkFMSVZFIiwiRFlJTkciLCJERUFEIiwiJHNjb3BlIiwiYWxwaGEiLCJyYWRpdXMiLCJoYWxvUmFkaXVzIiwiY29sb3VyIiwicmVkIiwiZ3JlZW4iLCJibHVlIiwiYWNjZWxlcmF0aW9uIiwiVmVjdG9yMiIsInZlbG9jaXR5IiwiTWF0aCIsInJhbmRvbSIsImluaXQiLCJyb3VuZCIsImNyZWF0ZVRleHR1cmUiLCJjZWlsIiwidGV4dHVyZSIsIndpZHRoIiwiaGVpZ2h0IiwiY3R4IiwiZ2V0Q29udGV4dCIsImZpbGxTdHlsZSIsImJlZ2luUGF0aCIsImFyYyIsImZpbGwiLCJncmQiLCJjcmVhdGVSYWRpYWxHcmFkaWVudCIsImFkZENvbG9yU3RvcCIsImRpZSIsInRpY2siLCJzZXQiLCJzY2FsZSIsIm1heFNwZWVkIiwiY2xhbXBBYnMiLCJhZGQiLCJ4Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsInkiLCJpbm5lckhlaWdodCIsIlN0YXJNYXAiLCJtYXhTdGFycyIsInRocmVzaG9sZCIsIm1heExpbmVzIiwicmVuZGVyZXIiLCJhdXRvRGV0ZWN0UmVuZGVyZXIiLCJiYWNrZ3JvdW5kQ29sb3IiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJ2aWV3IiwiQ29udGFpbmVyIiwiam9pbkxpbmVzIiwiR3JhcGhpY3MiLCJBREQiLCJjb3VudGVyIiwiJCIsImFwcGVuZFRvIiwiYmFja2dyb3VuZFRleHR1cmUiLCJmaWxsUmVjdCIsInJlbmRlclRleHR1cmUiLCJSZW5kZXJUZXh0dXJlIiwicmVuZGVyVGV4dHVyZTIiLCJiYWNrZ3JvdW5kU3ByaXRlIiwic2hhZG93U3ByaXRlIiwiY29udm9sdXRpb25GaWx0ZXIiLCJmaWx0ZXJzIiwiQ29udm9sdXRpb25GaWx0ZXIiLCJsaW5lQ291bnQiLCJqb2luQ291bnQiLCJ0aHJlc2hvbGRTcXVhcmUiLCJwb3ciLCJtb3VzZVRocmVzaG9sZCIsIm1vdXNlVGhyZXNob2xkU3F1YXJlIiwibW91c2UiLCJub2RlcyIsImRlYWROb2RlcyIsImFkZFN0YXIiLCJhY3RpdmUiLCJwIiwiYWRkTm9kZSIsImxlbmd0aCIsImtpbGxOb2RlIiwibm9kZSIsInB1c2giLCJkZWFkIiwic2hpZnQiLCJkaXN0YW5jZSIsImh0bWwiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjbGVhciIsImZvckVhY2giLCJpIiwic2xpY2UiLCJqb2luTm9kZSIsImQyIiwiZGlzdGFuY2VTcXVhcmUiLCJzcXJ0IiwibGluZVN0eWxlIiwibW92ZVRvIiwibGluZVRvIiwibURpc3QiLCJyZW1vdmVDaGlsZCIsInNwbGljZSIsImluZGV4T2YiLCJyZW5kZXIiLCJ0ZW1wIiwidmVjdG9yIiwibXVsdGlwbGllciIsImNsYW1wIiwibWluIiwibWF4IiwidmFsIiwiZFgiLCJkWSJdLCJtYXBwaW5ncyI6IkFBT0EsR0FBQUEsZUFBQSxTQUFBQyxJQUNBLEdBQUFDLFFBQUFDLFNBQUFDLGNBQUEsU0FFQSxPQURBLGtCQUFBSCxLQUFBQSxHQUFBQyxRQUNBRyxLQUFBQyxRQUFBQyxXQUFBTCxTQ0xBTSxTQUFBLFNBQUFDLFNBQUFDLEtBQ0EsWUFFQSxJQUFBQyxRQUFBLEdBQUFOLE1BQUFPLE1BRUFELFFBQUFFLFVBQUFSLEtBQUFTLFlBQUFDLE9BQ0FMLElBQUFNLE1BQUFDLFNBQUFOLE9BRUEsSUFBQU8sUUFDQUMsTUFBQSxRQUNBQyxNQUFBLFFBQ0FDLEtBQUEsUUFJQUMsUUFDQUMsTUFBQSxFQUNBTCxNQUFB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QTVCLEtBQUFtRyxJQUFBbkcsS0FBQW9HLElBQUEvRyxPQUFBdUMsRUFBQXVFLEtBQUFDLEtBQ0EvRyxRQUVBa0MsU0FBQSxTQUFBOEUsS0FFQSxNQURBaEgsUUFBQTZHLE9BQUFHLElBQUFBLEtBQ0FoSCxRQUVBdUYsU0FBQSxTQUFBb0IsUUFDQSxNQUFBaEcsTUFBQXNGLEtBQUFqRyxPQUFBZ0csZUFBQVcsVUFFQVgsZUFBQSxTQUFBVyxRQUNBLEdBQUFNLElBQUF0RyxLQUFBNEQsSUFBQW9DLE9BQUF2RSxFQUFBcEMsT0FBQW9DLEVBQUEsR0FDQThFLEdBQUF2RyxLQUFBNEQsSUFBQW9DLE9BQUFwRSxFQUFBdkMsT0FBQXVDLEVBQUEsRUFDQSxPQUFBMEUsSUFBQUMsSUFJQSxPQUFBbEgiLCJmaWxlIjoic3Rhcm1hcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqXG4gKiBAcGFyYW0gY2JcbiAqIEByZXR1cm5zIHtQSVhJLkJhc2VUZXh0dXJlfFBJWEkuVGV4dHVyZX1cbiAqIEBjb25zdHJ1Y3RvclxuICogQGF1dGhvciBBZGFtIEJlbnNvbiA8YWRhbUBwcmVjYXJpb3VzcGFudGhlci5uZXQ+XG4gKi9cbnZhciBDYW52YXNUZXh0dXJlID0gZnVuY3Rpb24gKGNiKSB7XG4gICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgIGlmICh0eXBlb2YgY2IgPT0gJ2Z1bmN0aW9uJykgY2IoY2FudmFzKTtcbiAgICByZXR1cm4gUElYSS5UZXh0dXJlLmZyb21DYW52YXMoY2FudmFzKTtcbn07IiwiLyoqXG4gKlxuICogQGF1dGhvciBBZGFtIEJlbnNvbiA8YWRhbUBwcmVjYXJpb3VzcGFudGhlci5uZXQ+XG4gKi9cblxudmFyIFBhcnRpY2xlID0gZnVuY3Rpb24gKHBvc2l0aW9uLCBhcHApIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgc3ByaXRlID0gbmV3IFBJWEkuU3ByaXRlKCk7XG5cbiAgICBzcHJpdGUuYmxlbmRNb2RlID0gUElYSS5CTEVORF9NT0RFUy5TQ1JFRU47XG4gICAgYXBwLnN0YWdlLmFkZENoaWxkKHNwcml0ZSk7XG5cbiAgICB2YXIgc3RhdGUgPSB7XG4gICAgICAgIEFMSVZFOiBcIkFMSVZFXCIsXG4gICAgICAgIERZSU5HOiBcIkRZSU5HXCIsXG4gICAgICAgIERFQUQ6IFwiREVBRFwiXG4gICAgfTtcblxuICAgIC8vYXBwLnN0YWdlLmFkZENoaWxkKGpvaW5MaW5lcyk7XG4gICAgdmFyICRzY29wZSA9IHtcbiAgICAgICAgYWxwaGE6IDEsXG4gICAgICAgIHN0YXRlOiBzdGF0ZS5BTElWRSxcbiAgICAgICAgc3ByaXRlOiBzcHJpdGUsXG4gICAgICAgIHN0YWdlOiBhcHAsXG4gICAgICAgIHJhZGl1czogMCxcbiAgICAgICAgaGFsb1JhZGl1czogMCxcbiAgICAgICAgY29sb3VyOiB7XG4gICAgICAgICAgICByZWQ6IDI1NSxcbiAgICAgICAgICAgIGdyZWVuOiAyNTUsXG4gICAgICAgICAgICBibHVlOiAyNTVcbiAgICAgICAgfSxcbiAgICAgICAgYWNjZWxlcmF0aW9uOiBuZXcgVmVjdG9yMigpLFxuICAgICAgICB2ZWxvY2l0eTogbmV3IFZlY3RvcjIoTWF0aC5yYW5kb20oKSAtIDAuNSwgTWF0aC5yYW5kb20oKSAtIDAuNSksXG4gICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLnJhZGl1cyA9IE1hdGgucmFuZG9tKCkgKiAxLjEgKyAxO1xuICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPiAwLjcpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29sb3VyLnJlZCA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDEwMCArIDU1KTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29sb3VyLmdyZWVuID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMTAwICsgNTUpO1xuICAgICAgICAgICAgICAgICRzY29wZS5jb2xvdXIuYmx1ZSA9IDI1NTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRzY29wZS5jcmVhdGVUZXh0dXJlKCRzY29wZS5yYWRpdXMpO1xuICAgICAgICB9LFxuICAgICAgICBjcmVhdGVUZXh0dXJlOiBmdW5jdGlvbiAocmFkaXVzKSB7XG4gICAgICAgICAgICAkc2NvcGUuaGFsb1JhZGl1cyA9IE1hdGguY2VpbChyYWRpdXMgKiAyMCk7XG4gICAgICAgICAgICBzcHJpdGUudGV4dHVyZSA9IG5ldyBDYW52YXNUZXh0dXJlKGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSAkc2NvcGUuaGFsb1JhZGl1cztcbiAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gJHNjb3BlLmhhbG9SYWRpdXM7XG4gICAgICAgICAgICAgICAgLy9Db3JlXG4gICAgICAgICAgICAgICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiKCcgKyAkc2NvcGUuY29sb3VyLnJlZCArICcsJyArICRzY29wZS5jb2xvdXIuZ3JlZW4gKyAnLCcgKyAkc2NvcGUuY29sb3VyLmJsdWUgKyAnKSc7XG4gICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgICAgIGN0eC5hcmMoJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCAkc2NvcGUuaGFsb1JhZGl1cyAvIDIsIHJhZGl1cywgMCwgMzYwLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgY3R4LmZpbGwoKTtcbiAgICAgICAgICAgICAgICAvL0hhbG9cbiAgICAgICAgICAgICAgICB2YXIgZ3JkID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KCRzY29wZS5oYWxvUmFkaXVzIC8gMiwgJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCByYWRpdXMsICRzY29wZS5oYWxvUmFkaXVzIC8gMiwgJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCBNYXRoLmNlaWwoJHNjb3BlLmhhbG9SYWRpdXMpKTtcbiAgICAgICAgICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAsICdyZ2JhKCcgKyAkc2NvcGUuY29sb3VyLnJlZCArICcsJyArICRzY29wZS5jb2xvdXIuZ3JlZW4gKyAnLCcgKyAkc2NvcGUuY29sb3VyLmJsdWUgKyAnLCcgKyAwLjA1ICsgJyknKTtcbiAgICAgICAgICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAuMywgJ3JnYmEoJyArICRzY29wZS5jb2xvdXIucmVkICsgJywnICsgJHNjb3BlLmNvbG91ci5ncmVlbiArICcsJyArICRzY29wZS5jb2xvdXIuYmx1ZSArICcsMCknKTtcblxuICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmQ7XG4gICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgICAgIGN0eC5hcmMoJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCAkc2NvcGUuaGFsb1JhZGl1cyAvIDIsICRzY29wZS5oYWxvUmFkaXVzLCAwLCAzNjAsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAvL2N0eC5maWxsKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgZGllOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvL1RyaWdnZXIgZmFkZVxuICAgICAgICAgICAgJHNjb3BlLnN0YXRlID0gc3RhdGUuRFlJTkc7XG4gICAgICAgIH0sXG4gICAgICAgIHRpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuc3RhdGUgPT0gc3RhdGUuRFlJTkcpIHtcbiAgICAgICAgICAgICAgICAvL0R5aW5nXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFscGhhIC09IDAuMDE7XG4gICAgICAgICAgICAgICAgc3ByaXRlLmFscGhhID0gJHNjb3BlLmFscGhhO1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYWxwaGEgPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdGUgPSBzdGF0ZS5ERUFEO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL1R3aW5rbGVcbiAgICAgICAgICAgICAgICBzcHJpdGUuYWxwaGEgPSBNYXRoLnJhbmRvbSgpICogMC40ICsgMC42O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9Nb3ZlXG4gICAgICAgICAgICAkc2NvcGUuYWNjZWxlcmF0aW9uLnNldChNYXRoLnJhbmRvbSgpIC0gMC41LCBNYXRoLnJhbmRvbSgpIC0gMC41KS5zY2FsZShhcHAubWF4U3BlZWQpO1xuICAgICAgICAgICAgJHNjb3BlLmFjY2VsZXJhdGlvbi5jbGFtcEFicyhhcHAubWF4U3BlZWQpO1xuXG4gICAgICAgICAgICAkc2NvcGUudmVsb2NpdHkuYWRkKCRzY29wZS5hY2NlbGVyYXRpb24sIDAuMSk7XG5cbiAgICAgICAgICAgIGlmICgkc2NvcGUucG9zaXRpb24ueCArICRzY29wZS52ZWxvY2l0eS54ID4gd2luZG93LmlubmVyV2lkdGggfHwgJHNjb3BlLnBvc2l0aW9uLnggKyAkc2NvcGUudmVsb2NpdHkueCA8IDEpIHtcbiAgICAgICAgICAgICAgICAvL0JvdW5jZSBYXG4gICAgICAgICAgICAgICAgJHNjb3BlLnZlbG9jaXR5LnggKj0gLTAuOTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWNjZWxlcmF0aW9uLnggKj0gLTAuOTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCRzY29wZS5wb3NpdGlvbi55ICsgJHNjb3BlLnZlbG9jaXR5LnkgPiB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgJHNjb3BlLnBvc2l0aW9uLnkgKyAkc2NvcGUudmVsb2NpdHkueSA8IDEpIHtcbiAgICAgICAgICAgICAgICAvL0JvdW5jZSBZXG4gICAgICAgICAgICAgICAgJHNjb3BlLnZlbG9jaXR5LnkgKj0gLTAuOTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWNjZWxlcmF0aW9uLnkgKj0gLTAuOTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRzY29wZS52ZWxvY2l0eS5jbGFtcEFicyhhcHAubWF4U3BlZWQpO1xuICAgICAgICAgICAgJHNjb3BlLnBvc2l0aW9uLmFkZCgkc2NvcGUudmVsb2NpdHksIDAuMSk7XG4gICAgICAgICAgICBzcHJpdGUucG9zaXRpb24ueCA9ICRzY29wZS5wb3NpdGlvbi54IC0gKCRzY29wZS5oYWxvUmFkaXVzIC8gMik7XG4gICAgICAgICAgICBzcHJpdGUucG9zaXRpb24ueSA9ICRzY29wZS5wb3NpdGlvbi55IC0gKCRzY29wZS5oYWxvUmFkaXVzIC8gMik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLmluaXQoKTtcbiAgICByZXR1cm4gJHNjb3BlO1xufTsiLCIvKipcbiAqXG4gKiBAYXV0aG9yIEFkYW0gQmVuc29uIDxhZGFtQHByZWNhcmlvdXNwYW50aGVyLm5ldD5cbiAqL1xuXG52YXIgU3Rhck1hcCA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCBtYXhTdGFycykge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgdGhyZXNob2xkID0gKCh3aWR0aCArIGhlaWdodCkgLyAyICkgLyAyMDtcbiAgICB2YXIgbWF4TGluZXMgPSBtYXhTdGFycyAqIDc7XG4gICAgdmFyIHJlbmRlcmVyID0gUElYSS5hdXRvRGV0ZWN0UmVuZGVyZXIod2lkdGgsIGhlaWdodCwge2JhY2tncm91bmRDb2xvcjogMHgxNjA4MzF9KTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHJlbmRlcmVyLnZpZXcpO1xuICAgIHZhciBzdGFnZSA9IG5ldyBQSVhJLkNvbnRhaW5lcigpO1xuICAgIHZhciBqb2luTGluZXMgPSBuZXcgUElYSS5HcmFwaGljcygpO1xuICAgIGpvaW5MaW5lcy5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLkFERDtcbiAgICB2YXIgY291bnRlciA9ICQoJzxzcGFuIGNsYXNzPVwiY291bnRlclwiPjwvc3Bhbj4nKS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KTtcblxuICAgIHZhciBiYWNrZ3JvdW5kVGV4dHVyZSA9IG5ldyBDYW52YXNUZXh0dXJlKGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgdmFyIGdyZCA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudCh3aWR0aCAvIDIsIGhlaWdodCAvIDIsIDEsIHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgaGVpZ2h0KTtcbiAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLCAncmdiKDIyLDgsNDkpJyk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMC40LCAncmdiKDIyLDgsNDkpJyk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMC42LCAncmdiKDEyLDcsMjQpJyk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMSwgJ3JnYigwLDAsMCknKTtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGdyZDtcbiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgIH0pO1xuXG4gICAgdmFyIHJlbmRlclRleHR1cmUgPSBuZXcgUElYSS5SZW5kZXJUZXh0dXJlKHJlbmRlcmVyLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB2YXIgcmVuZGVyVGV4dHVyZTIgPSBuZXcgUElYSS5SZW5kZXJUZXh0dXJlKHJlbmRlcmVyLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgIHZhciBiYWNrZ3JvdW5kU3ByaXRlID0gbmV3IFBJWEkuU3ByaXRlKGJhY2tncm91bmRUZXh0dXJlKTtcbiAgICB2YXIgc2hhZG93U3ByaXRlID0gbmV3IFBJWEkuU3ByaXRlKHJlbmRlclRleHR1cmUpO1xuICAgIHZhciBjb252b2x1dGlvbkZpbHRlciA9IG5ldyBQSVhJLmZpbHRlcnMuQ29udm9sdXRpb25GaWx0ZXIoW1xuICAgICAgICAwLjEsIDAuNCwgMC4xLFxuICAgICAgICAwLjQsIDAuMCwgMC40LFxuICAgICAgICAwLjEsIDAuNCwgMC4xXG4gICAgXSwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICAvL3NoYWRvd1Nwcml0ZS5hbHBoYSA9IDAuNDk7XG4gICAgc2hhZG93U3ByaXRlLmFscGhhID0gMC40MTtcbiAgICAvL3NoYWRvd1Nwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLlNPRlRfTElHSFQ7XG5cbiAgICAvKiB2YXIgZmlsdGVyID0gbmV3IFBJWEkuZmlsdGVycy5Db252b2x1dGlvbkZpbHRlcihbXG4gICAgIDAuMSwwLjEsMC4xLFxuICAgICAwLjEsMC4yLDAuMSxcbiAgICAgMC4xLDAuMSwwLjFcbiAgICAgXSx3aWR0aCxoZWlnaHQpOyovXG4gICAgc2hhZG93U3ByaXRlLmZpbHRlcnMgPSBbY29udm9sdXRpb25GaWx0ZXJdO1xuICAgIHN0YWdlLmFkZENoaWxkKGJhY2tncm91bmRTcHJpdGUpO1xuXG4gICAgdmFyIGxpbmVDb3VudCxqb2luQ291bnQ7XG4gICAgdmFyIHRocmVzaG9sZFNxdWFyZSA9IE1hdGgucG93KHRocmVzaG9sZCwgMik7XG4gICAgdmFyIG1vdXNlVGhyZXNob2xkID0gdGhyZXNob2xkICogMTA7XG4gICAgdmFyIG1vdXNlVGhyZXNob2xkU3F1YXJlID0gdGhyZXNob2xkU3F1YXJlICogMTA7XG4gICAgdmFyICRzY29wZSA9IHtcbiAgICAgICAgbWF4U3BlZWQ6IDEwLFxuICAgICAgICBtb3VzZTogbmV3IFZlY3RvcjIoKSxcbiAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgc3RhZ2U6IHN0YWdlLFxuICAgICAgICBqb2luTGluZXM6IGpvaW5MaW5lcyxcbiAgICAgICAgbm9kZXM6IFtdLFxuICAgICAgICBkZWFkTm9kZXM6IFtdLFxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heFN0YXJzOyB4KyspIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkU3RhcihuZXcgVmVjdG9yMihNYXRoLnJhbmRvbSgpICogd2lkdGgsIE1hdGgucmFuZG9tKCkgKiBoZWlnaHQpLCAkc2NvcGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHNjb3BlLm1vdXNlLmFjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICBzdGFnZS5hZGRDaGlsZChqb2luTGluZXMpO1xuICAgICAgICAgICAgc3RhZ2UuYWRkQ2hpbGQoc2hhZG93U3ByaXRlKTtcbiAgICAgICAgfSxcbiAgICAgICAgYWRkU3RhcjogZnVuY3Rpb24gKHBvc2l0aW9uKSB7XG4gICAgICAgICAgICB2YXIgcCA9IG5ldyBQYXJ0aWNsZShwb3NpdGlvbiwgJHNjb3BlKTtcbiAgICAgICAgICAgICRzY29wZS5hZGROb2RlKHApO1xuICAgICAgICAgICAgaWYgKCRzY29wZS5ub2Rlcy5sZW5ndGggPiBtYXhTdGFycykge1xuICAgICAgICAgICAgICAgICRzY29wZS5raWxsTm9kZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBhZGROb2RlOiBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgJHNjb3BlLm5vZGVzLnB1c2gobm9kZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGtpbGxOb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGVhZCA9ICRzY29wZS5ub2Rlcy5zaGlmdCgpO1xuICAgICAgICAgICAgJHNjb3BlLmRlYWROb2Rlcy5wdXNoKGRlYWQpO1xuICAgICAgICAgICAgZGVhZC5kaWUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgdGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGRpc3RhbmNlO1xuICAgICAgICAgICAgY291bnRlci5odG1sKCRzY29wZS5ub2Rlcy5sZW5ndGggKyAkc2NvcGUuZGVhZE5vZGVzLmxlbmd0aCk7XG4gICAgICAgICAgICAvL0N1bGwgdG9vIG1hbnkgc3RhcnNcbiAgICAgICAgICAgIGlmICgkc2NvcGUubm9kZXMubGVuZ3RoID4gbWF4U3RhcnMpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUua2lsbE5vZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGluZUNvdW50ID0gMDtcbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgkc2NvcGUudGljayk7XG4gICAgICAgICAgICBqb2luTGluZXMuY2xlYXIoKTtcbiAgICAgICAgICAgICRzY29wZS5ub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlLCBpKSB7XG4gICAgICAgICAgICAgICAgLy9QYXJ0aWNsZXNcbiAgICAgICAgICAgICAgICBub2RlLnRpY2soKTtcbiAgICAgICAgICAgICAgICBpZiAobGluZUNvdW50IDwgbWF4TGluZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgam9pbkNvdW50PTA7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5ub2Rlcy5zbGljZShpKS5mb3JFYWNoKGZ1bmN0aW9uIChqb2luTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmVDb3VudCA+IG1heExpbmVzIHx8IGpvaW5Db3VudCA+IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQyID0gam9pbk5vZGUucG9zaXRpb24uZGlzdGFuY2VTcXVhcmUobm9kZS5wb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZDIgPCB0aHJlc2hvbGRTcXVhcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2luQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IE1hdGguc3FydChkMik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhID0gKCgodGhyZXNob2xkIC0gZGlzdGFuY2UpIC8gdGhyZXNob2xkKSAqIDAuNCkgKyAoTWF0aC5yYW5kb20oKSAqIDAuMDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5saW5lU3R5bGUoYWxwaGEgKiAobm9kZS5yYWRpdXMgKyBqb2luTm9kZS5yYWRpdXMpICogMywgMHgwMGRiZmYsIGFscGhhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubW92ZVRvKG5vZGUucG9zaXRpb24ueCwgbm9kZS5wb3NpdGlvbi55KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubGluZVRvKGpvaW5Ob2RlLnBvc2l0aW9uLngsIGpvaW5Ob2RlLnBvc2l0aW9uLnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvL01vdXNlIGFjdGl2ZVxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUubW91c2UuYWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtRGlzdCA9IG5vZGUucG9zaXRpb24uZGlzdGFuY2VTcXVhcmUoJHNjb3BlLm1vdXNlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1EaXN0IDwgbW91c2VUaHJlc2hvbGRTcXVhcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gTWF0aC5zcXJ0KG1EaXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbHBoYSA9ICgoKG1vdXNlVGhyZXNob2xkIC0gZGlzdGFuY2UpIC8gbW91c2VUaHJlc2hvbGQpICogMC40KSArIChNYXRoLnJhbmRvbSgpICogMC4wNSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubGluZVN0eWxlKDEsIDB4MDBkYmZmLCBhbHBoYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubW92ZVRvKG5vZGUucG9zaXRpb24ueCwgbm9kZS5wb3NpdGlvbi55KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5saW5lVG8oJHNjb3BlLm1vdXNlLngsICRzY29wZS5tb3VzZS55KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy9EcmF3IG91ciBkZWFkbm9kZXMgc2VwYXJhdGVseSAodGhleSBmYWRlIG91dCBidXQgc2hvdWxkbid0IGhhdmUgbGluZXMpXG4gICAgICAgICAgICAkc2NvcGUuZGVhZE5vZGVzLmZvckVhY2goZnVuY3Rpb24obm9kZSxpKXtcbiAgICAgICAgICAgICAgICBub2RlLnRpY2soKTtcbiAgICAgICAgICAgICAgICBpZihub2RlLnN0YXRlID09IFwiREVBRFwiKXtcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2UucmVtb3ZlQ2hpbGQobm9kZS5zcHJpdGUpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGVhZE5vZGVzLnNwbGljZSgkc2NvcGUuZGVhZE5vZGVzLmluZGV4T2Yobm9kZSksIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvL1JlbmRlciBzdGFycyB0byB0ZXh0dXJlLCBidXQgbW92ZSBpdCBvZmZzY3JlZW4gKGZvciBuZXh0IGZyYW1lKVxuICAgICAgICAgICAgYmFja2dyb3VuZFNwcml0ZS5hbHBoYSA9IDA7XG4gICAgICAgICAgICBqb2luTGluZXMuYWxwaGEgPSAwLjE7XG4gICAgICAgICAgICByZW5kZXJUZXh0dXJlMi5yZW5kZXIoJHNjb3BlLnN0YWdlLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgIGpvaW5MaW5lcy5hbHBoYSA9IDE7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kU3ByaXRlLmFscGhhID0gMTtcblxuICAgICAgICAgICAgLy9CcmluZyBwcmV2aW91cyBmcmFtZXMgc3RhcnMgb25zY3JlZW4gZm9yIGdsb3dzXG4gICAgICAgICAgICB2YXIgdGVtcCA9IHJlbmRlclRleHR1cmU7XG4gICAgICAgICAgICByZW5kZXJUZXh0dXJlID0gcmVuZGVyVGV4dHVyZTI7XG4gICAgICAgICAgICByZW5kZXJUZXh0dXJlMiA9IHRlbXA7XG4gICAgICAgICAgICBzaGFkb3dTcHJpdGUudGV4dHVyZSA9IHJlbmRlclRleHR1cmU7XG5cbiAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlcigkc2NvcGUuc3RhZ2UpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAkc2NvcGUuaW5pdCgpO1xuICAgIHJldHVybiAkc2NvcGU7XG59OyIsIi8qKlxuICpcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7aW50fSBbeF1cbiAqIEBwYXJhbSB7aW50fSBbeV1cbiAqIEBjb25zdHJ1Y3RvclxuICovXG52YXIgVmVjdG9yMiA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIGlmICgheCl4ID0gMDtcbiAgICBpZiAoIXkpeSA9IDA7XG4gICAgdmFyICRzY29wZSA9IHtcbiAgICAgICAgeDogeCxcbiAgICAgICAgeTogeSxcbiAgICAgICAgYWRkOiBmdW5jdGlvbiAodmVjdG9yLCBzY2FsZSkge1xuICAgICAgICAgICAgc2NhbGUgPSBzY2FsZSB8fCAxO1xuICAgICAgICAgICAgJHNjb3BlLnggKz0gdmVjdG9yLnggKiBzY2FsZTtcbiAgICAgICAgICAgICRzY29wZS55ICs9IHZlY3Rvci55ICogc2NhbGU7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgICAgICAkc2NvcGUueCA9IHg7XG4gICAgICAgICAgICAkc2NvcGUueSA9IHk7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBzY2FsZTogZnVuY3Rpb24gKG11bHRpcGxpZXIpIHtcbiAgICAgICAgICAgICRzY29wZS54ICo9IG11bHRpcGxpZXI7XG4gICAgICAgICAgICAkc2NvcGUueSAqPSBtdWx0aXBsaWVyO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgY2xhbXA6IGZ1bmN0aW9uIChtaW4sIG1heCkge1xuICAgICAgICAgICAgJHNjb3BlLnggPSBNYXRoLm1pbihNYXRoLm1heCgkc2NvcGUueCwgbWluKSwgbWF4KTtcbiAgICAgICAgICAgICRzY29wZS55ID0gTWF0aC5taW4oTWF0aC5tYXgoJHNjb3BlLnksIG1pbiksIG1heCk7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBjbGFtcEFiczogZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgJHNjb3BlLmNsYW1wKC12YWwsIHZhbCk7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBkaXN0YW5jZTogZnVuY3Rpb24gKHZlY3Rvcikge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguc3FydCgkc2NvcGUuZGlzdGFuY2VTcXVhcmUodmVjdG9yKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRpc3RhbmNlU3F1YXJlOiBmdW5jdGlvbiAodmVjdG9yKSB7XG4gICAgICAgICAgICB2YXIgZFggPSBNYXRoLnBvdyh2ZWN0b3IueCAtICRzY29wZS54LCAyKTtcbiAgICAgICAgICAgIHZhciBkWSA9IE1hdGgucG93KHZlY3Rvci55IC0gJHNjb3BlLnksIDIpO1xuICAgICAgICAgICAgcmV0dXJuIGRYICsgZFk7XG4gICAgICAgIH1cblxuICAgIH07XG4gICAgcmV0dXJuICRzY29wZTtcbn07Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
