var CanvasTexture=function(cb){var canvas=document.createElement("canvas");return"function"==typeof cb&&cb(canvas),PIXI.Texture.fromCanvas(canvas)},Particle=function(position,app){"use strict";var radius=1.1*Math.random()+1,haloRadius=Math.ceil(20*radius),colour={red:255,green:255,blue:255};Math.random()>.7&&(colour.red=Math.round(100*Math.random()+55),colour.green=Math.round(100*Math.random()+55),colour.blue=255);var texture=new CanvasTexture(function(canvas){canvas.width=haloRadius,canvas.height=haloRadius;var ctx=canvas.getContext("2d");ctx.fillStyle="rgb("+colour.red+","+colour.green+","+colour.blue+")",ctx.beginPath(),ctx.arc(haloRadius/2,haloRadius/2,radius,0,360,!1),ctx.fill();var grd=ctx.createRadialGradient(haloRadius/2,haloRadius/2,radius,haloRadius/2,haloRadius/2,Math.ceil(haloRadius));grd.addColorStop(0,"rgba("+colour.red+","+colour.green+","+colour.blue+",0.05)"),grd.addColorStop(.3,"rgba("+colour.red+","+colour.green+","+colour.blue+",0)"),ctx.fillStyle=grd,ctx.beginPath(),ctx.arc(haloRadius/2,haloRadius/2,haloRadius,0,360,!1)}),sprite=new PIXI.Sprite(texture);sprite.blendMode=PIXI.BLEND_MODES.SCREEN,app.stage.addChild(sprite);var $scope={sprite:sprite,stage:app,radius:radius,acceleration:new Vector2,velocity:new Vector2(Math.random()-.5,Math.random()-.5),position:position,colour:{red:255,green:255,blue:255},init:function(){Math.random()>.7&&($scope.colour.red=Math.round(200*Math.random()+55),$scope.colour.green=Math.round(200*Math.random()+55),$scope.colour.blue=Math.round(200*Math.random()+55))},die:function(){app.stage.removeChild(sprite)},tick:function(){sprite.alpha=.4*Math.random()+.6,$scope.acceleration.set(Math.random()-.5,Math.random()-.5).scale(app.maxSpeed),$scope.acceleration.clampAbs(app.maxSpeed),$scope.velocity.add($scope.acceleration,.1),($scope.position.x+$scope.velocity.x>window.innerWidth||$scope.position.x+$scope.velocity.x<1)&&($scope.velocity.x*=-.9,$scope.acceleration.x*=-.9),($scope.position.y+$scope.velocity.y>window.innerHeight||$scope.position.y+$scope.velocity.y<1)&&($scope.velocity.y*=-.9,$scope.acceleration.y*=-.9),$scope.velocity.clampAbs(app.maxSpeed),$scope.position.add($scope.velocity,.1),sprite.position.x=$scope.position.x-haloRadius/2,sprite.position.y=$scope.position.y-haloRadius/2}};return $scope.init(),$scope},StarMap=function(width,height,starCount){"use strict";var threshold=(width+height)/2/20,renderer=PIXI.autoDetectRenderer(width,height,{backgroundColor:1443889});document.body.appendChild(renderer.view);var stage=new PIXI.Container,joinLines=new PIXI.Graphics;joinLines.blendMode=PIXI.BLEND_MODES.ADD;var backgroundTexture=new CanvasTexture(function(canvas){canvas.width=width,canvas.height=height;var ctx=canvas.getContext("2d"),grd=ctx.createRadialGradient(width/2,height/2,1,width/2,height/2,height);grd.addColorStop(0,"rgb(22,8,49)"),grd.addColorStop(.4,"rgb(22,8,49)"),grd.addColorStop(.6,"rgb(12,7,24)"),grd.addColorStop(1,"rgb(0,0,0)"),ctx.fillStyle=grd,ctx.fillRect(0,0,width,height)}),renderTexture=new PIXI.RenderTexture(renderer,width,height),renderTexture2=new PIXI.RenderTexture(renderer,width,height),backgroundSprite=new PIXI.Sprite(backgroundTexture),shadowSprite=new PIXI.Sprite(renderTexture),convolutionFilter=new PIXI.filters.ConvolutionFilter([.1,.4,.1,.4,0,.4,.1,.4,.1],width,height);shadowSprite.alpha=.41,shadowSprite.filters=[convolutionFilter],stage.addChild(backgroundSprite);var thresholdSquare=Math.pow(threshold,2),mouseThreshold=10*threshold,mouseThresholdSquare=10*thresholdSquare,$scope={maxSpeed:10,mouse:new Vector2,width:width,height:height,stage:stage,joinLines:joinLines,nodes:[],init:function(){for(var x=0;starCount>x;x++)$scope.addStar(new Vector2(Math.random()*width,Math.random()*height),$scope);$scope.mouse.active=!1,stage.addChild(joinLines),stage.addChild(shadowSprite)},addStar:function(position){var p=new Particle(position,$scope);$scope.addNode(p)},addNode:function(node){$scope.nodes.push(node)},removeNode:function(node){$scope.nodes.splice($scope.nodes.indexOf(node),1)},tick:function(){var distance;if($scope.nodes.length>starCount){var dead=$scope.nodes.shift();dead.die()}requestAnimationFrame($scope.tick),joinLines.clear(),$scope.nodes.forEach(function(node,i){if(node.tick(),$scope.nodes.slice(i).forEach(function(joinNode){var d2=joinNode.position.distanceSquare(node.position);if(thresholdSquare>d2){distance=Math.sqrt(d2);var alpha=(threshold-distance)/threshold*.4+.05*Math.random();joinLines.lineStyle(alpha*(node.radius+joinNode.radius)*3,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo(joinNode.position.x,joinNode.position.y)}}),$scope.mouse.active){var mDist=node.position.distanceSquare($scope.mouse);if(mouseThresholdSquare>mDist){distance=Math.sqrt(mDist);var alpha=(mouseThreshold-distance)/mouseThreshold*.4+.05*Math.random();joinLines.lineStyle(1,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo($scope.mouse.x,$scope.mouse.y)}}}),backgroundSprite.alpha=0,joinLines.alpha=.1,renderTexture2.render($scope.stage,null,!0),joinLines.alpha=1,backgroundSprite.alpha=1;var temp=renderTexture;renderTexture=renderTexture2,renderTexture2=temp,shadowSprite.texture=renderTexture,renderer.render($scope.stage)}};return $scope.init(),$scope},Vector2=function(x,y){"use strict";x||(x=0),y||(y=0);var $scope={x:x,y:y,add:function(vector,scale){return scale=scale||1,$scope.x+=vector.x*scale,$scope.y+=vector.y*scale,$scope},set:function(x,y){return $scope.x=x,$scope.y=y,$scope},scale:function(multiplier){return $scope.x*=multiplier,$scope.y*=multiplier,$scope},clamp:function(min,max){return $scope.x=Math.min(Math.max($scope.x,min),max),$scope.y=Math.min(Math.max($scope.y,min),max),$scope},clampAbs:function(val){return $scope.clamp(-val,val),$scope},distance:function(vector){return Math.sqrt($scope.distanceSquare(vector))},distanceSquare:function(vector){var dX=Math.pow(vector.x-$scope.x,2),dY=Math.pow(vector.y-$scope.y,2);return dX+dY}};return $scope};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhbnZhc1RleHR1cmUuanMiLCJQYXJ0aWNsZS5qcyIsIlN0YXJNYXAuanMiLCJWZWN0b3IyLmpzIl0sIm5hbWVzIjpbIkNhbnZhc1RleHR1cmUiLCJjYiIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsIlBJWEkiLCJUZXh0dXJlIiwiZnJvbUNhbnZhcyIsIlBhcnRpY2xlIiwicG9zaXRpb24iLCJhcHAiLCJyYWRpdXMiLCJNYXRoIiwicmFuZG9tIiwiaGFsb1JhZGl1cyIsImNlaWwiLCJjb2xvdXIiLCJyZWQiLCJncmVlbiIsImJsdWUiLCJyb3VuZCIsInRleHR1cmUiLCJ3aWR0aCIsImhlaWdodCIsImN0eCIsImdldENvbnRleHQiLCJmaWxsU3R5bGUiLCJiZWdpblBhdGgiLCJhcmMiLCJmaWxsIiwiZ3JkIiwiY3JlYXRlUmFkaWFsR3JhZGllbnQiLCJhZGRDb2xvclN0b3AiLCJzcHJpdGUiLCJTcHJpdGUiLCJibGVuZE1vZGUiLCJCTEVORF9NT0RFUyIsIlNDUkVFTiIsInN0YWdlIiwiYWRkQ2hpbGQiLCIkc2NvcGUiLCJhY2NlbGVyYXRpb24iLCJWZWN0b3IyIiwidmVsb2NpdHkiLCJpbml0IiwiZGllIiwicmVtb3ZlQ2hpbGQiLCJ0aWNrIiwiYWxwaGEiLCJzZXQiLCJzY2FsZSIsIm1heFNwZWVkIiwiY2xhbXBBYnMiLCJhZGQiLCJ4Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsInkiLCJpbm5lckhlaWdodCIsIlN0YXJNYXAiLCJzdGFyQ291bnQiLCJ0aHJlc2hvbGQiLCJyZW5kZXJlciIsImF1dG9EZXRlY3RSZW5kZXJlciIsImJhY2tncm91bmRDb2xvciIsImJvZHkiLCJhcHBlbmRDaGlsZCIsInZpZXciLCJDb250YWluZXIiLCJqb2luTGluZXMiLCJHcmFwaGljcyIsIkFERCIsImJhY2tncm91bmRUZXh0dXJlIiwiZmlsbFJlY3QiLCJyZW5kZXJUZXh0dXJlIiwiUmVuZGVyVGV4dHVyZSIsInJlbmRlclRleHR1cmUyIiwiYmFja2dyb3VuZFNwcml0ZSIsInNoYWRvd1Nwcml0ZSIsImNvbnZvbHV0aW9uRmlsdGVyIiwiZmlsdGVycyIsIkNvbnZvbHV0aW9uRmlsdGVyIiwidGhyZXNob2xkU3F1YXJlIiwicG93IiwibW91c2VUaHJlc2hvbGQiLCJtb3VzZVRocmVzaG9sZFNxdWFyZSIsIm1vdXNlIiwibm9kZXMiLCJhZGRTdGFyIiwiYWN0aXZlIiwicCIsImFkZE5vZGUiLCJub2RlIiwicHVzaCIsInJlbW92ZU5vZGUiLCJzcGxpY2UiLCJpbmRleE9mIiwiZGlzdGFuY2UiLCJsZW5ndGgiLCJkZWFkIiwic2hpZnQiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjbGVhciIsImZvckVhY2giLCJpIiwic2xpY2UiLCJqb2luTm9kZSIsImQyIiwiZGlzdGFuY2VTcXVhcmUiLCJzcXJ0IiwibGluZVN0eWxlIiwibW92ZVRvIiwibGluZVRvIiwibURpc3QiLCJyZW5kZXIiLCJ0ZW1wIiwidmVjdG9yIiwibXVsdGlwbGllciIsImNsYW1wIiwibWluIiwibWF4IiwidmFsIiwiZFgiLCJkWSJdLCJtYXBwaW5ncyI6IkFBT0EsR0FBQUEsZUFBQSxTQUFBQyxJQUNBLEdBQUFDLFFBQUFDLFNBQUFDLGNBQUEsU0FFQSxPQURBLGtCQUFBSCxLQUFBQSxHQUFBQyxRQUNBRyxLQUFBQyxRQUFBQyxXQUFBTCxTQ0xBTSxTQUFBLFNBQUFDLFNBQUFDLEtBQ0EsWUFDQSxJQUFBQyxRQUFBLElBQUFDLEtBQUFDLFNBQUEsRUFDQUMsV0FBQUYsS0FBQUcsS0FBQSxHQUFBSixRQUNBSyxRQUNBQyxJQUFBLElBQ0FDLE1BQUEsSUFDQUMsS0FBQSxJQUVBUCxNQUFBQyxTQUFBLEtBQ0FHLE9BQUFDLElBQUFMLEtBQUFRLE1BQUEsSUFBQVIsS0FBQUMsU0FBQSxJQUNBRyxPQUFBRSxNQUFBTixLQUFBUSxNQUFBLElBQUFSLEtBQUFDLFNBQUEsSUFDQUcsT0FBQUcsS0FBQSxJQUdBLElBQUFFLFNBQUEsR0FBQXJCLGVBQUEsU0FBQUUsUUFDQUEsT0FBQW9CLE1B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RUFDQWpCLFFBRUFVLE1BQUEsU0FBQW1FLFlBR0EsTUFGQTdFLFFBQUFjLEdBQUErRCxXQUNBN0UsT0FBQWlCLEdBQUE0RCxXQUNBN0UsUUFFQThFLE1BQUEsU0FBQUMsSUFBQUMsS0FHQSxNQUZBaEYsUUFBQWMsRUFBQTFDLEtBQUEyRyxJQUFBM0csS0FBQTRHLElBQUFoRixPQUFBYyxFQUFBaUUsS0FBQUMsS0FDQWhGLE9BQUFpQixFQUFBN0MsS0FBQTJHLElBQUEzRyxLQUFBNEcsSUFBQWhGLE9BQUFpQixFQUFBOEQsS0FBQUMsS0FDQWhGLFFBRUFZLFNBQUEsU0FBQXFFLEtBRUEsTUFEQWpGLFFBQUE4RSxPQUFBRyxJQUFBQSxLQUNBakYsUUFFQXlELFNBQUEsU0FBQW1CLFFBQ0EsTUFBQXhHLE1BQUFpRyxLQUFBckUsT0FBQW9FLGVBQUFRLFVBRUFSLGVBQUEsU0FBQVEsUUFDQSxHQUFBTSxJQUFBOUcsS0FBQXVFLElBQUFpQyxPQUFBOUQsRUFBQWQsT0FBQWMsRUFBQSxHQUNBcUUsR0FBQS9HLEtBQUF1RSxJQUFBaUMsT0FBQTNELEVBQUFqQixPQUFBaUIsRUFBQSxFQUNBLE9BQUFpRSxJQUFBQyxJQUlBLE9BQUFuRiIsImZpbGUiOiJzdGFybWFwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICpcbiAqIEBwYXJhbSBjYlxuICogQHJldHVybnMge1BJWEkuQmFzZVRleHR1cmV8UElYSS5UZXh0dXJlfVxuICogQGNvbnN0cnVjdG9yXG4gKiBAYXV0aG9yIEFkYW0gQmVuc29uIDxhZGFtQHByZWNhcmlvdXNwYW50aGVyLm5ldD5cbiAqL1xudmFyIENhbnZhc1RleHR1cmUgPSBmdW5jdGlvbiAoY2IpIHtcbiAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgaWYgKHR5cGVvZiBjYiA9PSAnZnVuY3Rpb24nKSBjYihjYW52YXMpO1xuICAgIHJldHVybiBQSVhJLlRleHR1cmUuZnJvbUNhbnZhcyhjYW52YXMpO1xufTsiLCIvKipcbiAqXG4gKiBAYXV0aG9yIEFkYW0gQmVuc29uIDxhZGFtQHByZWNhcmlvdXNwYW50aGVyLm5ldD5cbiAqL1xuXG52YXIgUGFydGljbGUgPSBmdW5jdGlvbiAocG9zaXRpb24sIGFwcCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgcmFkaXVzID0gTWF0aC5yYW5kb20oKSAqIDEuMSArIDE7XG4gICAgdmFyIGhhbG9SYWRpdXMgPSBNYXRoLmNlaWwocmFkaXVzICogMjApO1xuICAgIHZhciBjb2xvdXIgPSB7XG4gICAgICAgIHJlZDogMjU1LFxuICAgICAgICBncmVlbjogMjU1LFxuICAgICAgICBibHVlOiAyNTVcbiAgICB9O1xuICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC43KSB7XG4gICAgICAgIGNvbG91ci5yZWQgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMDAgKyA1NSk7XG4gICAgICAgIGNvbG91ci5ncmVlbiA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDEwMCArIDU1KTtcbiAgICAgICAgY29sb3VyLmJsdWUgPSAyNTU7XG4gICAgfVxuXG4gICAgdmFyIHRleHR1cmUgPSBuZXcgQ2FudmFzVGV4dHVyZShmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICAgIGNhbnZhcy53aWR0aCA9IGhhbG9SYWRpdXM7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoYWxvUmFkaXVzO1xuICAgICAgICAvL0NvcmVcbiAgICAgICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYignICsgY29sb3VyLnJlZCArICcsJyArIGNvbG91ci5ncmVlbiArICcsJyArIGNvbG91ci5ibHVlICsgJyknO1xuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5hcmMoaGFsb1JhZGl1cyAvIDIsIGhhbG9SYWRpdXMgLyAyLCByYWRpdXMsIDAsIDM2MCwgZmFsc2UpO1xuICAgICAgICBjdHguZmlsbCgpO1xuICAgICAgICAvL0hhbG9cbiAgICAgICAgdmFyIGdyZCA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudChoYWxvUmFkaXVzIC8gMiwgaGFsb1JhZGl1cyAvIDIsIHJhZGl1cywgaGFsb1JhZGl1cyAvIDIsIGhhbG9SYWRpdXMgLyAyLCBNYXRoLmNlaWwoaGFsb1JhZGl1cykpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAsICdyZ2JhKCcgKyBjb2xvdXIucmVkICsgJywnICsgY29sb3VyLmdyZWVuICsgJywnICsgY29sb3VyLmJsdWUgKyAnLCcgKyAwLjA1ICsgJyknKTtcbiAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLjMsICdyZ2JhKCcgKyBjb2xvdXIucmVkICsgJywnICsgY29sb3VyLmdyZWVuICsgJywnICsgY29sb3VyLmJsdWUgKyAnLDApJyk7XG5cbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGdyZDtcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICBjdHguYXJjKGhhbG9SYWRpdXMgLyAyLCBoYWxvUmFkaXVzIC8gMiwgaGFsb1JhZGl1cywgMCwgMzYwLCBmYWxzZSk7XG4gICAgICAgIC8vY3R4LmZpbGwoKTtcbiAgICB9KTtcbiAgICB2YXIgc3ByaXRlID0gbmV3IFBJWEkuU3ByaXRlKHRleHR1cmUpO1xuICAgIC8vc3ByaXRlLmJsZW5kTW9kZSA9IFBJWEkuQkxFTkRfTU9ERVMuQUREO1xuICAgIHNwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLlNDUkVFTjtcbiAgICAvL3Nwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLkhBUkRfTElHSFQ7XG4gICAgLy9zcHJpdGUuYmxlbmRNb2RlID0gUElYSS5CTEVORF9NT0RFUy5TQ1JFRU47XG4gICAgYXBwLnN0YWdlLmFkZENoaWxkKHNwcml0ZSk7XG5cbiAgICAvL2FwcC5zdGFnZS5hZGRDaGlsZChqb2luTGluZXMpO1xuICAgIHZhciAkc2NvcGUgPSB7XG4gICAgICAgIHNwcml0ZTogc3ByaXRlLFxuICAgICAgICBzdGFnZTogYXBwLFxuICAgICAgICByYWRpdXM6IHJhZGl1cyxcbiAgICAgICAgYWNjZWxlcmF0aW9uOiBuZXcgVmVjdG9yMigpLFxuICAgICAgICB2ZWxvY2l0eTogbmV3IFZlY3RvcjIoTWF0aC5yYW5kb20oKSAtIDAuNSwgTWF0aC5yYW5kb20oKSAtIDAuNSksXG4gICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcbiAgICAgICAgY29sb3VyOiB7XG4gICAgICAgICAgICByZWQ6IDI1NSxcbiAgICAgICAgICAgIGdyZWVuOiAyNTUsXG4gICAgICAgICAgICBibHVlOiAyNTVcbiAgICAgICAgfSxcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPiAwLjcpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29sb3VyLnJlZCA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDIwMCArIDU1KTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29sb3VyLmdyZWVuID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMjAwICsgNTUpO1xuICAgICAgICAgICAgICAgICRzY29wZS5jb2xvdXIuYmx1ZSA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDIwMCArIDU1KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZGllOmZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBhcHAuc3RhZ2UucmVtb3ZlQ2hpbGQoc3ByaXRlKTtcbiAgICAgICAgfSxcbiAgICAgICAgdGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy9Ud2lua2xlXG4gICAgICAgICAgICBzcHJpdGUuYWxwaGEgPSBNYXRoLnJhbmRvbSgpICogMC40ICsgMC42O1xuXG4gICAgICAgICAgICAvL01vdmVcbiAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24uc2V0KE1hdGgucmFuZG9tKCkgLSAwLjUsIE1hdGgucmFuZG9tKCkgLSAwLjUpLnNjYWxlKGFwcC5tYXhTcGVlZCk7XG4gICAgICAgICAgICAkc2NvcGUuYWNjZWxlcmF0aW9uLmNsYW1wQWJzKGFwcC5tYXhTcGVlZCk7XG5cbiAgICAgICAgICAgICRzY29wZS52ZWxvY2l0eS5hZGQoJHNjb3BlLmFjY2VsZXJhdGlvbiwgMC4xKTtcblxuICAgICAgICAgICAgaWYgKCRzY29wZS5wb3NpdGlvbi54ICsgJHNjb3BlLnZlbG9jaXR5LnggPiB3aW5kb3cuaW5uZXJXaWR0aCB8fCAkc2NvcGUucG9zaXRpb24ueCArICRzY29wZS52ZWxvY2l0eS54IDwgMSkge1xuICAgICAgICAgICAgICAgIC8vQm91bmNlIFhcbiAgICAgICAgICAgICAgICAkc2NvcGUudmVsb2NpdHkueCAqPSAtMC45O1xuICAgICAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24ueCAqPSAtMC45O1xuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJHNjb3BlLnBvc2l0aW9uLnkgKyAkc2NvcGUudmVsb2NpdHkueSA+IHdpbmRvdy5pbm5lckhlaWdodCB8fCAkc2NvcGUucG9zaXRpb24ueSArICRzY29wZS52ZWxvY2l0eS55IDwgMSkge1xuICAgICAgICAgICAgICAgIC8vQm91bmNlIFlcbiAgICAgICAgICAgICAgICAkc2NvcGUudmVsb2NpdHkueSAqPSAtMC45O1xuICAgICAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24ueSAqPSAtMC45O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHNjb3BlLnZlbG9jaXR5LmNsYW1wQWJzKGFwcC5tYXhTcGVlZCk7XG4gICAgICAgICAgICAkc2NvcGUucG9zaXRpb24uYWRkKCRzY29wZS52ZWxvY2l0eSwgMC4xKTtcbiAgICAgICAgICAgIHNwcml0ZS5wb3NpdGlvbi54ID0gJHNjb3BlLnBvc2l0aW9uLnggLSAoaGFsb1JhZGl1cyAvIDIpO1xuICAgICAgICAgICAgc3ByaXRlLnBvc2l0aW9uLnkgPSAkc2NvcGUucG9zaXRpb24ueSAtIChoYWxvUmFkaXVzIC8gMik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLmluaXQoKTtcbiAgICByZXR1cm4gJHNjb3BlO1xufTsiLCIvKipcbiAqXG4gKiBAYXV0aG9yIEFkYW0gQmVuc29uIDxhZGFtQHByZWNhcmlvdXNwYW50aGVyLm5ldD5cbiAqL1xuXG52YXIgU3Rhck1hcCA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCBzdGFyQ291bnQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIHRocmVzaG9sZCA9ICgod2lkdGggKyBoZWlnaHQpIC8gMiApIC8gMjA7XG4gICAgdmFyIHJlbmRlcmVyID0gUElYSS5hdXRvRGV0ZWN0UmVuZGVyZXIod2lkdGgsIGhlaWdodCwge2JhY2tncm91bmRDb2xvcjogMHgxNjA4MzF9KTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHJlbmRlcmVyLnZpZXcpO1xuICAgIHZhciBzdGFnZSA9IG5ldyBQSVhJLkNvbnRhaW5lcigpO1xuICAgIHZhciBqb2luTGluZXMgPSBuZXcgUElYSS5HcmFwaGljcygpO1xuICAgIGpvaW5MaW5lcy5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLkFERDtcblxuICAgIHZhciBiYWNrZ3JvdW5kVGV4dHVyZSA9IG5ldyBDYW52YXNUZXh0dXJlKGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgdmFyIGdyZCA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudCh3aWR0aCAvIDIsIGhlaWdodCAvIDIsIDEsIHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgaGVpZ2h0KTtcbiAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLCAncmdiKDIyLDgsNDkpJyk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMC40LCAncmdiKDIyLDgsNDkpJyk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMC42LCAncmdiKDEyLDcsMjQpJyk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMSwgJ3JnYigwLDAsMCknKTtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGdyZDtcbiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgIH0pO1xuXG4gICAgdmFyIHJlbmRlclRleHR1cmUgPSBuZXcgUElYSS5SZW5kZXJUZXh0dXJlKHJlbmRlcmVyLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB2YXIgcmVuZGVyVGV4dHVyZTIgPSBuZXcgUElYSS5SZW5kZXJUZXh0dXJlKHJlbmRlcmVyLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgIHZhciBiYWNrZ3JvdW5kU3ByaXRlID0gbmV3IFBJWEkuU3ByaXRlKGJhY2tncm91bmRUZXh0dXJlKTtcbiAgICB2YXIgc2hhZG93U3ByaXRlID0gbmV3IFBJWEkuU3ByaXRlKHJlbmRlclRleHR1cmUpO1xuICAgIHZhciBjb252b2x1dGlvbkZpbHRlciA9IG5ldyBQSVhJLmZpbHRlcnMuQ29udm9sdXRpb25GaWx0ZXIoW1xuICAgICAgICAwLjEsIDAuNCwgMC4xLFxuICAgICAgICAwLjQsIDAuMCwgMC40LFxuICAgICAgICAwLjEsIDAuNCwgMC4xXG4gICAgXSwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICAvL3NoYWRvd1Nwcml0ZS5hbHBoYSA9IDAuNDk7XG4gICAgc2hhZG93U3ByaXRlLmFscGhhID0gMC40MTtcbiAgICAvL3NoYWRvd1Nwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLlNPRlRfTElHSFQ7XG5cbiAgICAvKiB2YXIgZmlsdGVyID0gbmV3IFBJWEkuZmlsdGVycy5Db252b2x1dGlvbkZpbHRlcihbXG4gICAgIDAuMSwwLjEsMC4xLFxuICAgICAwLjEsMC4yLDAuMSxcbiAgICAgMC4xLDAuMSwwLjFcbiAgICAgXSx3aWR0aCxoZWlnaHQpOyovXG4gICAgc2hhZG93U3ByaXRlLmZpbHRlcnMgPSBbY29udm9sdXRpb25GaWx0ZXJdO1xuICAgIC8vc2hhZG93U3ByaXRlLmJsZW5kTW9kZSA9IFBJWEkuQkxFTkRfTU9ERVMuT1ZFUkxBWTtcbiAgICAvL3NoYWRvd1Nwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLkFERDtcbiAgICAvL3NoYWRvd1Nwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLlNPRlRfTElHSFQ7XG4gICAgc3RhZ2UuYWRkQ2hpbGQoYmFja2dyb3VuZFNwcml0ZSk7XG5cblxuICAgIHZhciB0aHJlc2hvbGRTcXVhcmUgPSBNYXRoLnBvdyh0aHJlc2hvbGQsIDIpO1xuICAgIHZhciBtb3VzZVRocmVzaG9sZCA9IHRocmVzaG9sZCAqIDEwO1xuICAgIHZhciBtb3VzZVRocmVzaG9sZFNxdWFyZSA9IHRocmVzaG9sZFNxdWFyZSAqIDEwO1xuICAgIHZhciAkc2NvcGUgPSB7XG4gICAgICAgIG1heFNwZWVkOiAxMCxcbiAgICAgICAgbW91c2U6IG5ldyBWZWN0b3IyKCksXG4gICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgIHN0YWdlOiBzdGFnZSxcbiAgICAgICAgam9pbkxpbmVzOiBqb2luTGluZXMsXG4gICAgICAgIG5vZGVzOiBbXSxcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdGFyQ291bnQ7IHgrKykge1xuICAgICAgICAgICAgICAgICRzY29wZS5hZGRTdGFyKG5ldyBWZWN0b3IyKE1hdGgucmFuZG9tKCkgKiB3aWR0aCwgTWF0aC5yYW5kb20oKSAqIGhlaWdodCksICRzY29wZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUubW91c2UuYWN0aXZlID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHN0YWdlLmFkZENoaWxkKGpvaW5MaW5lcyk7XG4gICAgICAgICAgICBzdGFnZS5hZGRDaGlsZChzaGFkb3dTcHJpdGUpO1xuICAgICAgICB9LFxuICAgICAgICBhZGRTdGFyOmZ1bmN0aW9uKHBvc2l0aW9uKXtcbiAgICAgICAgICAgIHZhciBwID0gbmV3IFBhcnRpY2xlKHBvc2l0aW9uLCAkc2NvcGUpO1xuICAgICAgICAgICAgJHNjb3BlLmFkZE5vZGUocCk7XG4gICAgICAgIH0sXG4gICAgICAgIGFkZE5vZGU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAkc2NvcGUubm9kZXMucHVzaChub2RlKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVtb3ZlTm9kZTogZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICRzY29wZS5ub2Rlcy5zcGxpY2UoJHNjb3BlLm5vZGVzLmluZGV4T2Yobm9kZSksIDEpO1xuICAgICAgICB9LFxuICAgICAgICB0aWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGlzdGFuY2U7XG5cbiAgICAgICAgICAgIC8vQ3VsbCB0b28gbWFueSBzdGFyc1xuICAgICAgICAgICAgaWYoJHNjb3BlLm5vZGVzLmxlbmd0aCA+IHN0YXJDb3VudCl7XG4gICAgICAgICAgICAgICAgdmFyIGRlYWQgPSAkc2NvcGUubm9kZXMuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICBkZWFkLmRpZSgpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgkc2NvcGUudGljayk7XG4gICAgICAgICAgICBqb2luTGluZXMuY2xlYXIoKTtcbiAgICAgICAgICAgICRzY29wZS5ub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlLCBpKSB7XG4gICAgICAgICAgICAgICAgLy9QYXJ0aWNsZXNcbiAgICAgICAgICAgICAgICBub2RlLnRpY2soKTtcbiAgICAgICAgICAgICAgICAvL0pvaW4gbGluZXNcbiAgICAgICAgICAgICAgICAkc2NvcGUubm9kZXMuc2xpY2UoaSkuZm9yRWFjaChmdW5jdGlvbiAoam9pbk5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGQyID0gam9pbk5vZGUucG9zaXRpb24uZGlzdGFuY2VTcXVhcmUobm9kZS5wb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkMiA8IHRocmVzaG9sZFNxdWFyZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBNYXRoLnNxcnQoZDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhID0gKCgodGhyZXNob2xkIC0gZGlzdGFuY2UpIC8gdGhyZXNob2xkKSAqIDAuNCkgKyAoTWF0aC5yYW5kb20oKSAqIDAuMDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLmxpbmVTdHlsZShhbHBoYSAqIChub2RlLnJhZGl1cyArIGpvaW5Ob2RlLnJhZGl1cykgKiAzLCAweDAwZGJmZiwgYWxwaGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLm1vdmVUbyhub2RlLnBvc2l0aW9uLngsIG5vZGUucG9zaXRpb24ueSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubGluZVRvKGpvaW5Ob2RlLnBvc2l0aW9uLngsIGpvaW5Ob2RlLnBvc2l0aW9uLnkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvL01vdXNlIHJlcHVsc2VcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm1vdXNlLmFjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbURpc3QgPSBub2RlLnBvc2l0aW9uLmRpc3RhbmNlU3F1YXJlKCRzY29wZS5tb3VzZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtRGlzdCA8IG1vdXNlVGhyZXNob2xkU3F1YXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IE1hdGguc3FydChtRGlzdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxwaGEgPSAoKChtb3VzZVRocmVzaG9sZCAtIGRpc3RhbmNlKSAvIG1vdXNlVGhyZXNob2xkKSAqIDAuNCkgKyAoTWF0aC5yYW5kb20oKSAqIDAuMDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLmxpbmVTdHlsZSgxLCAweDAwZGJmZiwgYWxwaGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLm1vdmVUbyhub2RlLnBvc2l0aW9uLngsIG5vZGUucG9zaXRpb24ueSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubGluZVRvKCRzY29wZS5tb3VzZS54LCAkc2NvcGUubW91c2UueSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvL1JlbmRlciBzdGFycyB0byB0ZXh0dXJlLCBidXQgbW92ZSBpdCBvZmZzY3JlZW4gKGZvciBuZXh0IGZyYW1lKVxuICAgICAgICAgICAgYmFja2dyb3VuZFNwcml0ZS5hbHBoYSA9IDA7XG4gICAgICAgICAgICBqb2luTGluZXMuYWxwaGEgPSAwLjE7XG4gICAgICAgICAgICByZW5kZXJUZXh0dXJlMi5yZW5kZXIoJHNjb3BlLnN0YWdlLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgIGpvaW5MaW5lcy5hbHBoYSA9IDE7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kU3ByaXRlLmFscGhhID0gMTtcblxuICAgICAgICAgICAgLy9CcmluZyBwcmV2aW91cyBmcmFtZXMgc3RhcnMgb25zY3JlZW4gZm9yIGdsb3dzXG4gICAgICAgICAgICB2YXIgdGVtcCA9IHJlbmRlclRleHR1cmU7XG4gICAgICAgICAgICByZW5kZXJUZXh0dXJlID0gcmVuZGVyVGV4dHVyZTI7XG4gICAgICAgICAgICByZW5kZXJUZXh0dXJlMiA9IHRlbXA7XG4gICAgICAgICAgICBzaGFkb3dTcHJpdGUudGV4dHVyZSA9IHJlbmRlclRleHR1cmU7XG5cbiAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlcigkc2NvcGUuc3RhZ2UpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAkc2NvcGUuaW5pdCgpO1xuICAgIHJldHVybiAkc2NvcGU7XG59OyIsIi8qKlxuICpcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7aW50fSBbeF1cbiAqIEBwYXJhbSB7aW50fSBbeV1cbiAqIEBjb25zdHJ1Y3RvclxuICovXG52YXIgVmVjdG9yMiA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIGlmICgheCl4ID0gMDtcbiAgICBpZiAoIXkpeSA9IDA7XG4gICAgdmFyICRzY29wZSA9IHtcbiAgICAgICAgeDogeCxcbiAgICAgICAgeTogeSxcbiAgICAgICAgYWRkOiBmdW5jdGlvbiAodmVjdG9yLCBzY2FsZSkge1xuICAgICAgICAgICAgc2NhbGUgPSBzY2FsZSB8fCAxO1xuICAgICAgICAgICAgJHNjb3BlLnggKz0gdmVjdG9yLnggKiBzY2FsZTtcbiAgICAgICAgICAgICRzY29wZS55ICs9IHZlY3Rvci55ICogc2NhbGU7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgICAgICAkc2NvcGUueCA9IHg7XG4gICAgICAgICAgICAkc2NvcGUueSA9IHk7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBzY2FsZTogZnVuY3Rpb24gKG11bHRpcGxpZXIpIHtcbiAgICAgICAgICAgICRzY29wZS54ICo9IG11bHRpcGxpZXI7XG4gICAgICAgICAgICAkc2NvcGUueSAqPSBtdWx0aXBsaWVyO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgY2xhbXA6IGZ1bmN0aW9uIChtaW4sIG1heCkge1xuICAgICAgICAgICAgJHNjb3BlLnggPSBNYXRoLm1pbihNYXRoLm1heCgkc2NvcGUueCwgbWluKSwgbWF4KTtcbiAgICAgICAgICAgICRzY29wZS55ID0gTWF0aC5taW4oTWF0aC5tYXgoJHNjb3BlLnksIG1pbiksIG1heCk7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBjbGFtcEFiczogZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgJHNjb3BlLmNsYW1wKC12YWwsIHZhbCk7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBkaXN0YW5jZTogZnVuY3Rpb24gKHZlY3Rvcikge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguc3FydCgkc2NvcGUuZGlzdGFuY2VTcXVhcmUodmVjdG9yKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRpc3RhbmNlU3F1YXJlOiBmdW5jdGlvbiAodmVjdG9yKSB7XG4gICAgICAgICAgICB2YXIgZFggPSBNYXRoLnBvdyh2ZWN0b3IueCAtICRzY29wZS54LCAyKTtcbiAgICAgICAgICAgIHZhciBkWSA9IE1hdGgucG93KHZlY3Rvci55IC0gJHNjb3BlLnksIDIpO1xuICAgICAgICAgICAgcmV0dXJuIGRYICsgZFk7XG4gICAgICAgIH1cblxuICAgIH07XG4gICAgcmV0dXJuICRzY29wZTtcbn07Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
