var CanvasTexture=function(cb){var canvas=document.createElement("canvas");return"function"==typeof cb&&cb(canvas),PIXI.Texture.fromCanvas(canvas)},Particle=function(position,app){"use strict";var sprite=new PIXI.Sprite;sprite.blendMode=PIXI.BLEND_MODES.SCREEN,app.stage.addChild(sprite);var state={ALIVE:"ALIVE",DYING:"DYING",DEAD:"DEAD"},$scope={alpha:1,state:state.ALIVE,sprite:sprite,stage:app,radius:0,haloRadius:0,colour:{red:255,green:255,blue:255},acceleration:new Vector2,velocity:new Vector2(Math.random()-.5,Math.random()-.5),position:position,init:function(){$scope.radius=1.1*Math.random()+1,Math.random()>.7&&($scope.colour.red=Math.round(100*Math.random()+55),$scope.colour.green=Math.round(100*Math.random()+55),$scope.colour.blue=255),$scope.createTexture($scope.radius)},createTexture:function(radius){$scope.haloRadius=Math.ceil(20*radius),sprite.texture=new CanvasTexture(function(canvas){canvas.width=$scope.haloRadius,canvas.height=$scope.haloRadius;var ctx=canvas.getContext("2d");ctx.fillStyle="rgb("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+")",ctx.beginPath(),ctx.arc($scope.haloRadius/2,$scope.haloRadius/2,radius,0,360,!1),ctx.fill();var grd=ctx.createRadialGradient($scope.haloRadius/2,$scope.haloRadius/2,radius,$scope.haloRadius/2,$scope.haloRadius/2,Math.ceil($scope.haloRadius));grd.addColorStop(0,"rgba("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+",0.05)"),grd.addColorStop(.3,"rgba("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+",0)"),ctx.fillStyle=grd,ctx.beginPath(),ctx.arc($scope.haloRadius/2,$scope.haloRadius/2,$scope.haloRadius,0,360,!1)})},die:function(){$scope.state=state.DYING},tick:function(){if($scope.state!=state.DYING)sprite.alpha=.4*Math.random()+.6,$scope.acceleration.set(Math.random()-.5,Math.random()-.5).scale(app.maxSpeed),$scope.acceleration.clampAbs(app.maxSpeed),$scope.velocity.add($scope.acceleration,.1),($scope.position.x+$scope.velocity.x>window.innerWidth||$scope.position.x+$scope.velocity.x<1)&&($scope.velocity.x*=-.9,$scope.acceleration.x*=-.9),($scope.position.y+$scope.velocity.y>window.innerHeight||$scope.position.y+$scope.velocity.y<1)&&($scope.velocity.y*=-.9,$scope.acceleration.y*=-.9),$scope.velocity.clampAbs(app.maxSpeed),$scope.position.add($scope.velocity,.1),sprite.position.x=$scope.position.x-$scope.haloRadius/2,sprite.position.y=$scope.position.y-$scope.haloRadius/2;else if($scope.alpha-=.01,sprite.alpha=$scope.alpha,$scope.alpha<=0)return void($scope.state=state.DEAD)}};return $scope.init(),$scope},StarMap=function(width,height,maxStars){"use strict";var threshold=Math.max((width+height)/2/40,30),maxLines=7*maxStars,renderer=PIXI.autoDetectRenderer(width,height,{backgroundColor:1443889});document.body.appendChild(renderer.view);var stage=new PIXI.Container,joinLines=new PIXI.Graphics;joinLines.blendMode=PIXI.BLEND_MODES.ADD;var counter=$('<span class="counter"></span>').appendTo(document.body),backgroundTexture=new CanvasTexture(function(canvas){canvas.width=width,canvas.height=height;var ctx=canvas.getContext("2d"),grd=ctx.createRadialGradient(width/2,height/2,1,width/2,height/2,height);grd.addColorStop(0,"rgb(22,8,49)"),grd.addColorStop(.4,"rgb(22,8,49)"),grd.addColorStop(.6,"rgb(12,7,24)"),grd.addColorStop(1,"rgb(0,0,0)"),ctx.fillStyle=grd,ctx.fillRect(0,0,width,height)}),renderTexture=new PIXI.RenderTexture(renderer,width,height),renderTexture2=new PIXI.RenderTexture(renderer,width,height),backgroundSprite=new PIXI.Sprite(backgroundTexture),shadowSprite=new PIXI.Sprite(renderTexture),convolutionFilter=new PIXI.filters.ConvolutionFilter([.1,.4,.1,.4,0,.4,.1,.4,.1],width,height);shadowSprite.alpha=.41,shadowSprite.filters=[convolutionFilter],stage.addChild(backgroundSprite);var lineCount,joinCount,thresholdSquare=Math.pow(threshold,2),mouseThreshold=10*threshold,mouseThresholdSquare=10*thresholdSquare,$scope={maxSpeed:10,maxStars:maxStars,mouse:new Vector2,width:width,height:height,stage:stage,showLines:!0,joinLines:joinLines,nodes:[],deadNodes:[],init:function(){for(var x=0;maxStars>x;x++)$scope.addStar(new Vector2(Math.random()*width,Math.random()*height),$scope);$scope.mouse.buttons=0,stage.addChild(joinLines),stage.addChild(shadowSprite)},addStar:function(position){var p=new Particle(position,$scope);$scope.addNode(p),$scope.nodes.length>$scope.maxStars&&$scope.killNode()},addNode:function(node){$scope.nodes.push(node)},clear:function(){$scope.nodes.forEach(function(node,i){stage.removeChild(node.sprite)}),$scope.nodes=[]},destroyNode:function(node){stage.removeChild(node.sprite),$scope.nodes.splice($scope.nodes.indexOf(node),1)},killNode:function(){var dead=$scope.nodes.shift();$scope.deadNodes.push(dead),dead.die()},tick:function(){var distance;counter.html($scope.nodes.length+$scope.deadNodes.length+" / "+$scope.maxStars),$scope.nodes.length>$scope.maxStars&&$scope.killNode(),lineCount=0,requestAnimationFrame($scope.tick),joinLines.clear(),$scope.nodes.forEach(function(node,i){node.tick(),$scope.showLines&&maxLines>lineCount&&(joinCount=0,$scope.nodes.slice(i).forEach(function(joinNode){if(!(lineCount>maxLines||joinCount>12)){var d2=joinNode.position.distanceSquare(node.position);if(thresholdSquare>d2){lineCount++,joinCount++,distance=Math.sqrt(d2);var alpha=(threshold-distance)/threshold*.4+.05*Math.random();joinLines.lineStyle(alpha*(node.radius+joinNode.radius)*3,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo(joinNode.position.x,joinNode.position.y)}}}));var mDist;switch($scope.mouse.buttons){case 2:mDist=node.position.distanceSquare($scope.mouse),mouseThresholdSquare>mDist&&(distance=Math.sqrt(mDist),20>distance&&$scope.destroyNode(node));break;case 4:if(mDist=node.position.distanceSquare($scope.mouse),mouseThresholdSquare>mDist){distance=Math.sqrt(mDist);var alpha=(mouseThreshold-distance)/mouseThreshold*.4+.05*Math.random();joinLines.lineStyle(1,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo($scope.mouse.x,$scope.mouse.y)}}}),$scope.deadNodes.forEach(function(node,i){node.tick(),"DEAD"==node.state&&(stage.removeChild(node.sprite),$scope.deadNodes.splice($scope.deadNodes.indexOf(node),1))}),backgroundSprite.alpha=0,joinLines.alpha=.1,renderTexture2.render($scope.stage,null,!0),joinLines.alpha=1,backgroundSprite.alpha=1;var temp=renderTexture;renderTexture=renderTexture2,renderTexture2=temp,shadowSprite.texture=renderTexture,renderer.render($scope.stage)}};return $scope.init(),$scope},Vector2=function(x,y){"use strict";x||(x=0),y||(y=0);var $scope={x:x,y:y,add:function(vector,scale){return scale=scale||1,$scope.x+=vector.x*scale,$scope.y+=vector.y*scale,$scope},set:function(x,y){return $scope.x=x,$scope.y=y,$scope},scale:function(multiplier){return $scope.x*=multiplier,$scope.y*=multiplier,$scope},clamp:function(min,max){return $scope.x=Math.min(Math.max($scope.x,min),max),$scope.y=Math.min(Math.max($scope.y,min),max),$scope},clampAbs:function(val){return $scope.clamp(-val,val),$scope},distance:function(vector){return Math.sqrt($scope.distanceSquare(vector))},distanceSquare:function(vector){var dX=Math.pow(vector.x-$scope.x,2),dY=Math.pow(vector.y-$scope.y,2);return dX+dY}};return $scope};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhbnZhc1RleHR1cmUuanMiLCJQYXJ0aWNsZS5qcyIsIlN0YXJNYXAuanMiLCJWZWN0b3IyLmpzIl0sIm5hbWVzIjpbIkNhbnZhc1RleHR1cmUiLCJjYiIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsIlBJWEkiLCJUZXh0dXJlIiwiZnJvbUNhbnZhcyIsIlBhcnRpY2xlIiwicG9zaXRpb24iLCJhcHAiLCJzcHJpdGUiLCJTcHJpdGUiLCJibGVuZE1vZGUiLCJCTEVORF9NT0RFUyIsIlNDUkVFTiIsInN0YWdlIiwiYWRkQ2hpbGQiLCJzdGF0ZSIsIkFMSVZFIiwiRFlJTkciLCJERUFEIiwiJHNjb3BlIiwiYWxwaGEiLCJyYWRpdXMiLCJoYWxvUmFkaXVzIiwiY29sb3VyIiwicmVkIiwiZ3JlZW4iLCJibHVlIiwiYWNjZWxlcmF0aW9uIiwiVmVjdG9yMiIsInZlbG9jaXR5IiwiTWF0aCIsInJhbmRvbSIsImluaXQiLCJyb3VuZCIsImNyZWF0ZVRleHR1cmUiLCJjZWlsIiwidGV4dHVyZSIsIndpZHRoIiwiaGVpZ2h0IiwiY3R4IiwiZ2V0Q29udGV4dCIsImZpbGxTdHlsZSIsImJlZ2luUGF0aCIsImFyYyIsImZpbGwiLCJncmQiLCJjcmVhdGVSYWRpYWxHcmFkaWVudCIsImFkZENvbG9yU3RvcCIsImRpZSIsInRpY2siLCJzZXQiLCJzY2FsZSIsIm1heFNwZWVkIiwiY2xhbXBBYnMiLCJhZGQiLCJ4Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsInkiLCJpbm5lckhlaWdodCIsIlN0YXJNYXAiLCJtYXhTdGFycyIsInRocmVzaG9sZCIsIm1heCIsIm1heExpbmVzIiwicmVuZGVyZXIiLCJhdXRvRGV0ZWN0UmVuZGVyZXIiLCJiYWNrZ3JvdW5kQ29sb3IiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJ2aWV3IiwiQ29udGFpbmVyIiwiam9pbkxpbmVzIiwiR3JhcGhpY3MiLCJBREQiLCJjb3VudGVyIiwiJCIsImFwcGVuZFRvIiwiYmFja2dyb3VuZFRleHR1cmUiLCJmaWxsUmVjdCIsInJlbmRlclRleHR1cmUiLCJSZW5kZXJUZXh0dXJlIiwicmVuZGVyVGV4dHVyZTIiLCJiYWNrZ3JvdW5kU3ByaXRlIiwic2hhZG93U3ByaXRlIiwiY29udm9sdXRpb25GaWx0ZXIiLCJmaWx0ZXJzIiwiQ29udm9sdXRpb25GaWx0ZXIiLCJsaW5lQ291bnQiLCJqb2luQ291bnQiLCJ0aHJlc2hvbGRTcXVhcmUiLCJwb3ciLCJtb3VzZVRocmVzaG9sZCIsIm1vdXNlVGhyZXNob2xkU3F1YXJlIiwibW91c2UiLCJzaG93TGluZXMiLCJub2RlcyIsImRlYWROb2RlcyIsImFkZFN0YXIiLCJidXR0b25zIiwicCIsImFkZE5vZGUiLCJsZW5ndGgiLCJraWxsTm9kZSIsIm5vZGUiLCJwdXNoIiwiY2xlYXIiLCJmb3JFYWNoIiwiaSIsInJlbW92ZUNoaWxkIiwiZGVzdHJveU5vZGUiLCJzcGxpY2UiLCJpbmRleE9mIiwiZGVhZCIsInNoaWZ0IiwiZGlzdGFuY2UiLCJodG1sIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwic2xpY2UiLCJqb2luTm9kZSIsImQyIiwiZGlzdGFuY2VTcXVhcmUiLCJzcXJ0IiwibGluZVN0eWxlIiwibW92ZVRvIiwibGluZVRvIiwibURpc3QiLCJyZW5kZXIiLCJ0ZW1wIiwidmVjdG9yIiwibXVsdGlwbGllciIsImNsYW1wIiwibWluIiwidmFsIiwiZFgiLCJkWSJdLCJtYXBwaW5ncyI6IkFBT0EsR0FBQUEsZUFBQSxTQUFBQyxJQUNBLEdBQUFDLFFBQUFDLFNBQUFDLGNBQUEsU0FFQSxPQURBLGtCQUFBSCxLQUFBQSxHQUFBQyxRQUNBRyxLQUFBQyxRQUFBQyxXQUFBTCxTQ0xBTSxTQUFBLFNBQUFDLFNBQUFDLEtBQ0EsWUFFQSxJQUFBQyxRQUFBLEdBQUFOLE1BQUFPLE1BRUFELFFBQUFFLFVBQUFSLEtBQUFTLFlBQUFDLE9BQ0FMLElBQUFNLE1BQUFDLFNBQUFOLE9BRUEsSUFBQU8sUUFDQUMsTUFBQSxRQUNBQyxNQUFBLFFBQ0FDLEtBQUEs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Q0FHLElBQUFBLEVBQUEsRUFDQSxJQUFBdkMsU0FDQW9DLEVBQUFBLEVBQ0FHLEVBQUFBLEVBQ0FKLElBQUEsU0FBQTJFLE9BQUE5RSxPQUlBLE1BSEFBLE9BQUFBLE9BQUEsRUFDQWhDLE9BQUFvQyxHQUFBMEUsT0FBQTFFLEVBQUFKLE1BQ0FoQyxPQUFBdUMsR0FBQXVFLE9BQUF2RSxFQUFBUCxNQUNBaEMsUUFFQStCLElBQUEsU0FBQUssRUFBQUcsR0FHQSxNQUZBdkMsUUFBQW9DLEVBQUFBLEVBQ0FwQyxPQUFBdUMsRUFBQUEsRUFDQXZDLFFBRUFnQyxNQUFBLFNBQUErRSxZQUdBLE1BRkEvRyxRQUFBb0MsR0FBQTJFLFdBQ0EvRyxPQUFBdUMsR0FBQXdFLFdBQ0EvRyxRQUVBZ0gsTUFBQSxTQUFBQyxJQUFBckUsS0FHQSxNQUZBNUMsUUFBQW9DLEVBQUF6QixLQUFBc0csSUFBQXRHLEtBQUFpQyxJQUFBNUMsT0FBQW9DLEVBQUE2RSxLQUFBckUsS0FDQTVDLE9BQUF1QyxFQUFBNUIsS0FBQXNHLElBQUF0RyxLQUFBaUMsSUFBQTVDLE9BQUF1QyxFQUFBMEUsS0FBQXJFLEtBQ0E1QyxRQUVBa0MsU0FBQSxTQUFBZ0YsS0FFQSxNQURBbEgsUUFBQWdILE9BQUFFLElBQUFBLEtBQ0FsSCxRQUVBZ0csU0FBQSxTQUFBYyxRQUNBLE1BQUFuRyxNQUFBNEYsS0FBQXZHLE9BQUFzRyxlQUFBUSxVQUVBUixlQUFBLFNBQUFRLFFBQ0EsR0FBQUssSUFBQXhHLEtBQUE2RCxJQUFBc0MsT0FBQTFFLEVBQUFwQyxPQUFBb0MsRUFBQSxHQUNBZ0YsR0FBQXpHLEtBQUE2RCxJQUFBc0MsT0FBQXZFLEVBQUF2QyxPQUFBdUMsRUFBQSxFQUNBLE9BQUE0RSxJQUFBQyxJQUlBLE9BQUFwSCIsImZpbGUiOiJzdGFybWFwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICpcbiAqIEBwYXJhbSBjYlxuICogQHJldHVybnMge1BJWEkuQmFzZVRleHR1cmV8UElYSS5UZXh0dXJlfVxuICogQGNvbnN0cnVjdG9yXG4gKiBAYXV0aG9yIEFkYW0gQmVuc29uIDxhZGFtQHByZWNhcmlvdXNwYW50aGVyLm5ldD5cbiAqL1xudmFyIENhbnZhc1RleHR1cmUgPSBmdW5jdGlvbiAoY2IpIHtcbiAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgaWYgKHR5cGVvZiBjYiA9PSAnZnVuY3Rpb24nKSBjYihjYW52YXMpO1xuICAgIHJldHVybiBQSVhJLlRleHR1cmUuZnJvbUNhbnZhcyhjYW52YXMpO1xufTsiLCIvKipcbiAqXG4gKiBAYXV0aG9yIEFkYW0gQmVuc29uIDxhZGFtQHByZWNhcmlvdXNwYW50aGVyLm5ldD5cbiAqL1xuXG52YXIgUGFydGljbGUgPSBmdW5jdGlvbiAocG9zaXRpb24sIGFwcCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBzcHJpdGUgPSBuZXcgUElYSS5TcHJpdGUoKTtcblxuICAgIHNwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLlNDUkVFTjtcbiAgICBhcHAuc3RhZ2UuYWRkQ2hpbGQoc3ByaXRlKTtcblxuICAgIHZhciBzdGF0ZSA9IHtcbiAgICAgICAgQUxJVkU6IFwiQUxJVkVcIixcbiAgICAgICAgRFlJTkc6IFwiRFlJTkdcIixcbiAgICAgICAgREVBRDogXCJERUFEXCJcbiAgICB9O1xuXG4gICAgLy9hcHAuc3RhZ2UuYWRkQ2hpbGQoam9pbkxpbmVzKTtcbiAgICB2YXIgJHNjb3BlID0ge1xuICAgICAgICBhbHBoYTogMSxcbiAgICAgICAgc3RhdGU6IHN0YXRlLkFMSVZFLFxuICAgICAgICBzcHJpdGU6IHNwcml0ZSxcbiAgICAgICAgc3RhZ2U6IGFwcCxcbiAgICAgICAgcmFkaXVzOiAwLFxuICAgICAgICBoYWxvUmFkaXVzOiAwLFxuICAgICAgICBjb2xvdXI6IHtcbiAgICAgICAgICAgIHJlZDogMjU1LFxuICAgICAgICAgICAgZ3JlZW46IDI1NSxcbiAgICAgICAgICAgIGJsdWU6IDI1NVxuICAgICAgICB9LFxuICAgICAgICBhY2NlbGVyYXRpb246IG5ldyBWZWN0b3IyKCksXG4gICAgICAgIHZlbG9jaXR5OiBuZXcgVmVjdG9yMihNYXRoLnJhbmRvbSgpIC0gMC41LCBNYXRoLnJhbmRvbSgpIC0gMC41KSxcbiAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUucmFkaXVzID0gTWF0aC5yYW5kb20oKSAqIDEuMSArIDE7XG4gICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA+IDAuNykge1xuICAgICAgICAgICAgICAgICRzY29wZS5jb2xvdXIucmVkID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMTAwICsgNTUpO1xuICAgICAgICAgICAgICAgICRzY29wZS5jb2xvdXIuZ3JlZW4gPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMDAgKyA1NSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbG91ci5ibHVlID0gMjU1O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHNjb3BlLmNyZWF0ZVRleHR1cmUoJHNjb3BlLnJhZGl1cyk7XG4gICAgICAgIH0sXG4gICAgICAgIGNyZWF0ZVRleHR1cmU6IGZ1bmN0aW9uIChyYWRpdXMpIHtcbiAgICAgICAgICAgICRzY29wZS5oYWxvUmFkaXVzID0gTWF0aC5jZWlsKHJhZGl1cyAqIDIwKTtcbiAgICAgICAgICAgIHNwcml0ZS50ZXh0dXJlID0gbmV3IENhbnZhc1RleHR1cmUoZnVuY3Rpb24gKGNhbnZhcykge1xuICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9ICRzY29wZS5oYWxvUmFkaXVzO1xuICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSAkc2NvcGUuaGFsb1JhZGl1cztcbiAgICAgICAgICAgICAgICAvL0NvcmVcbiAgICAgICAgICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2IoJyArICRzY29wZS5jb2xvdXIucmVkICsgJywnICsgJHNjb3BlLmNvbG91ci5ncmVlbiArICcsJyArICRzY29wZS5jb2xvdXIuYmx1ZSArICcpJztcbiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICAgICAgY3R4LmFyYygkc2NvcGUuaGFsb1JhZGl1cyAvIDIsICRzY29wZS5oYWxvUmFkaXVzIC8gMiwgcmFkaXVzLCAwLCAzNjAsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBjdHguZmlsbCgpO1xuICAgICAgICAgICAgICAgIC8vSGFsb1xuICAgICAgICAgICAgICAgIHZhciBncmQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCAkc2NvcGUuaGFsb1JhZGl1cyAvIDIsIHJhZGl1cywgJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCAkc2NvcGUuaGFsb1JhZGl1cyAvIDIsIE1hdGguY2VpbCgkc2NvcGUuaGFsb1JhZGl1cykpO1xuICAgICAgICAgICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoJyArICRzY29wZS5jb2xvdXIucmVkICsgJywnICsgJHNjb3BlLmNvbG91ci5ncmVlbiArICcsJyArICRzY29wZS5jb2xvdXIuYmx1ZSArICcsJyArIDAuMDUgKyAnKScpO1xuICAgICAgICAgICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMC4zLCAncmdiYSgnICsgJHNjb3BlLmNvbG91ci5yZWQgKyAnLCcgKyAkc2NvcGUuY29sb3VyLmdyZWVuICsgJywnICsgJHNjb3BlLmNvbG91ci5ibHVlICsgJywwKScpO1xuXG4gICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGdyZDtcbiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICAgICAgY3R4LmFyYygkc2NvcGUuaGFsb1JhZGl1cyAvIDIsICRzY29wZS5oYWxvUmFkaXVzIC8gMiwgJHNjb3BlLmhhbG9SYWRpdXMsIDAsIDM2MCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIC8vY3R4LmZpbGwoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBkaWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vVHJpZ2dlciBmYWRlXG4gICAgICAgICAgICAkc2NvcGUuc3RhdGUgPSBzdGF0ZS5EWUlORztcbiAgICAgICAgfSxcbiAgICAgICAgdGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5zdGF0ZSA9PSBzdGF0ZS5EWUlORykge1xuICAgICAgICAgICAgICAgIC8vRHlpbmdcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWxwaGEgLT0gMC4wMTtcbiAgICAgICAgICAgICAgICBzcHJpdGUuYWxwaGEgPSAkc2NvcGUuYWxwaGE7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hbHBoYSA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdGF0ZSA9IHN0YXRlLkRFQUQ7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vVHdpbmtsZVxuICAgICAgICAgICAgICAgIHNwcml0ZS5hbHBoYSA9IE1hdGgucmFuZG9tKCkgKiAwLjQgKyAwLjY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL01vdmVcbiAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24uc2V0KE1hdGgucmFuZG9tKCkgLSAwLjUsIE1hdGgucmFuZG9tKCkgLSAwLjUpLnNjYWxlKGFwcC5tYXhTcGVlZCk7XG4gICAgICAgICAgICAkc2NvcGUuYWNjZWxlcmF0aW9uLmNsYW1wQWJzKGFwcC5tYXhTcGVlZCk7XG5cbiAgICAgICAgICAgICRzY29wZS52ZWxvY2l0eS5hZGQoJHNjb3BlLmFjY2VsZXJhdGlvbiwgMC4xKTtcblxuICAgICAgICAgICAgaWYgKCRzY29wZS5wb3NpdGlvbi54ICsgJHNjb3BlLnZlbG9jaXR5LnggPiB3aW5kb3cuaW5uZXJXaWR0aCB8fCAkc2NvcGUucG9zaXRpb24ueCArICRzY29wZS52ZWxvY2l0eS54IDwgMSkge1xuICAgICAgICAgICAgICAgIC8vQm91bmNlIFhcbiAgICAgICAgICAgICAgICAkc2NvcGUudmVsb2NpdHkueCAqPSAtMC45O1xuICAgICAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24ueCAqPSAtMC45O1xuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJHNjb3BlLnBvc2l0aW9uLnkgKyAkc2NvcGUudmVsb2NpdHkueSA+IHdpbmRvdy5pbm5lckhlaWdodCB8fCAkc2NvcGUucG9zaXRpb24ueSArICRzY29wZS52ZWxvY2l0eS55IDwgMSkge1xuICAgICAgICAgICAgICAgIC8vQm91bmNlIFlcbiAgICAgICAgICAgICAgICAkc2NvcGUudmVsb2NpdHkueSAqPSAtMC45O1xuICAgICAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24ueSAqPSAtMC45O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHNjb3BlLnZlbG9jaXR5LmNsYW1wQWJzKGFwcC5tYXhTcGVlZCk7XG4gICAgICAgICAgICAkc2NvcGUucG9zaXRpb24uYWRkKCRzY29wZS52ZWxvY2l0eSwgMC4xKTtcbiAgICAgICAgICAgIHNwcml0ZS5wb3NpdGlvbi54ID0gJHNjb3BlLnBvc2l0aW9uLnggLSAoJHNjb3BlLmhhbG9SYWRpdXMgLyAyKTtcbiAgICAgICAgICAgIHNwcml0ZS5wb3NpdGlvbi55ID0gJHNjb3BlLnBvc2l0aW9uLnkgLSAoJHNjb3BlLmhhbG9SYWRpdXMgLyAyKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUuaW5pdCgpO1xuICAgIHJldHVybiAkc2NvcGU7XG59OyIsIi8qKlxuICpcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG5cbnZhciBTdGFyTWFwID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIG1heFN0YXJzKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciB0aHJlc2hvbGQgPSBNYXRoLm1heCgoKHdpZHRoICsgaGVpZ2h0KSAvIDIgKSAvIDQwLCAzMCk7XG4gICAgdmFyIG1heExpbmVzID0gbWF4U3RhcnMgKiA3O1xuICAgIHZhciByZW5kZXJlciA9IFBJWEkuYXV0b0RldGVjdFJlbmRlcmVyKHdpZHRoLCBoZWlnaHQsIHtiYWNrZ3JvdW5kQ29sb3I6IDB4MTYwODMxfSk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci52aWV3KTtcbiAgICB2YXIgc3RhZ2UgPSBuZXcgUElYSS5Db250YWluZXIoKTtcbiAgICB2YXIgam9pbkxpbmVzID0gbmV3IFBJWEkuR3JhcGhpY3MoKTtcbiAgICBqb2luTGluZXMuYmxlbmRNb2RlID0gUElYSS5CTEVORF9NT0RFUy5BREQ7XG4gICAgdmFyIGNvdW50ZXIgPSAkKCc8c3BhbiBjbGFzcz1cImNvdW50ZXJcIj48L3NwYW4+JykuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSk7XG5cbiAgICB2YXIgYmFja2dyb3VuZFRleHR1cmUgPSBuZXcgQ2FudmFzVGV4dHVyZShmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIHZhciBncmQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQod2lkdGggLyAyLCBoZWlnaHQgLyAyLCAxLCB3aWR0aCAvIDIsIGhlaWdodCAvIDIsIGhlaWdodCk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMCwgJ3JnYigyMiw4LDQ5KScpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAuNCwgJ3JnYigyMiw4LDQ5KScpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAuNiwgJ3JnYigxMiw3LDI0KScpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDEsICdyZ2IoMCwwLDApJyk7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmQ7XG4gICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9KTtcblxuICAgIHZhciByZW5kZXJUZXh0dXJlID0gbmV3IFBJWEkuUmVuZGVyVGV4dHVyZShyZW5kZXJlciwgd2lkdGgsIGhlaWdodCk7XG4gICAgdmFyIHJlbmRlclRleHR1cmUyID0gbmV3IFBJWEkuUmVuZGVyVGV4dHVyZShyZW5kZXJlciwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICB2YXIgYmFja2dyb3VuZFNwcml0ZSA9IG5ldyBQSVhJLlNwcml0ZShiYWNrZ3JvdW5kVGV4dHVyZSk7XG4gICAgdmFyIHNoYWRvd1Nwcml0ZSA9IG5ldyBQSVhJLlNwcml0ZShyZW5kZXJUZXh0dXJlKTtcbiAgICB2YXIgY29udm9sdXRpb25GaWx0ZXIgPSBuZXcgUElYSS5maWx0ZXJzLkNvbnZvbHV0aW9uRmlsdGVyKFtcbiAgICAgICAgMC4xLCAwLjQsIDAuMSxcbiAgICAgICAgMC40LCAwLjAsIDAuNCxcbiAgICAgICAgMC4xLCAwLjQsIDAuMVxuICAgIF0sIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgLy9zaGFkb3dTcHJpdGUuYWxwaGEgPSAwLjQ5O1xuICAgIHNoYWRvd1Nwcml0ZS5hbHBoYSA9IDAuNDE7XG4gICAgLy9zaGFkb3dTcHJpdGUuYmxlbmRNb2RlID0gUElYSS5CTEVORF9NT0RFUy5TT0ZUX0xJR0hUO1xuXG4gICAgLyogdmFyIGZpbHRlciA9IG5ldyBQSVhJLmZpbHRlcnMuQ29udm9sdXRpb25GaWx0ZXIoW1xuICAgICAwLjEsMC4xLDAuMSxcbiAgICAgMC4xLDAuMiwwLjEsXG4gICAgIDAuMSwwLjEsMC4xXG4gICAgIF0sd2lkdGgsaGVpZ2h0KTsqL1xuICAgIHNoYWRvd1Nwcml0ZS5maWx0ZXJzID0gW2NvbnZvbHV0aW9uRmlsdGVyXTtcbiAgICBzdGFnZS5hZGRDaGlsZChiYWNrZ3JvdW5kU3ByaXRlKTtcblxuICAgIHZhciBsaW5lQ291bnQsIGpvaW5Db3VudDtcbiAgICB2YXIgdGhyZXNob2xkU3F1YXJlID0gTWF0aC5wb3codGhyZXNob2xkLCAyKTtcbiAgICB2YXIgbW91c2VUaHJlc2hvbGQgPSB0aHJlc2hvbGQgKiAxMDtcbiAgICB2YXIgbW91c2VUaHJlc2hvbGRTcXVhcmUgPSB0aHJlc2hvbGRTcXVhcmUgKiAxMDtcbiAgICB2YXIgJHNjb3BlID0ge1xuICAgICAgICBtYXhTcGVlZDogMTAsXG4gICAgICAgIG1heFN0YXJzOiBtYXhTdGFycyxcbiAgICAgICAgbW91c2U6IG5ldyBWZWN0b3IyKCksXG4gICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgIHN0YWdlOiBzdGFnZSxcbiAgICAgICAgc2hvd0xpbmVzOiB0cnVlLFxuICAgICAgICBqb2luTGluZXM6IGpvaW5MaW5lcyxcbiAgICAgICAgbm9kZXM6IFtdLFxuICAgICAgICBkZWFkTm9kZXM6IFtdLFxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heFN0YXJzOyB4KyspIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkU3RhcihuZXcgVmVjdG9yMihNYXRoLnJhbmRvbSgpICogd2lkdGgsIE1hdGgucmFuZG9tKCkgKiBoZWlnaHQpLCAkc2NvcGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHNjb3BlLm1vdXNlLmJ1dHRvbnMgPSAwO1xuXG4gICAgICAgICAgICBzdGFnZS5hZGRDaGlsZChqb2luTGluZXMpO1xuICAgICAgICAgICAgc3RhZ2UuYWRkQ2hpbGQoc2hhZG93U3ByaXRlKTtcbiAgICAgICAgfSxcbiAgICAgICAgYWRkU3RhcjogZnVuY3Rpb24gKHBvc2l0aW9uKSB7XG4gICAgICAgICAgICB2YXIgcCA9IG5ldyBQYXJ0aWNsZShwb3NpdGlvbiwgJHNjb3BlKTtcbiAgICAgICAgICAgICRzY29wZS5hZGROb2RlKHApO1xuICAgICAgICAgICAgaWYgKCRzY29wZS5ub2Rlcy5sZW5ndGggPiAkc2NvcGUubWF4U3RhcnMpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUua2lsbE5vZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYWRkTm9kZTogZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICRzY29wZS5ub2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICB9LFxuICAgICAgICBjbGVhcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLm5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGUsIGkpIHtcbiAgICAgICAgICAgICAgICBzdGFnZS5yZW1vdmVDaGlsZChub2RlLnNwcml0ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRzY29wZS5ub2RlcyA9IFtdO1xuICAgICAgICB9LFxuICAgICAgICBkZXN0cm95Tm9kZTogZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIHN0YWdlLnJlbW92ZUNoaWxkKG5vZGUuc3ByaXRlKTtcbiAgICAgICAgICAgICRzY29wZS5ub2Rlcy5zcGxpY2UoJHNjb3BlLm5vZGVzLmluZGV4T2Yobm9kZSksIDEpO1xuICAgICAgICB9LFxuICAgICAgICBraWxsTm9kZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGRlYWQgPSAkc2NvcGUubm9kZXMuc2hpZnQoKTtcbiAgICAgICAgICAgICRzY29wZS5kZWFkTm9kZXMucHVzaChkZWFkKTtcbiAgICAgICAgICAgIGRlYWQuZGllKCk7XG4gICAgICAgIH0sXG4gICAgICAgIHRpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBkaXN0YW5jZTtcbiAgICAgICAgICAgIGNvdW50ZXIuaHRtbCgoJHNjb3BlLm5vZGVzLmxlbmd0aCArICRzY29wZS5kZWFkTm9kZXMubGVuZ3RoKSArIFwiIC8gXCIgKyAkc2NvcGUubWF4U3RhcnMpO1xuICAgICAgICAgICAgLy9DdWxsIHRvbyBtYW55IHN0YXJzXG4gICAgICAgICAgICBpZiAoJHNjb3BlLm5vZGVzLmxlbmd0aCA+ICRzY29wZS5tYXhTdGFycykge1xuICAgICAgICAgICAgICAgICRzY29wZS5raWxsTm9kZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaW5lQ291bnQgPSAwO1xuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCRzY29wZS50aWNrKTtcbiAgICAgICAgICAgIGpvaW5MaW5lcy5jbGVhcigpO1xuICAgICAgICAgICAgJHNjb3BlLm5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGUsIGkpIHtcbiAgICAgICAgICAgICAgICAvL1BhcnRpY2xlc1xuICAgICAgICAgICAgICAgIG5vZGUudGljaygpO1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2hvd0xpbmVzICYmIGxpbmVDb3VudCA8IG1heExpbmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGpvaW5Db3VudCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5ub2Rlcy5zbGljZShpKS5mb3JFYWNoKGZ1bmN0aW9uIChqb2luTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmVDb3VudCA+IG1heExpbmVzIHx8IGpvaW5Db3VudCA+IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQyID0gam9pbk5vZGUucG9zaXRpb24uZGlzdGFuY2VTcXVhcmUobm9kZS5wb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZDIgPCB0aHJlc2hvbGRTcXVhcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2luQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IE1hdGguc3FydChkMik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhID0gKCgodGhyZXNob2xkIC0gZGlzdGFuY2UpIC8gdGhyZXNob2xkKSAqIDAuNCkgKyAoTWF0aC5yYW5kb20oKSAqIDAuMDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5saW5lU3R5bGUoYWxwaGEgKiAobm9kZS5yYWRpdXMgKyBqb2luTm9kZS5yYWRpdXMpICogMywgMHgwMGRiZmYsIGFscGhhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubW92ZVRvKG5vZGUucG9zaXRpb24ueCwgbm9kZS5wb3NpdGlvbi55KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubGluZVRvKGpvaW5Ob2RlLnBvc2l0aW9uLngsIGpvaW5Ob2RlLnBvc2l0aW9uLnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvL01vdXNlIGFjdGl2ZVxuICAgICAgICAgICAgICAgIHZhciBtRGlzdDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKCRzY29wZS5tb3VzZS5idXR0b25zKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vUmlnaHQgbW91c2UgLSBjbGVhciBub2RlcyBjbG9zZSB0byB1c1xuICAgICAgICAgICAgICAgICAgICAgICAgbURpc3QgPSBub2RlLnBvc2l0aW9uLmRpc3RhbmNlU3F1YXJlKCRzY29wZS5tb3VzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobURpc3QgPCBtb3VzZVRocmVzaG9sZFNxdWFyZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gTWF0aC5zcXJ0KG1EaXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPCAyMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGVzdHJveU5vZGUobm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgLy9NaWRkbGUgbW91c2UgLSBqb2luIHRvIG1vdXNlXG4gICAgICAgICAgICAgICAgICAgICAgICBtRGlzdCA9IG5vZGUucG9zaXRpb24uZGlzdGFuY2VTcXVhcmUoJHNjb3BlLm1vdXNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtRGlzdCA8IG1vdXNlVGhyZXNob2xkU3F1YXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBNYXRoLnNxcnQobURpc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbHBoYSA9ICgoKG1vdXNlVGhyZXNob2xkIC0gZGlzdGFuY2UpIC8gbW91c2VUaHJlc2hvbGQpICogMC40KSArIChNYXRoLnJhbmRvbSgpICogMC4wNSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLmxpbmVTdHlsZSgxLCAweDAwZGJmZiwgYWxwaGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5tb3ZlVG8obm9kZS5wb3NpdGlvbi54LCBub2RlLnBvc2l0aW9uLnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5saW5lVG8oJHNjb3BlLm1vdXNlLngsICRzY29wZS5tb3VzZS55KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvL0RyYXcgb3VyIGRlYWRub2RlcyBzZXBhcmF0ZWx5ICh0aGV5IGZhZGUgb3V0IGJ1dCBzaG91bGRuJ3QgaGF2ZSBsaW5lcylcbiAgICAgICAgICAgICRzY29wZS5kZWFkTm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZSwgaSkge1xuICAgICAgICAgICAgICAgIG5vZGUudGljaygpO1xuICAgICAgICAgICAgICAgIGlmIChub2RlLnN0YXRlID09IFwiREVBRFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YWdlLnJlbW92ZUNoaWxkKG5vZGUuc3ByaXRlKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRlYWROb2Rlcy5zcGxpY2UoJHNjb3BlLmRlYWROb2Rlcy5pbmRleE9mKG5vZGUpLCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy9SZW5kZXIgc3RhcnMgdG8gdGV4dHVyZSwgYnV0IG1vdmUgaXQgb2Zmc2NyZWVuIChmb3IgbmV4dCBmcmFtZSlcbiAgICAgICAgICAgIGJhY2tncm91bmRTcHJpdGUuYWxwaGEgPSAwO1xuICAgICAgICAgICAgam9pbkxpbmVzLmFscGhhID0gMC4xO1xuICAgICAgICAgICAgcmVuZGVyVGV4dHVyZTIucmVuZGVyKCRzY29wZS5zdGFnZSwgbnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgICBqb2luTGluZXMuYWxwaGEgPSAxO1xuICAgICAgICAgICAgYmFja2dyb3VuZFNwcml0ZS5hbHBoYSA9IDE7XG5cbiAgICAgICAgICAgIC8vQnJpbmcgcHJldmlvdXMgZnJhbWVzIHN0YXJzIG9uc2NyZWVuIGZvciBnbG93c1xuICAgICAgICAgICAgdmFyIHRlbXAgPSByZW5kZXJUZXh0dXJlO1xuICAgICAgICAgICAgcmVuZGVyVGV4dHVyZSA9IHJlbmRlclRleHR1cmUyO1xuICAgICAgICAgICAgcmVuZGVyVGV4dHVyZTIgPSB0ZW1wO1xuICAgICAgICAgICAgc2hhZG93U3ByaXRlLnRleHR1cmUgPSByZW5kZXJUZXh0dXJlO1xuXG4gICAgICAgICAgICByZW5kZXJlci5yZW5kZXIoJHNjb3BlLnN0YWdlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgJHNjb3BlLmluaXQoKTtcbiAgICByZXR1cm4gJHNjb3BlO1xufTsiLCIvKipcbiAqXG4gKiBAYXV0aG9yIEFkYW0gQmVuc29uIDxhZGFtQHByZWNhcmlvdXNwYW50aGVyLm5ldD5cbiAqL1xuXG4vKipcbiAqXG4gKiBAcGFyYW0ge2ludH0gW3hdXG4gKiBAcGFyYW0ge2ludH0gW3ldXG4gKiBAY29uc3RydWN0b3JcbiAqL1xudmFyIFZlY3RvcjIgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBpZiAoIXgpeCA9IDA7XG4gICAgaWYgKCF5KXkgPSAwO1xuICAgIHZhciAkc2NvcGUgPSB7XG4gICAgICAgIHg6IHgsXG4gICAgICAgIHk6IHksXG4gICAgICAgIGFkZDogZnVuY3Rpb24gKHZlY3Rvciwgc2NhbGUpIHtcbiAgICAgICAgICAgIHNjYWxlID0gc2NhbGUgfHwgMTtcbiAgICAgICAgICAgICRzY29wZS54ICs9IHZlY3Rvci54ICogc2NhbGU7XG4gICAgICAgICAgICAkc2NvcGUueSArPSB2ZWN0b3IueSAqIHNjYWxlO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICAgICAgJHNjb3BlLnggPSB4O1xuICAgICAgICAgICAgJHNjb3BlLnkgPSB5O1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2NhbGU6IGZ1bmN0aW9uIChtdWx0aXBsaWVyKSB7XG4gICAgICAgICAgICAkc2NvcGUueCAqPSBtdWx0aXBsaWVyO1xuICAgICAgICAgICAgJHNjb3BlLnkgKj0gbXVsdGlwbGllcjtcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGU7XG4gICAgICAgIH0sXG4gICAgICAgIGNsYW1wOiBmdW5jdGlvbiAobWluLCBtYXgpIHtcbiAgICAgICAgICAgICRzY29wZS54ID0gTWF0aC5taW4oTWF0aC5tYXgoJHNjb3BlLngsIG1pbiksIG1heCk7XG4gICAgICAgICAgICAkc2NvcGUueSA9IE1hdGgubWluKE1hdGgubWF4KCRzY29wZS55LCBtaW4pLCBtYXgpO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgY2xhbXBBYnM6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICRzY29wZS5jbGFtcCgtdmFsLCB2YWwpO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgZGlzdGFuY2U6IGZ1bmN0aW9uICh2ZWN0b3IpIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQoJHNjb3BlLmRpc3RhbmNlU3F1YXJlKHZlY3RvcikpO1xuICAgICAgICB9LFxuICAgICAgICBkaXN0YW5jZVNxdWFyZTogZnVuY3Rpb24gKHZlY3Rvcikge1xuICAgICAgICAgICAgdmFyIGRYID0gTWF0aC5wb3codmVjdG9yLnggLSAkc2NvcGUueCwgMik7XG4gICAgICAgICAgICB2YXIgZFkgPSBNYXRoLnBvdyh2ZWN0b3IueSAtICRzY29wZS55LCAyKTtcbiAgICAgICAgICAgIHJldHVybiBkWCArIGRZO1xuICAgICAgICB9XG5cbiAgICB9O1xuICAgIHJldHVybiAkc2NvcGU7XG59OyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
