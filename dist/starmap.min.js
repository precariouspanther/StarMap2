var CanvasTexture=function(cb){var canvas=document.createElement("canvas");return"function"==typeof cb&&cb(canvas),PIXI.Texture.fromCanvas(canvas)},Particle=function(position,app){"use strict";var sprite=new PIXI.Sprite;sprite.blendMode=PIXI.BLEND_MODES.SCREEN,app.stage.addChild(sprite);var state={ALIVE:"ALIVE",DYING:"DYING",DEAD:"DEAD"},$scope={alpha:1,state:state.ALIVE,sprite:sprite,stage:app,radius:0,haloRadius:0,colour:{red:255,green:255,blue:255},acceleration:new Vector2,velocity:new Vector2(Math.random()-.5,Math.random()-.5),position:position,init:function(){$scope.radius=1.1*Math.random()+1,Math.random()>.7&&($scope.colour.red=Math.round(100*Math.random()+55),$scope.colour.green=Math.round(100*Math.random()+55),$scope.colour.blue=255),$scope.createTexture($scope.radius)},createTexture:function(radius){$scope.haloRadius=Math.ceil(20*radius),sprite.texture=new CanvasTexture(function(canvas){canvas.width=$scope.haloRadius,canvas.height=$scope.haloRadius;var ctx=canvas.getContext("2d");ctx.fillStyle="rgb("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+")",ctx.beginPath(),ctx.arc($scope.haloRadius/2,$scope.haloRadius/2,radius,0,360,!1),ctx.fill();var grd=ctx.createRadialGradient($scope.haloRadius/2,$scope.haloRadius/2,radius,$scope.haloRadius/2,$scope.haloRadius/2,Math.ceil($scope.haloRadius));grd.addColorStop(0,"rgba("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+",0.05)"),grd.addColorStop(.3,"rgba("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+",0)"),ctx.fillStyle=grd,ctx.beginPath(),ctx.arc($scope.haloRadius/2,$scope.haloRadius/2,$scope.haloRadius,0,360,!1)})},die:function(){$scope.state=state.DYING},tick:function(){if($scope.state!=state.DYING)sprite.alpha=.4*Math.random()+.6,$scope.acceleration.set(Math.random()-.5,Math.random()-.5).scale(app.maxSpeed),$scope.acceleration.clampAbs(app.maxSpeed),$scope.velocity.add($scope.acceleration,.1),($scope.position.x+$scope.velocity.x>window.innerWidth||$scope.position.x+$scope.velocity.x<1)&&($scope.velocity.x*=-.9,$scope.acceleration.x*=-.9),($scope.position.y+$scope.velocity.y>window.innerHeight||$scope.position.y+$scope.velocity.y<1)&&($scope.velocity.y*=-.9,$scope.acceleration.y*=-.9),$scope.velocity.clampAbs(app.maxSpeed),$scope.position.add($scope.velocity,.1),sprite.position.x=$scope.position.x-$scope.haloRadius/2,sprite.position.y=$scope.position.y-$scope.haloRadius/2;else if($scope.alpha-=.01,sprite.alpha=$scope.alpha,$scope.alpha<=0)return void($scope.state=state.DEAD)}};return $scope.init(),$scope},StarMap=function(width,height,maxStars){"use strict";var threshold=(width+height)/2/20,maxLines=7*maxStars,renderer=PIXI.autoDetectRenderer(width,height,{backgroundColor:1443889});document.body.appendChild(renderer.view);var stage=new PIXI.Container,joinLines=new PIXI.Graphics;joinLines.blendMode=PIXI.BLEND_MODES.ADD;var backgroundTexture=new CanvasTexture(function(canvas){canvas.width=width,canvas.height=height;var ctx=canvas.getContext("2d"),grd=ctx.createRadialGradient(width/2,height/2,1,width/2,height/2,height);grd.addColorStop(0,"rgb(22,8,49)"),grd.addColorStop(.4,"rgb(22,8,49)"),grd.addColorStop(.6,"rgb(12,7,24)"),grd.addColorStop(1,"rgb(0,0,0)"),ctx.fillStyle=grd,ctx.fillRect(0,0,width,height)}),renderTexture=new PIXI.RenderTexture(renderer,width,height),renderTexture2=new PIXI.RenderTexture(renderer,width,height),backgroundSprite=new PIXI.Sprite(backgroundTexture),shadowSprite=new PIXI.Sprite(renderTexture),convolutionFilter=new PIXI.filters.ConvolutionFilter([.1,.4,.1,.4,0,.4,.1,.4,.1],width,height);shadowSprite.alpha=.41,shadowSprite.filters=[convolutionFilter],stage.addChild(backgroundSprite);var lineCount,thresholdSquare=Math.pow(threshold,2),mouseThreshold=10*threshold,mouseThresholdSquare=10*thresholdSquare,$scope={maxSpeed:10,mouse:new Vector2,width:width,height:height,stage:stage,joinLines:joinLines,nodes:[],deadNodes:[],init:function(){for(var x=0;maxStars>x;x++)$scope.addStar(new Vector2(Math.random()*width,Math.random()*height),$scope);$scope.mouse.active=!1,stage.addChild(joinLines),stage.addChild(shadowSprite)},addStar:function(position){var p=new Particle(position,$scope);$scope.addNode(p),$scope.nodes.length>maxStars&&$scope.killNode()},addNode:function(node){$scope.nodes.push(node)},killNode:function(){var dead=$scope.nodes.shift();$scope.deadNodes.push(dead),dead.die()},tick:function(){var distance;$scope.nodes.length>maxStars&&$scope.killNode(),lineCount=0,requestAnimationFrame($scope.tick),joinLines.clear(),$scope.nodes.forEach(function(node,i){if(node.tick(),maxLines>lineCount&&$scope.nodes.slice(i).forEach(function(joinNode){if(!(lineCount>maxLines)){var d2=joinNode.position.distanceSquare(node.position);if(thresholdSquare>d2){lineCount++,distance=Math.sqrt(d2);var alpha=(threshold-distance)/threshold*.4+.05*Math.random();joinLines.lineStyle(alpha*(node.radius+joinNode.radius)*3,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo(joinNode.position.x,joinNode.position.y)}}}),$scope.mouse.active){var mDist=node.position.distanceSquare($scope.mouse);if(mouseThresholdSquare>mDist){distance=Math.sqrt(mDist);var alpha=(mouseThreshold-distance)/mouseThreshold*.4+.05*Math.random();joinLines.lineStyle(1,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo($scope.mouse.x,$scope.mouse.y)}}}),$scope.deadNodes.forEach(function(node,i){node.tick(),"DEAD"==node.state&&(stage.removeChild(node.sprite),$scope.deadNodes.splice($scope.deadNodes.indexOf(node),1))}),backgroundSprite.alpha=0,joinLines.alpha=.1,renderTexture2.render($scope.stage,null,!0),joinLines.alpha=1,backgroundSprite.alpha=1;var temp=renderTexture;renderTexture=renderTexture2,renderTexture2=temp,shadowSprite.texture=renderTexture,renderer.render($scope.stage)}};return $scope.init(),$scope},Vector2=function(x,y){"use strict";x||(x=0),y||(y=0);var $scope={x:x,y:y,add:function(vector,scale){return scale=scale||1,$scope.x+=vector.x*scale,$scope.y+=vector.y*scale,$scope},set:function(x,y){return $scope.x=x,$scope.y=y,$scope},scale:function(multiplier){return $scope.x*=multiplier,$scope.y*=multiplier,$scope},clamp:function(min,max){return $scope.x=Math.min(Math.max($scope.x,min),max),$scope.y=Math.min(Math.max($scope.y,min),max),$scope},clampAbs:function(val){return $scope.clamp(-val,val),$scope},distance:function(vector){return Math.sqrt($scope.distanceSquare(vector))},distanceSquare:function(vector){var dX=Math.pow(vector.x-$scope.x,2),dY=Math.pow(vector.y-$scope.y,2);return dX+dY}};return $scope};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhbnZhc1RleHR1cmUuanMiLCJQYXJ0aWNsZS5qcyIsIlN0YXJNYXAuanMiLCJWZWN0b3IyLmpzIl0sIm5hbWVzIjpbIkNhbnZhc1RleHR1cmUiLCJjYiIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsIlBJWEkiLCJUZXh0dXJlIiwiZnJvbUNhbnZhcyIsIlBhcnRpY2xlIiwicG9zaXRpb24iLCJhcHAiLCJzcHJpdGUiLCJTcHJpdGUiLCJibGVuZE1vZGUiLCJCTEVORF9NT0RFUyIsIlNDUkVFTiIsInN0YWdlIiwiYWRkQ2hpbGQiLCJzdGF0ZSIsIkFMSVZFIiwiRFlJTkciLCJERUFEIiwiJHNjb3BlIiwiYWxwaGEiLCJyYWRpdXMiLCJoYWxvUmFkaXVzIiwiY29sb3VyIiwicmVkIiwiZ3JlZW4iLCJibHVlIiwiYWNjZWxlcmF0aW9uIiwiVmVjdG9yMiIsInZlbG9jaXR5IiwiTWF0aCIsInJhbmRvbSIsImluaXQiLCJyb3VuZCIsImNyZWF0ZVRleHR1cmUiLCJjZWlsIiwidGV4dHVyZSIsIndpZHRoIiwiaGVpZ2h0IiwiY3R4IiwiZ2V0Q29udGV4dCIsImZpbGxTdHlsZSIsImJlZ2luUGF0aCIsImFyYyIsImZpbGwiLCJncmQiLCJjcmVhdGVSYWRpYWxHcmFkaWVudCIsImFkZENvbG9yU3RvcCIsImRpZSIsInRpY2siLCJzZXQiLCJzY2FsZSIsIm1heFNwZWVkIiwiY2xhbXBBYnMiLCJhZGQiLCJ4Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsInkiLCJpbm5lckhlaWdodCIsIlN0YXJNYXAiLCJtYXhTdGFycyIsInRocmVzaG9sZCIsIm1heExpbmVzIiwicmVuZGVyZXIiLCJhdXRvRGV0ZWN0UmVuZGVyZXIiLCJiYWNrZ3JvdW5kQ29sb3IiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJ2aWV3IiwiQ29udGFpbmVyIiwiam9pbkxpbmVzIiwiR3JhcGhpY3MiLCJBREQiLCJiYWNrZ3JvdW5kVGV4dHVyZSIsImZpbGxSZWN0IiwicmVuZGVyVGV4dHVyZSIsIlJlbmRlclRleHR1cmUiLCJyZW5kZXJUZXh0dXJlMiIsImJhY2tncm91bmRTcHJpdGUiLCJzaGFkb3dTcHJpdGUiLCJjb252b2x1dGlvbkZpbHRlciIsImZpbHRlcnMiLCJDb252b2x1dGlvbkZpbHRlciIsImxpbmVDb3VudCIsInRocmVzaG9sZFNxdWFyZSIsInBvdyIsIm1vdXNlVGhyZXNob2xkIiwibW91c2VUaHJlc2hvbGRTcXVhcmUiLCJtb3VzZSIsIm5vZGVzIiwiZGVhZE5vZGVzIiwiYWRkU3RhciIsImFjdGl2ZSIsInAiLCJhZGROb2RlIiwibGVuZ3RoIiwia2lsbE5vZGUiLCJub2RlIiwicHVzaCIsImRlYWQiLCJzaGlmdCIsImRpc3RhbmNlIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiY2xlYXIiLCJmb3JFYWNoIiwiaSIsInNsaWNlIiwiam9pbk5vZGUiLCJkMiIsImRpc3RhbmNlU3F1YXJlIiwic3FydCIsImxpbmVTdHlsZSIsIm1vdmVUbyIsImxpbmVUbyIsIm1EaXN0IiwicmVtb3ZlQ2hpbGQiLCJzcGxpY2UiLCJpbmRleE9mIiwicmVuZGVyIiwidGVtcCIsInZlY3RvciIsIm11bHRpcGxpZXIiLCJjbGFtcCIsIm1pbiIsIm1heCIsInZhbCIsImRYIiwiZFkiXSwibWFwcGluZ3MiOiJBQU9BLEdBQUFBLGVBQUEsU0FBQUMsSUFDQSxHQUFBQyxRQUFBQyxTQUFBQyxjQUFBLFNBRUEsT0FEQSxrQkFBQUgsS0FBQUEsR0FBQUMsUUFDQUcsS0FBQUMsUUFBQUMsV0FBQUwsU0NMQU0sU0FBQSxTQUFBQyxTQUFBQyxLQUNBLFlBRUEsSUFBQUMsUUFBQSxHQUFBTixNQUFBTyxNQUVBRCxRQUFBRSxVQUFBUixLQUFBUyxZQUFBQyxPQUNBTCxJQUFBTSxNQUFBQyxTQUFBTixPQUVBLElBQUFPLFFBQ0FDLE1BQUEsUUFDQUMsTUFBQSxRQUNBQyxLQUFBLFFBSUFDLFFBQ0FDLE1BQUEsRUFDQUwsTUFBQUEsTUFBQUMsTUFDQVIsT0FBQUEsT0FDQUssTUFBQU4sSUFDQWMsT0FBQSxF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RUFYLGVBQUEsU0FBQVcsUUFDQSxHQUFBTSxJQUFBakcsS0FBQXdELElBQUFtQyxPQUFBbEUsRUFBQXBDLE9BQUFvQyxFQUFBLEdBQ0F5RSxHQUFBbEcsS0FBQXdELElBQUFtQyxPQUFBL0QsRUFBQXZDLE9BQUF1QyxFQUFBLEVBQ0EsT0FBQXFFLElBQUFDLElBSUEsT0FBQTdHIiwiZmlsZSI6InN0YXJtYXAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKlxuICogQHBhcmFtIGNiXG4gKiBAcmV0dXJucyB7UElYSS5CYXNlVGV4dHVyZXxQSVhJLlRleHR1cmV9XG4gKiBAY29uc3RydWN0b3JcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG52YXIgQ2FudmFzVGV4dHVyZSA9IGZ1bmN0aW9uIChjYikge1xuICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICBpZiAodHlwZW9mIGNiID09ICdmdW5jdGlvbicpIGNiKGNhbnZhcyk7XG4gICAgcmV0dXJuIFBJWEkuVGV4dHVyZS5mcm9tQ2FudmFzKGNhbnZhcyk7XG59OyIsIi8qKlxuICpcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG5cbnZhciBQYXJ0aWNsZSA9IGZ1bmN0aW9uIChwb3NpdGlvbiwgYXBwKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHNwcml0ZSA9IG5ldyBQSVhJLlNwcml0ZSgpO1xuXG4gICAgc3ByaXRlLmJsZW5kTW9kZSA9IFBJWEkuQkxFTkRfTU9ERVMuU0NSRUVOO1xuICAgIGFwcC5zdGFnZS5hZGRDaGlsZChzcHJpdGUpO1xuXG4gICAgdmFyIHN0YXRlID0ge1xuICAgICAgICBBTElWRTogXCJBTElWRVwiLFxuICAgICAgICBEWUlORzogXCJEWUlOR1wiLFxuICAgICAgICBERUFEOiBcIkRFQURcIlxuICAgIH07XG5cbiAgICAvL2FwcC5zdGFnZS5hZGRDaGlsZChqb2luTGluZXMpO1xuICAgIHZhciAkc2NvcGUgPSB7XG4gICAgICAgIGFscGhhOiAxLFxuICAgICAgICBzdGF0ZTogc3RhdGUuQUxJVkUsXG4gICAgICAgIHNwcml0ZTogc3ByaXRlLFxuICAgICAgICBzdGFnZTogYXBwLFxuICAgICAgICByYWRpdXM6IDAsXG4gICAgICAgIGhhbG9SYWRpdXM6IDAsXG4gICAgICAgIGNvbG91cjoge1xuICAgICAgICAgICAgcmVkOiAyNTUsXG4gICAgICAgICAgICBncmVlbjogMjU1LFxuICAgICAgICAgICAgYmx1ZTogMjU1XG4gICAgICAgIH0sXG4gICAgICAgIGFjY2VsZXJhdGlvbjogbmV3IFZlY3RvcjIoKSxcbiAgICAgICAgdmVsb2NpdHk6IG5ldyBWZWN0b3IyKE1hdGgucmFuZG9tKCkgLSAwLjUsIE1hdGgucmFuZG9tKCkgLSAwLjUpLFxuICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5yYWRpdXMgPSBNYXRoLnJhbmRvbSgpICogMS4xICsgMTtcbiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC43KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbG91ci5yZWQgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMDAgKyA1NSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbG91ci5ncmVlbiA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDEwMCArIDU1KTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29sb3VyLmJsdWUgPSAyNTU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUuY3JlYXRlVGV4dHVyZSgkc2NvcGUucmFkaXVzKTtcbiAgICAgICAgfSxcbiAgICAgICAgY3JlYXRlVGV4dHVyZTogZnVuY3Rpb24gKHJhZGl1cykge1xuICAgICAgICAgICAgJHNjb3BlLmhhbG9SYWRpdXMgPSBNYXRoLmNlaWwocmFkaXVzICogMjApO1xuICAgICAgICAgICAgc3ByaXRlLnRleHR1cmUgPSBuZXcgQ2FudmFzVGV4dHVyZShmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gJHNjb3BlLmhhbG9SYWRpdXM7XG4gICAgICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9ICRzY29wZS5oYWxvUmFkaXVzO1xuICAgICAgICAgICAgICAgIC8vQ29yZVxuICAgICAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYignICsgJHNjb3BlLmNvbG91ci5yZWQgKyAnLCcgKyAkc2NvcGUuY29sb3VyLmdyZWVuICsgJywnICsgJHNjb3BlLmNvbG91ci5ibHVlICsgJyknO1xuICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICBjdHguYXJjKCRzY29wZS5oYWxvUmFkaXVzIC8gMiwgJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCByYWRpdXMsIDAsIDM2MCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7XG4gICAgICAgICAgICAgICAgLy9IYWxvXG4gICAgICAgICAgICAgICAgdmFyIGdyZCA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudCgkc2NvcGUuaGFsb1JhZGl1cyAvIDIsICRzY29wZS5oYWxvUmFkaXVzIC8gMiwgcmFkaXVzLCAkc2NvcGUuaGFsb1JhZGl1cyAvIDIsICRzY29wZS5oYWxvUmFkaXVzIC8gMiwgTWF0aC5jZWlsKCRzY29wZS5oYWxvUmFkaXVzKSk7XG4gICAgICAgICAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLCAncmdiYSgnICsgJHNjb3BlLmNvbG91ci5yZWQgKyAnLCcgKyAkc2NvcGUuY29sb3VyLmdyZWVuICsgJywnICsgJHNjb3BlLmNvbG91ci5ibHVlICsgJywnICsgMC4wNSArICcpJyk7XG4gICAgICAgICAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLjMsICdyZ2JhKCcgKyAkc2NvcGUuY29sb3VyLnJlZCArICcsJyArICRzY29wZS5jb2xvdXIuZ3JlZW4gKyAnLCcgKyAkc2NvcGUuY29sb3VyLmJsdWUgKyAnLDApJyk7XG5cbiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZ3JkO1xuICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICBjdHguYXJjKCRzY29wZS5oYWxvUmFkaXVzIC8gMiwgJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCAkc2NvcGUuaGFsb1JhZGl1cywgMCwgMzYwLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgLy9jdHguZmlsbCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRpZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy9UcmlnZ2VyIGZhZGVcbiAgICAgICAgICAgICRzY29wZS5zdGF0ZSA9IHN0YXRlLkRZSU5HO1xuICAgICAgICB9LFxuICAgICAgICB0aWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLnN0YXRlID09IHN0YXRlLkRZSU5HKSB7XG4gICAgICAgICAgICAgICAgLy9EeWluZ1xuICAgICAgICAgICAgICAgICRzY29wZS5hbHBoYSAtPSAwLjAxO1xuICAgICAgICAgICAgICAgIHNwcml0ZS5hbHBoYSA9ICRzY29wZS5hbHBoYTtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFscGhhIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN0YXRlID0gc3RhdGUuREVBRDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy9Ud2lua2xlXG4gICAgICAgICAgICAgICAgc3ByaXRlLmFscGhhID0gTWF0aC5yYW5kb20oKSAqIDAuNCArIDAuNjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vTW92ZVxuICAgICAgICAgICAgJHNjb3BlLmFjY2VsZXJhdGlvbi5zZXQoTWF0aC5yYW5kb20oKSAtIDAuNSwgTWF0aC5yYW5kb20oKSAtIDAuNSkuc2NhbGUoYXBwLm1heFNwZWVkKTtcbiAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24uY2xhbXBBYnMoYXBwLm1heFNwZWVkKTtcblxuICAgICAgICAgICAgJHNjb3BlLnZlbG9jaXR5LmFkZCgkc2NvcGUuYWNjZWxlcmF0aW9uLCAwLjEpO1xuXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnBvc2l0aW9uLnggKyAkc2NvcGUudmVsb2NpdHkueCA+IHdpbmRvdy5pbm5lcldpZHRoIHx8ICRzY29wZS5wb3NpdGlvbi54ICsgJHNjb3BlLnZlbG9jaXR5LnggPCAxKSB7XG4gICAgICAgICAgICAgICAgLy9Cb3VuY2UgWFxuICAgICAgICAgICAgICAgICRzY29wZS52ZWxvY2l0eS54ICo9IC0wLjk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFjY2VsZXJhdGlvbi54ICo9IC0wLjk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgkc2NvcGUucG9zaXRpb24ueSArICRzY29wZS52ZWxvY2l0eS55ID4gd2luZG93LmlubmVySGVpZ2h0IHx8ICRzY29wZS5wb3NpdGlvbi55ICsgJHNjb3BlLnZlbG9jaXR5LnkgPCAxKSB7XG4gICAgICAgICAgICAgICAgLy9Cb3VuY2UgWVxuICAgICAgICAgICAgICAgICRzY29wZS52ZWxvY2l0eS55ICo9IC0wLjk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFjY2VsZXJhdGlvbi55ICo9IC0wLjk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUudmVsb2NpdHkuY2xhbXBBYnMoYXBwLm1heFNwZWVkKTtcbiAgICAgICAgICAgICRzY29wZS5wb3NpdGlvbi5hZGQoJHNjb3BlLnZlbG9jaXR5LCAwLjEpO1xuICAgICAgICAgICAgc3ByaXRlLnBvc2l0aW9uLnggPSAkc2NvcGUucG9zaXRpb24ueCAtICgkc2NvcGUuaGFsb1JhZGl1cyAvIDIpO1xuICAgICAgICAgICAgc3ByaXRlLnBvc2l0aW9uLnkgPSAkc2NvcGUucG9zaXRpb24ueSAtICgkc2NvcGUuaGFsb1JhZGl1cyAvIDIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5pbml0KCk7XG4gICAgcmV0dXJuICRzY29wZTtcbn07IiwiLyoqXG4gKlxuICogQGF1dGhvciBBZGFtIEJlbnNvbiA8YWRhbUBwcmVjYXJpb3VzcGFudGhlci5uZXQ+XG4gKi9cblxudmFyIFN0YXJNYXAgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgbWF4U3RhcnMpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIHRocmVzaG9sZCA9ICgod2lkdGggKyBoZWlnaHQpIC8gMiApIC8gMjA7XG4gICAgdmFyIG1heExpbmVzID0gbWF4U3RhcnMgKiA3O1xuICAgIHZhciByZW5kZXJlciA9IFBJWEkuYXV0b0RldGVjdFJlbmRlcmVyKHdpZHRoLCBoZWlnaHQsIHtiYWNrZ3JvdW5kQ29sb3I6IDB4MTYwODMxfSk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci52aWV3KTtcbiAgICB2YXIgc3RhZ2UgPSBuZXcgUElYSS5Db250YWluZXIoKTtcbiAgICB2YXIgam9pbkxpbmVzID0gbmV3IFBJWEkuR3JhcGhpY3MoKTtcbiAgICBqb2luTGluZXMuYmxlbmRNb2RlID0gUElYSS5CTEVORF9NT0RFUy5BREQ7XG5cbiAgICB2YXIgYmFja2dyb3VuZFRleHR1cmUgPSBuZXcgQ2FudmFzVGV4dHVyZShmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIHZhciBncmQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQod2lkdGggLyAyLCBoZWlnaHQgLyAyLCAxLCB3aWR0aCAvIDIsIGhlaWdodCAvIDIsIGhlaWdodCk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMCwgJ3JnYigyMiw4LDQ5KScpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAuNCwgJ3JnYigyMiw4LDQ5KScpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAuNiwgJ3JnYigxMiw3LDI0KScpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDEsICdyZ2IoMCwwLDApJyk7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmQ7XG4gICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9KTtcblxuICAgIHZhciByZW5kZXJUZXh0dXJlID0gbmV3IFBJWEkuUmVuZGVyVGV4dHVyZShyZW5kZXJlciwgd2lkdGgsIGhlaWdodCk7XG4gICAgdmFyIHJlbmRlclRleHR1cmUyID0gbmV3IFBJWEkuUmVuZGVyVGV4dHVyZShyZW5kZXJlciwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICB2YXIgYmFja2dyb3VuZFNwcml0ZSA9IG5ldyBQSVhJLlNwcml0ZShiYWNrZ3JvdW5kVGV4dHVyZSk7XG4gICAgdmFyIHNoYWRvd1Nwcml0ZSA9IG5ldyBQSVhJLlNwcml0ZShyZW5kZXJUZXh0dXJlKTtcbiAgICB2YXIgY29udm9sdXRpb25GaWx0ZXIgPSBuZXcgUElYSS5maWx0ZXJzLkNvbnZvbHV0aW9uRmlsdGVyKFtcbiAgICAgICAgMC4xLCAwLjQsIDAuMSxcbiAgICAgICAgMC40LCAwLjAsIDAuNCxcbiAgICAgICAgMC4xLCAwLjQsIDAuMVxuICAgIF0sIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgLy9zaGFkb3dTcHJpdGUuYWxwaGEgPSAwLjQ5O1xuICAgIHNoYWRvd1Nwcml0ZS5hbHBoYSA9IDAuNDE7XG4gICAgLy9zaGFkb3dTcHJpdGUuYmxlbmRNb2RlID0gUElYSS5CTEVORF9NT0RFUy5TT0ZUX0xJR0hUO1xuXG4gICAgLyogdmFyIGZpbHRlciA9IG5ldyBQSVhJLmZpbHRlcnMuQ29udm9sdXRpb25GaWx0ZXIoW1xuICAgICAwLjEsMC4xLDAuMSxcbiAgICAgMC4xLDAuMiwwLjEsXG4gICAgIDAuMSwwLjEsMC4xXG4gICAgIF0sd2lkdGgsaGVpZ2h0KTsqL1xuICAgIHNoYWRvd1Nwcml0ZS5maWx0ZXJzID0gW2NvbnZvbHV0aW9uRmlsdGVyXTtcbiAgICAvL3NoYWRvd1Nwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLk9WRVJMQVk7XG4gICAgLy9zaGFkb3dTcHJpdGUuYmxlbmRNb2RlID0gUElYSS5CTEVORF9NT0RFUy5BREQ7XG4gICAgLy9zaGFkb3dTcHJpdGUuYmxlbmRNb2RlID0gUElYSS5CTEVORF9NT0RFUy5TT0ZUX0xJR0hUO1xuICAgIHN0YWdlLmFkZENoaWxkKGJhY2tncm91bmRTcHJpdGUpO1xuXG4gICAgdmFyIGxpbmVDb3VudDtcbiAgICB2YXIgdGhyZXNob2xkU3F1YXJlID0gTWF0aC5wb3codGhyZXNob2xkLCAyKTtcbiAgICB2YXIgbW91c2VUaHJlc2hvbGQgPSB0aHJlc2hvbGQgKiAxMDtcbiAgICB2YXIgbW91c2VUaHJlc2hvbGRTcXVhcmUgPSB0aHJlc2hvbGRTcXVhcmUgKiAxMDtcbiAgICB2YXIgJHNjb3BlID0ge1xuICAgICAgICBtYXhTcGVlZDogMTAsXG4gICAgICAgIG1vdXNlOiBuZXcgVmVjdG9yMigpLFxuICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICBzdGFnZTogc3RhZ2UsXG4gICAgICAgIGpvaW5MaW5lczogam9pbkxpbmVzLFxuICAgICAgICBub2RlczogW10sXG4gICAgICAgIGRlYWROb2RlczogW10sXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgbWF4U3RhcnM7IHgrKykge1xuICAgICAgICAgICAgICAgICRzY29wZS5hZGRTdGFyKG5ldyBWZWN0b3IyKE1hdGgucmFuZG9tKCkgKiB3aWR0aCwgTWF0aC5yYW5kb20oKSAqIGhlaWdodCksICRzY29wZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUubW91c2UuYWN0aXZlID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHN0YWdlLmFkZENoaWxkKGpvaW5MaW5lcyk7XG4gICAgICAgICAgICBzdGFnZS5hZGRDaGlsZChzaGFkb3dTcHJpdGUpO1xuICAgICAgICB9LFxuICAgICAgICBhZGRTdGFyOiBmdW5jdGlvbiAocG9zaXRpb24pIHtcbiAgICAgICAgICAgIHZhciBwID0gbmV3IFBhcnRpY2xlKHBvc2l0aW9uLCAkc2NvcGUpO1xuICAgICAgICAgICAgJHNjb3BlLmFkZE5vZGUocCk7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLm5vZGVzLmxlbmd0aCA+IG1heFN0YXJzKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmtpbGxOb2RlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGFkZE5vZGU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAkc2NvcGUubm9kZXMucHVzaChub2RlKTtcbiAgICAgICAgfSxcbiAgICAgICAga2lsbE5vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBkZWFkID0gJHNjb3BlLm5vZGVzLnNoaWZ0KCk7XG4gICAgICAgICAgICAkc2NvcGUuZGVhZE5vZGVzLnB1c2goZGVhZCk7XG4gICAgICAgICAgICBkZWFkLmRpZSgpO1xuICAgICAgICB9LFxuICAgICAgICB0aWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGlzdGFuY2U7XG5cbiAgICAgICAgICAgIC8vQ3VsbCB0b28gbWFueSBzdGFyc1xuICAgICAgICAgICAgaWYgKCRzY29wZS5ub2Rlcy5sZW5ndGggPiBtYXhTdGFycykge1xuICAgICAgICAgICAgICAgICRzY29wZS5raWxsTm9kZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaW5lQ291bnQgPSAwO1xuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCRzY29wZS50aWNrKTtcbiAgICAgICAgICAgIGpvaW5MaW5lcy5jbGVhcigpO1xuICAgICAgICAgICAgJHNjb3BlLm5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGUsIGkpIHtcbiAgICAgICAgICAgICAgICAvL1BhcnRpY2xlc1xuICAgICAgICAgICAgICAgIG5vZGUudGljaygpO1xuICAgICAgICAgICAgICAgIGlmIChsaW5lQ291bnQgPCBtYXhMaW5lcykge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubm9kZXMuc2xpY2UoaSkuZm9yRWFjaChmdW5jdGlvbiAoam9pbk5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsaW5lQ291bnQgPiBtYXhMaW5lcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkMiA9IGpvaW5Ob2RlLnBvc2l0aW9uLmRpc3RhbmNlU3F1YXJlKG5vZGUucG9zaXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQyIDwgdGhyZXNob2xkU3F1YXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBNYXRoLnNxcnQoZDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbHBoYSA9ICgoKHRocmVzaG9sZCAtIGRpc3RhbmNlKSAvIHRocmVzaG9sZCkgKiAwLjQpICsgKE1hdGgucmFuZG9tKCkgKiAwLjA1KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubGluZVN0eWxlKGFscGhhICogKG5vZGUucmFkaXVzICsgam9pbk5vZGUucmFkaXVzKSAqIDMsIDB4MDBkYmZmLCBhbHBoYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLm1vdmVUbyhub2RlLnBvc2l0aW9uLngsIG5vZGUucG9zaXRpb24ueSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLmxpbmVUbyhqb2luTm9kZS5wb3NpdGlvbi54LCBqb2luTm9kZS5wb3NpdGlvbi55KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9Nb3VzZSBhY3RpdmVcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm1vdXNlLmFjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbURpc3QgPSBub2RlLnBvc2l0aW9uLmRpc3RhbmNlU3F1YXJlKCRzY29wZS5tb3VzZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtRGlzdCA8IG1vdXNlVGhyZXNob2xkU3F1YXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IE1hdGguc3FydChtRGlzdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxwaGEgPSAoKChtb3VzZVRocmVzaG9sZCAtIGRpc3RhbmNlKSAvIG1vdXNlVGhyZXNob2xkKSAqIDAuNCkgKyAoTWF0aC5yYW5kb20oKSAqIDAuMDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLmxpbmVTdHlsZSgxLCAweDAwZGJmZiwgYWxwaGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLm1vdmVUbyhub2RlLnBvc2l0aW9uLngsIG5vZGUucG9zaXRpb24ueSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubGluZVRvKCRzY29wZS5tb3VzZS54LCAkc2NvcGUubW91c2UueSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vRHJhdyBvdXIgZGVhZG5vZGVzIHNlcGFyYXRlbHkgKHRoZXkgZmFkZSBvdXQgYnV0IHNob3VsZG4ndCBoYXZlIGxpbmVzKVxuICAgICAgICAgICAgJHNjb3BlLmRlYWROb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUsaSl7XG4gICAgICAgICAgICAgICAgbm9kZS50aWNrKCk7XG4gICAgICAgICAgICAgICAgaWYobm9kZS5zdGF0ZSA9PSBcIkRFQURcIil7XG4gICAgICAgICAgICAgICAgICAgIHN0YWdlLnJlbW92ZUNoaWxkKG5vZGUuc3ByaXRlKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRlYWROb2Rlcy5zcGxpY2UoJHNjb3BlLmRlYWROb2Rlcy5pbmRleE9mKG5vZGUpLCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy9SZW5kZXIgc3RhcnMgdG8gdGV4dHVyZSwgYnV0IG1vdmUgaXQgb2Zmc2NyZWVuIChmb3IgbmV4dCBmcmFtZSlcbiAgICAgICAgICAgIGJhY2tncm91bmRTcHJpdGUuYWxwaGEgPSAwO1xuICAgICAgICAgICAgam9pbkxpbmVzLmFscGhhID0gMC4xO1xuICAgICAgICAgICAgcmVuZGVyVGV4dHVyZTIucmVuZGVyKCRzY29wZS5zdGFnZSwgbnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgICBqb2luTGluZXMuYWxwaGEgPSAxO1xuICAgICAgICAgICAgYmFja2dyb3VuZFNwcml0ZS5hbHBoYSA9IDE7XG5cbiAgICAgICAgICAgIC8vQnJpbmcgcHJldmlvdXMgZnJhbWVzIHN0YXJzIG9uc2NyZWVuIGZvciBnbG93c1xuICAgICAgICAgICAgdmFyIHRlbXAgPSByZW5kZXJUZXh0dXJlO1xuICAgICAgICAgICAgcmVuZGVyVGV4dHVyZSA9IHJlbmRlclRleHR1cmUyO1xuICAgICAgICAgICAgcmVuZGVyVGV4dHVyZTIgPSB0ZW1wO1xuICAgICAgICAgICAgc2hhZG93U3ByaXRlLnRleHR1cmUgPSByZW5kZXJUZXh0dXJlO1xuXG4gICAgICAgICAgICByZW5kZXJlci5yZW5kZXIoJHNjb3BlLnN0YWdlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgJHNjb3BlLmluaXQoKTtcbiAgICByZXR1cm4gJHNjb3BlO1xufTsiLCIvKipcbiAqXG4gKiBAYXV0aG9yIEFkYW0gQmVuc29uIDxhZGFtQHByZWNhcmlvdXNwYW50aGVyLm5ldD5cbiAqL1xuXG4vKipcbiAqXG4gKiBAcGFyYW0ge2ludH0gW3hdXG4gKiBAcGFyYW0ge2ludH0gW3ldXG4gKiBAY29uc3RydWN0b3JcbiAqL1xudmFyIFZlY3RvcjIgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBpZiAoIXgpeCA9IDA7XG4gICAgaWYgKCF5KXkgPSAwO1xuICAgIHZhciAkc2NvcGUgPSB7XG4gICAgICAgIHg6IHgsXG4gICAgICAgIHk6IHksXG4gICAgICAgIGFkZDogZnVuY3Rpb24gKHZlY3Rvciwgc2NhbGUpIHtcbiAgICAgICAgICAgIHNjYWxlID0gc2NhbGUgfHwgMTtcbiAgICAgICAgICAgICRzY29wZS54ICs9IHZlY3Rvci54ICogc2NhbGU7XG4gICAgICAgICAgICAkc2NvcGUueSArPSB2ZWN0b3IueSAqIHNjYWxlO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICAgICAgJHNjb3BlLnggPSB4O1xuICAgICAgICAgICAgJHNjb3BlLnkgPSB5O1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2NhbGU6IGZ1bmN0aW9uIChtdWx0aXBsaWVyKSB7XG4gICAgICAgICAgICAkc2NvcGUueCAqPSBtdWx0aXBsaWVyO1xuICAgICAgICAgICAgJHNjb3BlLnkgKj0gbXVsdGlwbGllcjtcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGU7XG4gICAgICAgIH0sXG4gICAgICAgIGNsYW1wOiBmdW5jdGlvbiAobWluLCBtYXgpIHtcbiAgICAgICAgICAgICRzY29wZS54ID0gTWF0aC5taW4oTWF0aC5tYXgoJHNjb3BlLngsIG1pbiksIG1heCk7XG4gICAgICAgICAgICAkc2NvcGUueSA9IE1hdGgubWluKE1hdGgubWF4KCRzY29wZS55LCBtaW4pLCBtYXgpO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgY2xhbXBBYnM6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICRzY29wZS5jbGFtcCgtdmFsLCB2YWwpO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgZGlzdGFuY2U6IGZ1bmN0aW9uICh2ZWN0b3IpIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQoJHNjb3BlLmRpc3RhbmNlU3F1YXJlKHZlY3RvcikpO1xuICAgICAgICB9LFxuICAgICAgICBkaXN0YW5jZVNxdWFyZTogZnVuY3Rpb24gKHZlY3Rvcikge1xuICAgICAgICAgICAgdmFyIGRYID0gTWF0aC5wb3codmVjdG9yLnggLSAkc2NvcGUueCwgMik7XG4gICAgICAgICAgICB2YXIgZFkgPSBNYXRoLnBvdyh2ZWN0b3IueSAtICRzY29wZS55LCAyKTtcbiAgICAgICAgICAgIHJldHVybiBkWCArIGRZO1xuICAgICAgICB9XG5cbiAgICB9O1xuICAgIHJldHVybiAkc2NvcGU7XG59OyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
