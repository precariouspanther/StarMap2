var CanvasTexture=function(cb){var canvas=document.createElement("canvas");return"function"==typeof cb&&cb(canvas),PIXI.Texture.fromCanvas(canvas)},Particle=function(position,app){"use strict";var sprite=new PIXI.Sprite;sprite.blendMode=PIXI.BLEND_MODES.SCREEN,app.stage.addChild(sprite);var state={ALIVE:"ALIVE",DYING:"DYING",DEAD:"DEAD"},$scope={alpha:1,state:state.ALIVE,sprite:sprite,stage:app,radius:0,haloRadius:0,colour:{red:255,green:255,blue:255},acceleration:new Vector2,velocity:new Vector2(Math.random()-.5,Math.random()-.5),position:position,init:function(){$scope.radius=1.1*Math.random()+1,Math.random()>.7&&($scope.colour.red=Math.round(100*Math.random()+55),$scope.colour.green=Math.round(100*Math.random()+55),$scope.colour.blue=255),$scope.createTexture($scope.radius)},createTexture:function(radius){$scope.haloRadius=Math.ceil(20*radius),sprite.texture=new CanvasTexture(function(canvas){canvas.width=$scope.haloRadius,canvas.height=$scope.haloRadius;var ctx=canvas.getContext("2d");ctx.fillStyle="rgb("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+")",ctx.beginPath(),ctx.arc($scope.haloRadius/2,$scope.haloRadius/2,radius,0,360,!1),ctx.fill();var grd=ctx.createRadialGradient($scope.haloRadius/2,$scope.haloRadius/2,radius,$scope.haloRadius/2,$scope.haloRadius/2,Math.ceil($scope.haloRadius));grd.addColorStop(0,"rgba("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+",0.05)"),grd.addColorStop(.3,"rgba("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+",0)"),ctx.fillStyle=grd,ctx.beginPath(),ctx.arc($scope.haloRadius/2,$scope.haloRadius/2,$scope.haloRadius,0,360,!1)})},die:function(){$scope.state=state.DYING},tick:function(){if($scope.state!=state.DYING)sprite.alpha=.4*Math.random()+.6,$scope.acceleration.set(Math.random()-.5,Math.random()-.5).scale(app.maxSpeed),$scope.acceleration.clampAbs(app.maxSpeed),$scope.velocity.add($scope.acceleration,.1),($scope.position.x+$scope.velocity.x>window.innerWidth||$scope.position.x+$scope.velocity.x<1)&&($scope.velocity.x*=-.9,$scope.acceleration.x*=-.9),($scope.position.y+$scope.velocity.y>window.innerHeight||$scope.position.y+$scope.velocity.y<1)&&($scope.velocity.y*=-.9,$scope.acceleration.y*=-.9),$scope.velocity.clampAbs(app.maxSpeed),$scope.position.add($scope.velocity,.1),sprite.position.x=$scope.position.x-$scope.haloRadius/2,sprite.position.y=$scope.position.y-$scope.haloRadius/2;else if($scope.alpha-=.01,sprite.alpha=$scope.alpha,$scope.alpha<=0)return void($scope.state=state.DEAD)}};return $scope.init(),$scope},StarMap=function(width,height,maxStars){"use strict";var threshold=Math.max((width+height)/2/40,30),maxLines=7*maxStars,renderer=PIXI.autoDetectRenderer(width,height,{backgroundColor:1443889});document.body.appendChild(renderer.view);var stage=new PIXI.Container,joinLines=new PIXI.Graphics;joinLines.blendMode=PIXI.BLEND_MODES.ADD;var counter=$('<span class="counter"></span>').appendTo(document.body),backgroundTexture=new CanvasTexture(function(canvas){canvas.width=width,canvas.height=height;var ctx=canvas.getContext("2d"),grd=ctx.createRadialGradient(width/2,height/2,1,width/2,height/2,height);grd.addColorStop(0,"rgb(22,8,49)"),grd.addColorStop(.4,"rgb(22,8,49)"),grd.addColorStop(.6,"rgb(12,7,24)"),grd.addColorStop(1,"rgb(0,0,0)"),ctx.fillStyle=grd,ctx.fillRect(0,0,width,height)}),renderTexture=new PIXI.RenderTexture(renderer,width,height),renderTexture2=new PIXI.RenderTexture(renderer,width,height),backgroundSprite=new PIXI.Sprite(backgroundTexture),shadowSprite=new PIXI.Sprite(renderTexture),convolutionFilter=new PIXI.filters.ConvolutionFilter([.1,.4,.1,.4,0,.4,.1,.4,.1],width,height);shadowSprite.alpha=.41,shadowSprite.filters=[convolutionFilter],stage.addChild(backgroundSprite);var lineCount,joinCount,thresholdSquare=Math.pow(threshold,2),mouseThreshold=10*threshold,mouseThresholdSquare=10*thresholdSquare,$scope={maxSpeed:10,mouse:new Vector2,width:width,height:height,stage:stage,joinLines:joinLines,nodes:[],deadNodes:[],init:function(){for(var x=0;maxStars>x;x++)$scope.addStar(new Vector2(Math.random()*width,Math.random()*height),$scope);$scope.mouse.active=!1,stage.addChild(joinLines),stage.addChild(shadowSprite)},addStar:function(position){var p=new Particle(position,$scope);$scope.addNode(p),$scope.nodes.length>maxStars&&$scope.killNode()},addNode:function(node){$scope.nodes.push(node)},killNode:function(){var dead=$scope.nodes.shift();$scope.deadNodes.push(dead),dead.die()},tick:function(){var distance;counter.html($scope.nodes.length+$scope.deadNodes.length),$scope.nodes.length>maxStars&&$scope.killNode(),lineCount=0,requestAnimationFrame($scope.tick),joinLines.clear(),$scope.nodes.forEach(function(node,i){if(node.tick(),maxLines>lineCount&&(joinCount=0,$scope.nodes.slice(i).forEach(function(joinNode){if(!(lineCount>maxLines||joinCount>12)){var d2=joinNode.position.distanceSquare(node.position);if(thresholdSquare>d2){lineCount++,joinCount++,distance=Math.sqrt(d2);var alpha=(threshold-distance)/threshold*.4+.05*Math.random();joinLines.lineStyle(alpha*(node.radius+joinNode.radius)*3,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo(joinNode.position.x,joinNode.position.y)}}})),$scope.mouse.active){var mDist=node.position.distanceSquare($scope.mouse);if(mouseThresholdSquare>mDist){distance=Math.sqrt(mDist);var alpha=(mouseThreshold-distance)/mouseThreshold*.4+.05*Math.random();joinLines.lineStyle(1,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo($scope.mouse.x,$scope.mouse.y)}}}),$scope.deadNodes.forEach(function(node,i){node.tick(),"DEAD"==node.state&&(stage.removeChild(node.sprite),$scope.deadNodes.splice($scope.deadNodes.indexOf(node),1))}),backgroundSprite.alpha=0,joinLines.alpha=.1,renderTexture2.render($scope.stage,null,!0),joinLines.alpha=1,backgroundSprite.alpha=1;var temp=renderTexture;renderTexture=renderTexture2,renderTexture2=temp,shadowSprite.texture=renderTexture,renderer.render($scope.stage)}};return $scope.init(),$scope},Vector2=function(x,y){"use strict";x||(x=0),y||(y=0);var $scope={x:x,y:y,add:function(vector,scale){return scale=scale||1,$scope.x+=vector.x*scale,$scope.y+=vector.y*scale,$scope},set:function(x,y){return $scope.x=x,$scope.y=y,$scope},scale:function(multiplier){return $scope.x*=multiplier,$scope.y*=multiplier,$scope},clamp:function(min,max){return $scope.x=Math.min(Math.max($scope.x,min),max),$scope.y=Math.min(Math.max($scope.y,min),max),$scope},clampAbs:function(val){return $scope.clamp(-val,val),$scope},distance:function(vector){return Math.sqrt($scope.distanceSquare(vector))},distanceSquare:function(vector){var dX=Math.pow(vector.x-$scope.x,2),dY=Math.pow(vector.y-$scope.y,2);return dX+dY}};return $scope};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhbnZhc1RleHR1cmUuanMiLCJQYXJ0aWNsZS5qcyIsIlN0YXJNYXAuanMiLCJWZWN0b3IyLmpzIl0sIm5hbWVzIjpbIkNhbnZhc1RleHR1cmUiLCJjYiIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsIlBJWEkiLCJUZXh0dXJlIiwiZnJvbUNhbnZhcyIsIlBhcnRpY2xlIiwicG9zaXRpb24iLCJhcHAiLCJzcHJpdGUiLCJTcHJpdGUiLCJibGVuZE1vZGUiLCJCTEVORF9NT0RFUyIsIlNDUkVFTiIsInN0YWdlIiwiYWRkQ2hpbGQiLCJzdGF0ZSIsIkFMSVZFIiwiRFlJTkciLCJERUFEIiwiJHNjb3BlIiwiYWxwaGEiLCJyYWRpdXMiLCJoYWxvUmFkaXVzIiwiY29sb3VyIiwicmVkIiwiZ3JlZW4iLCJibHVlIiwiYWNjZWxlcmF0aW9uIiwiVmVjdG9yMiIsInZlbG9jaXR5IiwiTWF0aCIsInJhbmRvbSIsImluaXQiLCJyb3VuZCIsImNyZWF0ZVRleHR1cmUiLCJjZWlsIiwidGV4dHVyZSIsIndpZHRoIiwiaGVpZ2h0IiwiY3R4IiwiZ2V0Q29udGV4dCIsImZpbGxTdHlsZSIsImJlZ2luUGF0aCIsImFyYyIsImZpbGwiLCJncmQiLCJjcmVhdGVSYWRpYWxHcmFkaWVudCIsImFkZENvbG9yU3RvcCIsImRpZSIsInRpY2siLCJzZXQiLCJzY2FsZSIsIm1heFNwZWVkIiwiY2xhbXBBYnMiLCJhZGQiLCJ4Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsInkiLCJpbm5lckhlaWdodCIsIlN0YXJNYXAiLCJtYXhTdGFycyIsInRocmVzaG9sZCIsIm1heCIsIm1heExpbmVzIiwicmVuZGVyZXIiLCJhdXRvRGV0ZWN0UmVuZGVyZXIiLCJiYWNrZ3JvdW5kQ29sb3IiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJ2aWV3IiwiQ29udGFpbmVyIiwiam9pbkxpbmVzIiwiR3JhcGhpY3MiLCJBREQiLCJjb3VudGVyIiwiJCIsImFwcGVuZFRvIiwiYmFja2dyb3VuZFRleHR1cmUiLCJmaWxsUmVjdCIsInJlbmRlclRleHR1cmUiLCJSZW5kZXJUZXh0dXJlIiwicmVuZGVyVGV4dHVyZTIiLCJiYWNrZ3JvdW5kU3ByaXRlIiwic2hhZG93U3ByaXRlIiwiY29udm9sdXRpb25GaWx0ZXIiLCJmaWx0ZXJzIiwiQ29udm9sdXRpb25GaWx0ZXIiLCJsaW5lQ291bnQiLCJqb2luQ291bnQiLCJ0aHJlc2hvbGRTcXVhcmUiLCJwb3ciLCJtb3VzZVRocmVzaG9sZCIsIm1vdXNlVGhyZXNob2xkU3F1YXJlIiwibW91c2UiLCJub2RlcyIsImRlYWROb2RlcyIsImFkZFN0YXIiLCJhY3RpdmUiLCJwIiwiYWRkTm9kZSIsImxlbmd0aCIsImtpbGxOb2RlIiwibm9kZSIsInB1c2giLCJkZWFkIiwic2hpZnQiLCJkaXN0YW5jZSIsImh0bWwiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjbGVhciIsImZvckVhY2giLCJpIiwic2xpY2UiLCJqb2luTm9kZSIsImQyIiwiZGlzdGFuY2VTcXVhcmUiLCJzcXJ0IiwibGluZVN0eWxlIiwibW92ZVRvIiwibGluZVRvIiwibURpc3QiLCJyZW1vdmVDaGlsZCIsInNwbGljZSIsImluZGV4T2YiLCJyZW5kZXIiLCJ0ZW1wIiwidmVjdG9yIiwibXVsdGlwbGllciIsImNsYW1wIiwibWluIiwidmFsIiwiZFgiLCJkWSJdLCJtYXBwaW5ncyI6IkFBT0EsR0FBQUEsZUFBQSxTQUFBQyxJQUNBLEdBQUFDLFFBQUFDLFNBQUFDLGNBQUEsU0FFQSxPQURBLGtCQUFBSCxLQUFBQSxHQUFBQyxRQUNBRyxLQUFBQyxRQUFBQyxXQUFBTCxTQ0xBTSxTQUFBLFNBQUFDLFNBQUFDLEtBQ0EsWUFFQSxJQUFBQyxRQUFBLEdBQUFOLE1BQUFPLE1BRUFELFFBQUFFLFVBQUFSLEtBQUFTLFlBQUFDLE9BQ0FMLElBQUFNLE1BQUFDLFNBQUFOLE9BRUEsSUFBQU8sUUFDQUMsTUFBQSxRQUNBQyxNQUFBLFFBQ0FDLEtBQUEsUUFJQUMsUUFDQUMsTUFBQSxFQUNBTCxNQUFB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QW5FLEtBQ0E1QyxPQUFBdUMsRUFBQTVCLEtBQUFvRyxJQUFBcEcsS0FBQWlDLElBQUE1QyxPQUFBdUMsRUFBQXdFLEtBQUFuRSxLQUNBNUMsUUFFQWtDLFNBQUEsU0FBQThFLEtBRUEsTUFEQWhILFFBQUE4RyxPQUFBRSxJQUFBQSxLQUNBaEgsUUFFQXdGLFNBQUEsU0FBQW9CLFFBQ0EsTUFBQWpHLE1BQUF1RixLQUFBbEcsT0FBQWlHLGVBQUFXLFVBRUFYLGVBQUEsU0FBQVcsUUFDQSxHQUFBSyxJQUFBdEcsS0FBQTZELElBQUFvQyxPQUFBeEUsRUFBQXBDLE9BQUFvQyxFQUFBLEdBQ0E4RSxHQUFBdkcsS0FBQTZELElBQUFvQyxPQUFBckUsRUFBQXZDLE9BQUF1QyxFQUFBLEVBQ0EsT0FBQTBFLElBQUFDLElBSUEsT0FBQWxIIiwiZmlsZSI6InN0YXJtYXAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKlxuICogQHBhcmFtIGNiXG4gKiBAcmV0dXJucyB7UElYSS5CYXNlVGV4dHVyZXxQSVhJLlRleHR1cmV9XG4gKiBAY29uc3RydWN0b3JcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG52YXIgQ2FudmFzVGV4dHVyZSA9IGZ1bmN0aW9uIChjYikge1xuICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICBpZiAodHlwZW9mIGNiID09ICdmdW5jdGlvbicpIGNiKGNhbnZhcyk7XG4gICAgcmV0dXJuIFBJWEkuVGV4dHVyZS5mcm9tQ2FudmFzKGNhbnZhcyk7XG59OyIsIi8qKlxuICpcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG5cbnZhciBQYXJ0aWNsZSA9IGZ1bmN0aW9uIChwb3NpdGlvbiwgYXBwKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHNwcml0ZSA9IG5ldyBQSVhJLlNwcml0ZSgpO1xuXG4gICAgc3ByaXRlLmJsZW5kTW9kZSA9IFBJWEkuQkxFTkRfTU9ERVMuU0NSRUVOO1xuICAgIGFwcC5zdGFnZS5hZGRDaGlsZChzcHJpdGUpO1xuXG4gICAgdmFyIHN0YXRlID0ge1xuICAgICAgICBBTElWRTogXCJBTElWRVwiLFxuICAgICAgICBEWUlORzogXCJEWUlOR1wiLFxuICAgICAgICBERUFEOiBcIkRFQURcIlxuICAgIH07XG5cbiAgICAvL2FwcC5zdGFnZS5hZGRDaGlsZChqb2luTGluZXMpO1xuICAgIHZhciAkc2NvcGUgPSB7XG4gICAgICAgIGFscGhhOiAxLFxuICAgICAgICBzdGF0ZTogc3RhdGUuQUxJVkUsXG4gICAgICAgIHNwcml0ZTogc3ByaXRlLFxuICAgICAgICBzdGFnZTogYXBwLFxuICAgICAgICByYWRpdXM6IDAsXG4gICAgICAgIGhhbG9SYWRpdXM6IDAsXG4gICAgICAgIGNvbG91cjoge1xuICAgICAgICAgICAgcmVkOiAyNTUsXG4gICAgICAgICAgICBncmVlbjogMjU1LFxuICAgICAgICAgICAgYmx1ZTogMjU1XG4gICAgICAgIH0sXG4gICAgICAgIGFjY2VsZXJhdGlvbjogbmV3IFZlY3RvcjIoKSxcbiAgICAgICAgdmVsb2NpdHk6IG5ldyBWZWN0b3IyKE1hdGgucmFuZG9tKCkgLSAwLjUsIE1hdGgucmFuZG9tKCkgLSAwLjUpLFxuICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5yYWRpdXMgPSBNYXRoLnJhbmRvbSgpICogMS4xICsgMTtcbiAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC43KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbG91ci5yZWQgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMDAgKyA1NSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbG91ci5ncmVlbiA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDEwMCArIDU1KTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29sb3VyLmJsdWUgPSAyNTU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUuY3JlYXRlVGV4dHVyZSgkc2NvcGUucmFkaXVzKTtcbiAgICAgICAgfSxcbiAgICAgICAgY3JlYXRlVGV4dHVyZTogZnVuY3Rpb24gKHJhZGl1cykge1xuICAgICAgICAgICAgJHNjb3BlLmhhbG9SYWRpdXMgPSBNYXRoLmNlaWwocmFkaXVzICogMjApO1xuICAgICAgICAgICAgc3ByaXRlLnRleHR1cmUgPSBuZXcgQ2FudmFzVGV4dHVyZShmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gJHNjb3BlLmhhbG9SYWRpdXM7XG4gICAgICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9ICRzY29wZS5oYWxvUmFkaXVzO1xuICAgICAgICAgICAgICAgIC8vQ29yZVxuICAgICAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYignICsgJHNjb3BlLmNvbG91ci5yZWQgKyAnLCcgKyAkc2NvcGUuY29sb3VyLmdyZWVuICsgJywnICsgJHNjb3BlLmNvbG91ci5ibHVlICsgJyknO1xuICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICBjdHguYXJjKCRzY29wZS5oYWxvUmFkaXVzIC8gMiwgJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCByYWRpdXMsIDAsIDM2MCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7XG4gICAgICAgICAgICAgICAgLy9IYWxvXG4gICAgICAgICAgICAgICAgdmFyIGdyZCA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudCgkc2NvcGUuaGFsb1JhZGl1cyAvIDIsICRzY29wZS5oYWxvUmFkaXVzIC8gMiwgcmFkaXVzLCAkc2NvcGUuaGFsb1JhZGl1cyAvIDIsICRzY29wZS5oYWxvUmFkaXVzIC8gMiwgTWF0aC5jZWlsKCRzY29wZS5oYWxvUmFkaXVzKSk7XG4gICAgICAgICAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLCAncmdiYSgnICsgJHNjb3BlLmNvbG91ci5yZWQgKyAnLCcgKyAkc2NvcGUuY29sb3VyLmdyZWVuICsgJywnICsgJHNjb3BlLmNvbG91ci5ibHVlICsgJywnICsgMC4wNSArICcpJyk7XG4gICAgICAgICAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLjMsICdyZ2JhKCcgKyAkc2NvcGUuY29sb3VyLnJlZCArICcsJyArICRzY29wZS5jb2xvdXIuZ3JlZW4gKyAnLCcgKyAkc2NvcGUuY29sb3VyLmJsdWUgKyAnLDApJyk7XG5cbiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZ3JkO1xuICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICBjdHguYXJjKCRzY29wZS5oYWxvUmFkaXVzIC8gMiwgJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCAkc2NvcGUuaGFsb1JhZGl1cywgMCwgMzYwLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgLy9jdHguZmlsbCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRpZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy9UcmlnZ2VyIGZhZGVcbiAgICAgICAgICAgICRzY29wZS5zdGF0ZSA9IHN0YXRlLkRZSU5HO1xuICAgICAgICB9LFxuICAgICAgICB0aWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLnN0YXRlID09IHN0YXRlLkRZSU5HKSB7XG4gICAgICAgICAgICAgICAgLy9EeWluZ1xuICAgICAgICAgICAgICAgICRzY29wZS5hbHBoYSAtPSAwLjAxO1xuICAgICAgICAgICAgICAgIHNwcml0ZS5hbHBoYSA9ICRzY29wZS5hbHBoYTtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFscGhhIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN0YXRlID0gc3RhdGUuREVBRDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy9Ud2lua2xlXG4gICAgICAgICAgICAgICAgc3ByaXRlLmFscGhhID0gTWF0aC5yYW5kb20oKSAqIDAuNCArIDAuNjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vTW92ZVxuICAgICAgICAgICAgJHNjb3BlLmFjY2VsZXJhdGlvbi5zZXQoTWF0aC5yYW5kb20oKSAtIDAuNSwgTWF0aC5yYW5kb20oKSAtIDAuNSkuc2NhbGUoYXBwLm1heFNwZWVkKTtcbiAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24uY2xhbXBBYnMoYXBwLm1heFNwZWVkKTtcblxuICAgICAgICAgICAgJHNjb3BlLnZlbG9jaXR5LmFkZCgkc2NvcGUuYWNjZWxlcmF0aW9uLCAwLjEpO1xuXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnBvc2l0aW9uLnggKyAkc2NvcGUudmVsb2NpdHkueCA+IHdpbmRvdy5pbm5lcldpZHRoIHx8ICRzY29wZS5wb3NpdGlvbi54ICsgJHNjb3BlLnZlbG9jaXR5LnggPCAxKSB7XG4gICAgICAgICAgICAgICAgLy9Cb3VuY2UgWFxuICAgICAgICAgICAgICAgICRzY29wZS52ZWxvY2l0eS54ICo9IC0wLjk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFjY2VsZXJhdGlvbi54ICo9IC0wLjk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgkc2NvcGUucG9zaXRpb24ueSArICRzY29wZS52ZWxvY2l0eS55ID4gd2luZG93LmlubmVySGVpZ2h0IHx8ICRzY29wZS5wb3NpdGlvbi55ICsgJHNjb3BlLnZlbG9jaXR5LnkgPCAxKSB7XG4gICAgICAgICAgICAgICAgLy9Cb3VuY2UgWVxuICAgICAgICAgICAgICAgICRzY29wZS52ZWxvY2l0eS55ICo9IC0wLjk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFjY2VsZXJhdGlvbi55ICo9IC0wLjk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUudmVsb2NpdHkuY2xhbXBBYnMoYXBwLm1heFNwZWVkKTtcbiAgICAgICAgICAgICRzY29wZS5wb3NpdGlvbi5hZGQoJHNjb3BlLnZlbG9jaXR5LCAwLjEpO1xuICAgICAgICAgICAgc3ByaXRlLnBvc2l0aW9uLnggPSAkc2NvcGUucG9zaXRpb24ueCAtICgkc2NvcGUuaGFsb1JhZGl1cyAvIDIpO1xuICAgICAgICAgICAgc3ByaXRlLnBvc2l0aW9uLnkgPSAkc2NvcGUucG9zaXRpb24ueSAtICgkc2NvcGUuaGFsb1JhZGl1cyAvIDIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5pbml0KCk7XG4gICAgcmV0dXJuICRzY29wZTtcbn07IiwiLyoqXG4gKlxuICogQGF1dGhvciBBZGFtIEJlbnNvbiA8YWRhbUBwcmVjYXJpb3VzcGFudGhlci5uZXQ+XG4gKi9cblxudmFyIFN0YXJNYXAgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgbWF4U3RhcnMpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIHRocmVzaG9sZCA9IE1hdGgubWF4KCgod2lkdGggKyBoZWlnaHQpIC8gMiApIC8gNDAsMzApO1xuICAgIHZhciBtYXhMaW5lcyA9IG1heFN0YXJzICogNztcbiAgICB2YXIgcmVuZGVyZXIgPSBQSVhJLmF1dG9EZXRlY3RSZW5kZXJlcih3aWR0aCwgaGVpZ2h0LCB7YmFja2dyb3VuZENvbG9yOiAweDE2MDgzMX0pO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocmVuZGVyZXIudmlldyk7XG4gICAgdmFyIHN0YWdlID0gbmV3IFBJWEkuQ29udGFpbmVyKCk7XG4gICAgdmFyIGpvaW5MaW5lcyA9IG5ldyBQSVhJLkdyYXBoaWNzKCk7XG4gICAgam9pbkxpbmVzLmJsZW5kTW9kZSA9IFBJWEkuQkxFTkRfTU9ERVMuQUREO1xuICAgIHZhciBjb3VudGVyID0gJCgnPHNwYW4gY2xhc3M9XCJjb3VudGVyXCI+PC9zcGFuPicpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpO1xuXG4gICAgdmFyIGJhY2tncm91bmRUZXh0dXJlID0gbmV3IENhbnZhc1RleHR1cmUoZnVuY3Rpb24gKGNhbnZhcykge1xuICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICB2YXIgZ3JkID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgMSwgd2lkdGggLyAyLCBoZWlnaHQgLyAyLCBoZWlnaHQpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAsICdyZ2IoMjIsOCw0OSknKTtcbiAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLjQsICdyZ2IoMjIsOCw0OSknKTtcbiAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLjYsICdyZ2IoMTIsNywyNCknKTtcbiAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgxLCAncmdiKDAsMCwwKScpO1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gZ3JkO1xuICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgfSk7XG5cbiAgICB2YXIgcmVuZGVyVGV4dHVyZSA9IG5ldyBQSVhJLlJlbmRlclRleHR1cmUocmVuZGVyZXIsIHdpZHRoLCBoZWlnaHQpO1xuICAgIHZhciByZW5kZXJUZXh0dXJlMiA9IG5ldyBQSVhJLlJlbmRlclRleHR1cmUocmVuZGVyZXIsIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgdmFyIGJhY2tncm91bmRTcHJpdGUgPSBuZXcgUElYSS5TcHJpdGUoYmFja2dyb3VuZFRleHR1cmUpO1xuICAgIHZhciBzaGFkb3dTcHJpdGUgPSBuZXcgUElYSS5TcHJpdGUocmVuZGVyVGV4dHVyZSk7XG4gICAgdmFyIGNvbnZvbHV0aW9uRmlsdGVyID0gbmV3IFBJWEkuZmlsdGVycy5Db252b2x1dGlvbkZpbHRlcihbXG4gICAgICAgIDAuMSwgMC40LCAwLjEsXG4gICAgICAgIDAuNCwgMC4wLCAwLjQsXG4gICAgICAgIDAuMSwgMC40LCAwLjFcbiAgICBdLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgIC8vc2hhZG93U3ByaXRlLmFscGhhID0gMC40OTtcbiAgICBzaGFkb3dTcHJpdGUuYWxwaGEgPSAwLjQxO1xuICAgIC8vc2hhZG93U3ByaXRlLmJsZW5kTW9kZSA9IFBJWEkuQkxFTkRfTU9ERVMuU09GVF9MSUdIVDtcblxuICAgIC8qIHZhciBmaWx0ZXIgPSBuZXcgUElYSS5maWx0ZXJzLkNvbnZvbHV0aW9uRmlsdGVyKFtcbiAgICAgMC4xLDAuMSwwLjEsXG4gICAgIDAuMSwwLjIsMC4xLFxuICAgICAwLjEsMC4xLDAuMVxuICAgICBdLHdpZHRoLGhlaWdodCk7Ki9cbiAgICBzaGFkb3dTcHJpdGUuZmlsdGVycyA9IFtjb252b2x1dGlvbkZpbHRlcl07XG4gICAgc3RhZ2UuYWRkQ2hpbGQoYmFja2dyb3VuZFNwcml0ZSk7XG5cbiAgICB2YXIgbGluZUNvdW50LGpvaW5Db3VudDtcbiAgICB2YXIgdGhyZXNob2xkU3F1YXJlID0gTWF0aC5wb3codGhyZXNob2xkLCAyKTtcbiAgICB2YXIgbW91c2VUaHJlc2hvbGQgPSB0aHJlc2hvbGQgKiAxMDtcbiAgICB2YXIgbW91c2VUaHJlc2hvbGRTcXVhcmUgPSB0aHJlc2hvbGRTcXVhcmUgKiAxMDtcbiAgICB2YXIgJHNjb3BlID0ge1xuICAgICAgICBtYXhTcGVlZDogMTAsXG4gICAgICAgIG1vdXNlOiBuZXcgVmVjdG9yMigpLFxuICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICBzdGFnZTogc3RhZ2UsXG4gICAgICAgIGpvaW5MaW5lczogam9pbkxpbmVzLFxuICAgICAgICBub2RlczogW10sXG4gICAgICAgIGRlYWROb2RlczogW10sXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgbWF4U3RhcnM7IHgrKykge1xuICAgICAgICAgICAgICAgICRzY29wZS5hZGRTdGFyKG5ldyBWZWN0b3IyKE1hdGgucmFuZG9tKCkgKiB3aWR0aCwgTWF0aC5yYW5kb20oKSAqIGhlaWdodCksICRzY29wZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUubW91c2UuYWN0aXZlID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHN0YWdlLmFkZENoaWxkKGpvaW5MaW5lcyk7XG4gICAgICAgICAgICBzdGFnZS5hZGRDaGlsZChzaGFkb3dTcHJpdGUpO1xuICAgICAgICB9LFxuICAgICAgICBhZGRTdGFyOiBmdW5jdGlvbiAocG9zaXRpb24pIHtcbiAgICAgICAgICAgIHZhciBwID0gbmV3IFBhcnRpY2xlKHBvc2l0aW9uLCAkc2NvcGUpO1xuICAgICAgICAgICAgJHNjb3BlLmFkZE5vZGUocCk7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLm5vZGVzLmxlbmd0aCA+IG1heFN0YXJzKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmtpbGxOb2RlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGFkZE5vZGU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAkc2NvcGUubm9kZXMucHVzaChub2RlKTtcbiAgICAgICAgfSxcbiAgICAgICAga2lsbE5vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBkZWFkID0gJHNjb3BlLm5vZGVzLnNoaWZ0KCk7XG4gICAgICAgICAgICAkc2NvcGUuZGVhZE5vZGVzLnB1c2goZGVhZCk7XG4gICAgICAgICAgICBkZWFkLmRpZSgpO1xuICAgICAgICB9LFxuICAgICAgICB0aWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGlzdGFuY2U7XG4gICAgICAgICAgICBjb3VudGVyLmh0bWwoJHNjb3BlLm5vZGVzLmxlbmd0aCArICRzY29wZS5kZWFkTm9kZXMubGVuZ3RoKTtcbiAgICAgICAgICAgIC8vQ3VsbCB0b28gbWFueSBzdGFyc1xuICAgICAgICAgICAgaWYgKCRzY29wZS5ub2Rlcy5sZW5ndGggPiBtYXhTdGFycykge1xuICAgICAgICAgICAgICAgICRzY29wZS5raWxsTm9kZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaW5lQ291bnQgPSAwO1xuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCRzY29wZS50aWNrKTtcbiAgICAgICAgICAgIGpvaW5MaW5lcy5jbGVhcigpO1xuICAgICAgICAgICAgJHNjb3BlLm5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGUsIGkpIHtcbiAgICAgICAgICAgICAgICAvL1BhcnRpY2xlc1xuICAgICAgICAgICAgICAgIG5vZGUudGljaygpO1xuICAgICAgICAgICAgICAgIGlmIChsaW5lQ291bnQgPCBtYXhMaW5lcykge1xuICAgICAgICAgICAgICAgICAgICBqb2luQ291bnQ9MDtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vZGVzLnNsaWNlKGkpLmZvckVhY2goZnVuY3Rpb24gKGpvaW5Ob2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobGluZUNvdW50ID4gbWF4TGluZXMgfHwgam9pbkNvdW50ID4gMTIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZDIgPSBqb2luTm9kZS5wb3NpdGlvbi5kaXN0YW5jZVNxdWFyZShub2RlLnBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkMiA8IHRocmVzaG9sZFNxdWFyZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5Db3VudCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gTWF0aC5zcXJ0KGQyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxwaGEgPSAoKCh0aHJlc2hvbGQgLSBkaXN0YW5jZSkgLyB0aHJlc2hvbGQpICogMC40KSArIChNYXRoLnJhbmRvbSgpICogMC4wNSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLmxpbmVTdHlsZShhbHBoYSAqIChub2RlLnJhZGl1cyArIGpvaW5Ob2RlLnJhZGl1cykgKiAzLCAweDAwZGJmZiwgYWxwaGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5tb3ZlVG8obm9kZS5wb3NpdGlvbi54LCBub2RlLnBvc2l0aW9uLnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5saW5lVG8oam9pbk5vZGUucG9zaXRpb24ueCwgam9pbk5vZGUucG9zaXRpb24ueSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vTW91c2UgYWN0aXZlXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5tb3VzZS5hY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1EaXN0ID0gbm9kZS5wb3NpdGlvbi5kaXN0YW5jZVNxdWFyZSgkc2NvcGUubW91c2UpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobURpc3QgPCBtb3VzZVRocmVzaG9sZFNxdWFyZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBNYXRoLnNxcnQobURpc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhID0gKCgobW91c2VUaHJlc2hvbGQgLSBkaXN0YW5jZSkgLyBtb3VzZVRocmVzaG9sZCkgKiAwLjQpICsgKE1hdGgucmFuZG9tKCkgKiAwLjA1KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5saW5lU3R5bGUoMSwgMHgwMGRiZmYsIGFscGhhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5tb3ZlVG8obm9kZS5wb3NpdGlvbi54LCBub2RlLnBvc2l0aW9uLnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLmxpbmVUbygkc2NvcGUubW91c2UueCwgJHNjb3BlLm1vdXNlLnkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvL0RyYXcgb3VyIGRlYWRub2RlcyBzZXBhcmF0ZWx5ICh0aGV5IGZhZGUgb3V0IGJ1dCBzaG91bGRuJ3QgaGF2ZSBsaW5lcylcbiAgICAgICAgICAgICRzY29wZS5kZWFkTm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlLGkpe1xuICAgICAgICAgICAgICAgIG5vZGUudGljaygpO1xuICAgICAgICAgICAgICAgIGlmKG5vZGUuc3RhdGUgPT0gXCJERUFEXCIpe1xuICAgICAgICAgICAgICAgICAgICBzdGFnZS5yZW1vdmVDaGlsZChub2RlLnNwcml0ZSk7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kZWFkTm9kZXMuc3BsaWNlKCRzY29wZS5kZWFkTm9kZXMuaW5kZXhPZihub2RlKSwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vUmVuZGVyIHN0YXJzIHRvIHRleHR1cmUsIGJ1dCBtb3ZlIGl0IG9mZnNjcmVlbiAoZm9yIG5leHQgZnJhbWUpXG4gICAgICAgICAgICBiYWNrZ3JvdW5kU3ByaXRlLmFscGhhID0gMDtcbiAgICAgICAgICAgIGpvaW5MaW5lcy5hbHBoYSA9IDAuMTtcbiAgICAgICAgICAgIHJlbmRlclRleHR1cmUyLnJlbmRlcigkc2NvcGUuc3RhZ2UsIG51bGwsIHRydWUpO1xuICAgICAgICAgICAgam9pbkxpbmVzLmFscGhhID0gMTtcbiAgICAgICAgICAgIGJhY2tncm91bmRTcHJpdGUuYWxwaGEgPSAxO1xuXG4gICAgICAgICAgICAvL0JyaW5nIHByZXZpb3VzIGZyYW1lcyBzdGFycyBvbnNjcmVlbiBmb3IgZ2xvd3NcbiAgICAgICAgICAgIHZhciB0ZW1wID0gcmVuZGVyVGV4dHVyZTtcbiAgICAgICAgICAgIHJlbmRlclRleHR1cmUgPSByZW5kZXJUZXh0dXJlMjtcbiAgICAgICAgICAgIHJlbmRlclRleHR1cmUyID0gdGVtcDtcbiAgICAgICAgICAgIHNoYWRvd1Nwcml0ZS50ZXh0dXJlID0gcmVuZGVyVGV4dHVyZTtcblxuICAgICAgICAgICAgcmVuZGVyZXIucmVuZGVyKCRzY29wZS5zdGFnZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgICRzY29wZS5pbml0KCk7XG4gICAgcmV0dXJuICRzY29wZTtcbn07IiwiLyoqXG4gKlxuICogQGF1dGhvciBBZGFtIEJlbnNvbiA8YWRhbUBwcmVjYXJpb3VzcGFudGhlci5uZXQ+XG4gKi9cblxuLyoqXG4gKlxuICogQHBhcmFtIHtpbnR9IFt4XVxuICogQHBhcmFtIHtpbnR9IFt5XVxuICogQGNvbnN0cnVjdG9yXG4gKi9cbnZhciBWZWN0b3IyID0gZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgaWYgKCF4KXggPSAwO1xuICAgIGlmICgheSl5ID0gMDtcbiAgICB2YXIgJHNjb3BlID0ge1xuICAgICAgICB4OiB4LFxuICAgICAgICB5OiB5LFxuICAgICAgICBhZGQ6IGZ1bmN0aW9uICh2ZWN0b3IsIHNjYWxlKSB7XG4gICAgICAgICAgICBzY2FsZSA9IHNjYWxlIHx8IDE7XG4gICAgICAgICAgICAkc2NvcGUueCArPSB2ZWN0b3IueCAqIHNjYWxlO1xuICAgICAgICAgICAgJHNjb3BlLnkgKz0gdmVjdG9yLnkgKiBzY2FsZTtcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGU7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgICAgICAgICRzY29wZS54ID0geDtcbiAgICAgICAgICAgICRzY29wZS55ID0geTtcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGU7XG4gICAgICAgIH0sXG4gICAgICAgIHNjYWxlOiBmdW5jdGlvbiAobXVsdGlwbGllcikge1xuICAgICAgICAgICAgJHNjb3BlLnggKj0gbXVsdGlwbGllcjtcbiAgICAgICAgICAgICRzY29wZS55ICo9IG11bHRpcGxpZXI7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBjbGFtcDogZnVuY3Rpb24gKG1pbiwgbWF4KSB7XG4gICAgICAgICAgICAkc2NvcGUueCA9IE1hdGgubWluKE1hdGgubWF4KCRzY29wZS54LCBtaW4pLCBtYXgpO1xuICAgICAgICAgICAgJHNjb3BlLnkgPSBNYXRoLm1pbihNYXRoLm1heCgkc2NvcGUueSwgbWluKSwgbWF4KTtcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGU7XG4gICAgICAgIH0sXG4gICAgICAgIGNsYW1wQWJzOiBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAkc2NvcGUuY2xhbXAoLXZhbCwgdmFsKTtcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGU7XG4gICAgICAgIH0sXG4gICAgICAgIGRpc3RhbmNlOiBmdW5jdGlvbiAodmVjdG9yKSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KCRzY29wZS5kaXN0YW5jZVNxdWFyZSh2ZWN0b3IpKTtcbiAgICAgICAgfSxcbiAgICAgICAgZGlzdGFuY2VTcXVhcmU6IGZ1bmN0aW9uICh2ZWN0b3IpIHtcbiAgICAgICAgICAgIHZhciBkWCA9IE1hdGgucG93KHZlY3Rvci54IC0gJHNjb3BlLngsIDIpO1xuICAgICAgICAgICAgdmFyIGRZID0gTWF0aC5wb3codmVjdG9yLnkgLSAkc2NvcGUueSwgMik7XG4gICAgICAgICAgICByZXR1cm4gZFggKyBkWTtcbiAgICAgICAgfVxuXG4gICAgfTtcbiAgICByZXR1cm4gJHNjb3BlO1xufTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
