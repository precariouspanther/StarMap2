var CanvasTexture=function(cb){var canvas=document.createElement("canvas");return"function"==typeof cb&&cb(canvas),PIXI.Texture.fromCanvas(canvas)},Particle=function(position,app){"use strict";var radius=1.1*Math.random()+1,haloRadius=Math.ceil(20*radius),colour={red:255,green:255,blue:255};Math.random()>.7&&(colour.red=Math.round(100*Math.random()+55),colour.green=Math.round(100*Math.random()+55),colour.blue=255);var texture=new CanvasTexture(function(canvas){canvas.width=haloRadius,canvas.height=haloRadius;var ctx=canvas.getContext("2d");ctx.fillStyle="rgb("+colour.red+","+colour.green+","+colour.blue+")",ctx.beginPath(),ctx.arc(haloRadius/2,haloRadius/2,radius,0,360,!1),ctx.fill();var grd=ctx.createRadialGradient(haloRadius/2,haloRadius/2,radius,haloRadius/2,haloRadius/2,Math.ceil(haloRadius));grd.addColorStop(0,"rgba("+colour.red+","+colour.green+","+colour.blue+",0.05)"),grd.addColorStop(.3,"rgba("+colour.red+","+colour.green+","+colour.blue+",0)"),ctx.fillStyle=grd,ctx.beginPath(),ctx.arc(haloRadius/2,haloRadius/2,haloRadius,0,360,!1)}),sprite=new PIXI.Sprite(texture);sprite.blendMode=PIXI.BLEND_MODES.SCREEN,app.stage.addChild(sprite);var $scope={sprite:sprite,stage:app,radius:radius,acceleration:new Vector2,velocity:new Vector2(Math.random()-.5,Math.random()-.5),position:position,colour:{red:255,green:255,blue:255},init:function(){Math.random()>.7&&($scope.colour.red=Math.round(200*Math.random()+55),$scope.colour.green=Math.round(200*Math.random()+55),$scope.colour.blue=Math.round(200*Math.random()+55))},tick:function(){sprite.alpha=.4*Math.random()+.6,$scope.acceleration.set(Math.random()-.5,Math.random()-.5).scale(app.maxSpeed),$scope.acceleration.clampAbs(app.maxSpeed),$scope.velocity.add($scope.acceleration,.1),($scope.position.x+$scope.velocity.x>window.innerWidth||$scope.position.x+$scope.velocity.x<1)&&($scope.velocity.x*=-.9,$scope.acceleration.x*=-.9),($scope.position.y+$scope.velocity.y>window.innerHeight||$scope.position.y+$scope.velocity.y<1)&&($scope.velocity.y*=-.9,$scope.acceleration.y*=-.9),$scope.velocity.clampAbs(app.maxSpeed),$scope.position.add($scope.velocity,.1),sprite.position.x=$scope.position.x-haloRadius/2,sprite.position.y=$scope.position.y-haloRadius/2}};return $scope.init(),$scope},StarMap=function(width,height,starCount,threshold){"use strict";var renderer=PIXI.autoDetectRenderer(width,height,{backgroundColor:1443889});document.body.appendChild(renderer.view);var stage=new PIXI.Container,joinLines=new PIXI.Graphics;joinLines.blendMode=PIXI.BLEND_MODES.ADD;var backgroundTexture=new CanvasTexture(function(canvas){canvas.width=width,canvas.height=height;var ctx=canvas.getContext("2d"),grd=ctx.createRadialGradient(width/2,height/2,1,width/2,height/2,height);grd.addColorStop(0,"rgb(22,8,49)"),grd.addColorStop(.4,"rgb(22,8,49)"),grd.addColorStop(.6,"rgb(12,7,24)"),grd.addColorStop(1,"rgb(0,0,0)"),ctx.fillStyle=grd,ctx.fillRect(0,0,width,height)}),renderTexture=new PIXI.RenderTexture(renderer,width,height),renderTexture2=new PIXI.RenderTexture(renderer,width,height),backgroundSprite=new PIXI.Sprite(backgroundTexture),shadowSprite=new PIXI.Sprite(renderTexture),convolutionFilter=new PIXI.filters.ConvolutionFilter([.1,.4,.1,.4,0,.4,.1,.4,.1],width,height);shadowSprite.alpha=.49,shadowSprite.filters=[convolutionFilter],stage.addChild(backgroundSprite);var thresholdSquare=Math.pow(threshold,2),mouseThreshold=10*threshold,mouseThresholdSquare=10*thresholdSquare,$scope={maxSpeed:10,mouse:new Vector2,width:width,height:height,stage:stage,joinLines:joinLines,nodes:[],init:function(){for(var x=0;starCount>x;x++){var p=new Particle(new Vector2(Math.random()*width,Math.random()*height),$scope);$scope.addNode(p)}$scope.mouse.active=!1,stage.addChild(joinLines),stage.addChild(shadowSprite)},addNode:function(node){$scope.nodes.push(node)},removeNode:function(node){$scope.nodes.splice($scope.nodes.indexOf(node),1)},tick:function(){var distance;requestAnimationFrame($scope.tick),joinLines.clear(),$scope.nodes.forEach(function(node,i){if(node.tick(),$scope.nodes.slice(i).forEach(function(joinNode){var d2=joinNode.position.distanceSquare(node.position);if(thresholdSquare>d2){distance=Math.sqrt(d2);var alpha=(threshold-distance)/threshold*.4+.05*Math.random();joinLines.lineStyle(alpha*(node.radius+joinNode.radius)*3,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo(joinNode.position.x,joinNode.position.y)}}),$scope.mouse.active){var mDist=node.position.distanceSquare($scope.mouse);if(mouseThresholdSquare>mDist){distance=Math.sqrt(mDist);var alpha=(mouseThreshold-distance)/mouseThreshold*.4+.05*Math.random();joinLines.lineStyle(1,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo($scope.mouse.x,$scope.mouse.y)}}}),backgroundSprite.alpha=0,joinLines.alpha=.1,renderTexture2.render($scope.stage,null,!0),joinLines.alpha=1,backgroundSprite.alpha=1;var temp=renderTexture;renderTexture=renderTexture2,renderTexture2=temp,shadowSprite.texture=renderTexture,renderer.render($scope.stage)}};return $scope.init(),$scope},Vector2=function(x,y){"use strict";x||(x=0),y||(y=0);var $scope={x:x,y:y,add:function(vector,scale){return scale=scale||1,$scope.x+=vector.x*scale,$scope.y+=vector.y*scale,$scope},set:function(x,y){return $scope.x=x,$scope.y=y,$scope},scale:function(multiplier){return $scope.x*=multiplier,$scope.y*=multiplier,$scope},clamp:function(min,max){return $scope.x=Math.min(Math.max($scope.x,min),max),$scope.y=Math.min(Math.max($scope.y,min),max),$scope},clampAbs:function(val){return $scope.clamp(-val,val),$scope},distance:function(vector){return Math.sqrt($scope.distanceSquare(vector))},distanceSquare:function(vector){var dX=Math.pow(vector.x-$scope.x,2),dY=Math.pow(vector.y-$scope.y,2);return dX+dY}};return $scope};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhbnZhc1RleHR1cmUuanMiLCJQYXJ0aWNsZS5qcyIsIlN0YXJNYXAuanMiLCJWZWN0b3IyLmpzIl0sIm5hbWVzIjpbIkNhbnZhc1RleHR1cmUiLCJjYiIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsIlBJWEkiLCJUZXh0dXJlIiwiZnJvbUNhbnZhcyIsIlBhcnRpY2xlIiwicG9zaXRpb24iLCJhcHAiLCJyYWRpdXMiLCJNYXRoIiwicmFuZG9tIiwiaGFsb1JhZGl1cyIsImNlaWwiLCJjb2xvdXIiLCJyZWQiLCJncmVlbiIsImJsdWUiLCJyb3VuZCIsInRleHR1cmUiLCJ3aWR0aCIsImhlaWdodCIsImN0eCIsImdldENvbnRleHQiLCJmaWxsU3R5bGUiLCJiZWdpblBhdGgiLCJhcmMiLCJmaWxsIiwiZ3JkIiwiY3JlYXRlUmFkaWFsR3JhZGllbnQiLCJhZGRDb2xvclN0b3AiLCJzcHJpdGUiLCJTcHJpdGUiLCJibGVuZE1vZGUiLCJCTEVORF9NT0RFUyIsIlNDUkVFTiIsInN0YWdlIiwiYWRkQ2hpbGQiLCIkc2NvcGUiLCJhY2NlbGVyYXRpb24iLCJWZWN0b3IyIiwidmVsb2NpdHkiLCJpbml0IiwidGljayIsImFscGhhIiwic2V0Iiwic2NhbGUiLCJtYXhTcGVlZCIsImNsYW1wQWJzIiwiYWRkIiwieCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJ5IiwiaW5uZXJIZWlnaHQiLCJTdGFyTWFwIiwic3RhckNvdW50IiwidGhyZXNob2xkIiwicmVuZGVyZXIiLCJhdXRvRGV0ZWN0UmVuZGVyZXIiLCJiYWNrZ3JvdW5kQ29sb3IiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJ2aWV3IiwiQ29udGFpbmVyIiwiam9pbkxpbmVzIiwiR3JhcGhpY3MiLCJBREQiLCJiYWNrZ3JvdW5kVGV4dHVyZSIsImZpbGxSZWN0IiwicmVuZGVyVGV4dHVyZSIsIlJlbmRlclRleHR1cmUiLCJyZW5kZXJUZXh0dXJlMiIsImJhY2tncm91bmRTcHJpdGUiLCJzaGFkb3dTcHJpdGUiLCJjb252b2x1dGlvbkZpbHRlciIsImZpbHRlcnMiLCJDb252b2x1dGlvbkZpbHRlciIsInRocmVzaG9sZFNxdWFyZSIsInBvdyIsIm1vdXNlVGhyZXNob2xkIiwibW91c2VUaHJlc2hvbGRTcXVhcmUiLCJtb3VzZSIsIm5vZGVzIiwicCIsImFkZE5vZGUiLCJhY3RpdmUiLCJub2RlIiwicHVzaCIsInJlbW92ZU5vZGUiLCJzcGxpY2UiLCJpbmRleE9mIiwiZGlzdGFuY2UiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjbGVhciIsImZvckVhY2giLCJpIiwic2xpY2UiLCJqb2luTm9kZSIsImQyIiwiZGlzdGFuY2VTcXVhcmUiLCJzcXJ0IiwibGluZVN0eWxlIiwibW92ZVRvIiwibGluZVRvIiwibURpc3QiLCJyZW5kZXIiLCJ0ZW1wIiwidmVjdG9yIiwibXVsdGlwbGllciIsImNsYW1wIiwibWluIiwibWF4IiwidmFsIiwiZFgiLCJkWSJdLCJtYXBwaW5ncyI6IkFBT0EsR0FBQUEsZUFBQSxTQUFBQyxJQUNBLEdBQUFDLFFBQUFDLFNBQUFDLGNBQUEsU0FFQSxPQURBLGtCQUFBSCxLQUFBQSxHQUFBQyxRQUNBRyxLQUFBQyxRQUFBQyxXQUFBTCxTQ0xBTSxTQUFBLFNBQUFDLFNBQUFDLEtBQ0EsWUFDQSxJQUFBQyxRQUFBLElBQUFDLEtBQUFDLFNBQUEsRUFDQUMsV0FBQUYsS0FBQUcsS0FBQSxHQUFBSixRQUNBSyxRQUNBQyxJQUFBLElBQ0FDLE1BQUEsSUFDQUMsS0FBQSxJQUVBUCxNQUFBQyxTQUFBLEtBQ0FHLE9BQUFDLElBQUFMLEtBQUFRLE1BQUEsSUFBQVIsS0FBQUMsU0FBQSxJQUNBRyxPQUFBRSxNQUFBTixLQUFBUSxNQUFBLElBQUFSLEtBQUFDLFNBQUEsSUFDQUcsT0FBQUcsS0FBQSxJQUdBLElBQUFFLFNBQUEsR0FBQXJCLGVBQUEsU0FBQUUsUUFDQUEsT0FBQW9CLE1BQUFSLFdBQ0FaLE9BQUFxQixPQUFBVCxVQUVBLElBQUFVLEtBQUF0QixPQUFBdUIsV0FBQSxL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QUFBLFNBQUFpRSxLQUVBLE1BREEzRSxRQUFBd0UsT0FBQUcsSUFBQUEsS0FDQTNFLFFBRUFzRCxTQUFBLFNBQUFnQixRQUNBLE1BQUFsRyxNQUFBMkYsS0FBQS9ELE9BQUE4RCxlQUFBUSxVQUVBUixlQUFBLFNBQUFRLFFBQ0EsR0FBQU0sSUFBQXhHLEtBQUFxRSxJQUFBNkIsT0FBQTFELEVBQUFaLE9BQUFZLEVBQUEsR0FDQWlFLEdBQUF6RyxLQUFBcUUsSUFBQTZCLE9BQUF2RCxFQUFBZixPQUFBZSxFQUFBLEVBQ0EsT0FBQTZELElBQUFDLElBSUEsT0FBQTdFIiwiZmlsZSI6InN0YXJtYXAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKlxuICogQHBhcmFtIGNiXG4gKiBAcmV0dXJucyB7UElYSS5CYXNlVGV4dHVyZXxQSVhJLlRleHR1cmV9XG4gKiBAY29uc3RydWN0b3JcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG52YXIgQ2FudmFzVGV4dHVyZSA9IGZ1bmN0aW9uIChjYikge1xuICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICBpZiAodHlwZW9mIGNiID09ICdmdW5jdGlvbicpIGNiKGNhbnZhcyk7XG4gICAgcmV0dXJuIFBJWEkuVGV4dHVyZS5mcm9tQ2FudmFzKGNhbnZhcyk7XG59OyIsIi8qKlxuICpcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG5cbnZhciBQYXJ0aWNsZSA9IGZ1bmN0aW9uIChwb3NpdGlvbiwgYXBwKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciByYWRpdXMgPSBNYXRoLnJhbmRvbSgpICogMS4xICsgMTtcbiAgICB2YXIgaGFsb1JhZGl1cyA9IE1hdGguY2VpbChyYWRpdXMgKiAyMCk7XG4gICAgdmFyIGNvbG91ciA9IHtcbiAgICAgICAgcmVkOiAyNTUsXG4gICAgICAgIGdyZWVuOiAyNTUsXG4gICAgICAgIGJsdWU6IDI1NVxuICAgIH07XG4gICAgaWYgKE1hdGgucmFuZG9tKCkgPiAwLjcpIHtcbiAgICAgICAgY29sb3VyLnJlZCA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDEwMCArIDU1KTtcbiAgICAgICAgY29sb3VyLmdyZWVuID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMTAwICsgNTUpO1xuICAgICAgICBjb2xvdXIuYmx1ZSA9IDI1NTtcbiAgICB9XG5cbiAgICB2YXIgdGV4dHVyZSA9IG5ldyBDYW52YXNUZXh0dXJlKGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgICAgY2FudmFzLndpZHRoID0gaGFsb1JhZGl1cztcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGhhbG9SYWRpdXM7XG4gICAgICAgIC8vQ29yZVxuICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiKCcgKyBjb2xvdXIucmVkICsgJywnICsgY29sb3VyLmdyZWVuICsgJywnICsgY29sb3VyLmJsdWUgKyAnKSc7XG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgY3R4LmFyYyhoYWxvUmFkaXVzIC8gMiwgaGFsb1JhZGl1cyAvIDIsIHJhZGl1cywgMCwgMzYwLCBmYWxzZSk7XG4gICAgICAgIGN0eC5maWxsKCk7XG4gICAgICAgIC8vSGFsb1xuICAgICAgICB2YXIgZ3JkID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KGhhbG9SYWRpdXMgLyAyLCBoYWxvUmFkaXVzIC8gMiwgcmFkaXVzLCBoYWxvUmFkaXVzIC8gMiwgaGFsb1JhZGl1cyAvIDIsIE1hdGguY2VpbChoYWxvUmFkaXVzKSk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoJyArIGNvbG91ci5yZWQgKyAnLCcgKyBjb2xvdXIuZ3JlZW4gKyAnLCcgKyBjb2xvdXIuYmx1ZSArICcsJyArIDAuMDUgKyAnKScpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAuMywgJ3JnYmEoJyArIGNvbG91ci5yZWQgKyAnLCcgKyBjb2xvdXIuZ3JlZW4gKyAnLCcgKyBjb2xvdXIuYmx1ZSArICcsMCknKTtcblxuICAgICAgICBjdHguZmlsbFN0eWxlID0gZ3JkO1xuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5hcmMoaGFsb1JhZGl1cyAvIDIsIGhhbG9SYWRpdXMgLyAyLCBoYWxvUmFkaXVzLCAwLCAzNjAsIGZhbHNlKTtcbiAgICAgICAgLy9jdHguZmlsbCgpO1xuICAgIH0pO1xuICAgIHZhciBzcHJpdGUgPSBuZXcgUElYSS5TcHJpdGUodGV4dHVyZSk7XG4gICAgLy9zcHJpdGUuYmxlbmRNb2RlID0gUElYSS5CTEVORF9NT0RFUy5BREQ7XG4gICAgc3ByaXRlLmJsZW5kTW9kZSA9IFBJWEkuQkxFTkRfTU9ERVMuU0NSRUVOO1xuICAgIC8vc3ByaXRlLmJsZW5kTW9kZSA9IFBJWEkuQkxFTkRfTU9ERVMuSEFSRF9MSUdIVDtcbiAgICAvL3Nwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLlNDUkVFTjtcbiAgICBhcHAuc3RhZ2UuYWRkQ2hpbGQoc3ByaXRlKTtcblxuICAgIC8vYXBwLnN0YWdlLmFkZENoaWxkKGpvaW5MaW5lcyk7XG4gICAgdmFyICRzY29wZSA9IHtcbiAgICAgICAgc3ByaXRlOiBzcHJpdGUsXG4gICAgICAgIHN0YWdlOiBhcHAsXG4gICAgICAgIHJhZGl1czogcmFkaXVzLFxuICAgICAgICBhY2NlbGVyYXRpb246IG5ldyBWZWN0b3IyKCksXG4gICAgICAgIHZlbG9jaXR5OiBuZXcgVmVjdG9yMihNYXRoLnJhbmRvbSgpIC0gMC41LCBNYXRoLnJhbmRvbSgpIC0gMC41KSxcbiAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxuICAgICAgICBjb2xvdXI6IHtcbiAgICAgICAgICAgIHJlZDogMjU1LFxuICAgICAgICAgICAgZ3JlZW46IDI1NSxcbiAgICAgICAgICAgIGJsdWU6IDI1NVxuICAgICAgICB9LFxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA+IDAuNykge1xuICAgICAgICAgICAgICAgICRzY29wZS5jb2xvdXIucmVkID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMjAwICsgNTUpO1xuICAgICAgICAgICAgICAgICRzY29wZS5jb2xvdXIuZ3JlZW4gPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAyMDAgKyA1NSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbG91ci5ibHVlID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMjAwICsgNTUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB0aWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvL1R3aW5rbGVcbiAgICAgICAgICAgIHNwcml0ZS5hbHBoYSA9IE1hdGgucmFuZG9tKCkgKiAwLjQgKyAwLjY7XG5cbiAgICAgICAgICAgIC8vTW92ZVxuICAgICAgICAgICAgJHNjb3BlLmFjY2VsZXJhdGlvbi5zZXQoTWF0aC5yYW5kb20oKSAtIDAuNSwgTWF0aC5yYW5kb20oKSAtIDAuNSkuc2NhbGUoYXBwLm1heFNwZWVkKTtcbiAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24uY2xhbXBBYnMoYXBwLm1heFNwZWVkKTtcblxuICAgICAgICAgICAgJHNjb3BlLnZlbG9jaXR5LmFkZCgkc2NvcGUuYWNjZWxlcmF0aW9uLCAwLjEpO1xuXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnBvc2l0aW9uLnggKyAkc2NvcGUudmVsb2NpdHkueCA+IHdpbmRvdy5pbm5lcldpZHRoIHx8ICRzY29wZS5wb3NpdGlvbi54ICsgJHNjb3BlLnZlbG9jaXR5LnggPCAxKSB7XG4gICAgICAgICAgICAgICAgLy9Cb3VuY2UgWFxuICAgICAgICAgICAgICAgICRzY29wZS52ZWxvY2l0eS54ICo9IC0wLjk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFjY2VsZXJhdGlvbi54ICo9IC0wLjk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgkc2NvcGUucG9zaXRpb24ueSArICRzY29wZS52ZWxvY2l0eS55ID4gd2luZG93LmlubmVySGVpZ2h0IHx8ICRzY29wZS5wb3NpdGlvbi55ICsgJHNjb3BlLnZlbG9jaXR5LnkgPCAxKSB7XG4gICAgICAgICAgICAgICAgLy9Cb3VuY2UgWVxuICAgICAgICAgICAgICAgICRzY29wZS52ZWxvY2l0eS55ICo9IC0wLjk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFjY2VsZXJhdGlvbi55ICo9IC0wLjk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUudmVsb2NpdHkuY2xhbXBBYnMoYXBwLm1heFNwZWVkKTtcbiAgICAgICAgICAgICRzY29wZS5wb3NpdGlvbi5hZGQoJHNjb3BlLnZlbG9jaXR5LCAwLjEpO1xuICAgICAgICAgICAgc3ByaXRlLnBvc2l0aW9uLnggPSAkc2NvcGUucG9zaXRpb24ueCAtIChoYWxvUmFkaXVzIC8gMik7XG4gICAgICAgICAgICBzcHJpdGUucG9zaXRpb24ueSA9ICRzY29wZS5wb3NpdGlvbi55IC0gKGhhbG9SYWRpdXMgLyAyKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUuaW5pdCgpO1xuICAgIHJldHVybiAkc2NvcGU7XG59OyIsIi8qKlxuICpcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG5cbnZhciBTdGFyTWFwID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIHN0YXJDb3VudCwgdGhyZXNob2xkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciByZW5kZXJlciA9IFBJWEkuYXV0b0RldGVjdFJlbmRlcmVyKHdpZHRoLCBoZWlnaHQsIHtiYWNrZ3JvdW5kQ29sb3I6IDB4MTYwODMxfSk7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci52aWV3KTtcbiAgICB2YXIgc3RhZ2UgPSBuZXcgUElYSS5Db250YWluZXIoKTtcbiAgICB2YXIgam9pbkxpbmVzID0gbmV3IFBJWEkuR3JhcGhpY3MoKTtcbiAgICBqb2luTGluZXMuYmxlbmRNb2RlID0gUElYSS5CTEVORF9NT0RFUy5BREQ7XG5cbiAgICB2YXIgYmFja2dyb3VuZFRleHR1cmUgPSBuZXcgQ2FudmFzVGV4dHVyZShmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIHZhciBncmQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQod2lkdGggLyAyLCBoZWlnaHQgLyAyLCAxLCB3aWR0aCAvIDIsIGhlaWdodCAvIDIsIGhlaWdodCk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMCwgJ3JnYigyMiw4LDQ5KScpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAuNCwgJ3JnYigyMiw4LDQ5KScpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDAuNiwgJ3JnYigxMiw3LDI0KScpO1xuICAgICAgICBncmQuYWRkQ29sb3JTdG9wKDEsICdyZ2IoMCwwLDApJyk7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmQ7XG4gICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9KTtcblxuICAgIHZhciByZW5kZXJUZXh0dXJlID0gbmV3IFBJWEkuUmVuZGVyVGV4dHVyZShyZW5kZXJlciwgd2lkdGgsIGhlaWdodCk7XG4gICAgdmFyIHJlbmRlclRleHR1cmUyID0gbmV3IFBJWEkuUmVuZGVyVGV4dHVyZShyZW5kZXJlciwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICB2YXIgYmFja2dyb3VuZFNwcml0ZSA9IG5ldyBQSVhJLlNwcml0ZShiYWNrZ3JvdW5kVGV4dHVyZSk7XG4gICAgdmFyIHNoYWRvd1Nwcml0ZSA9IG5ldyBQSVhJLlNwcml0ZShyZW5kZXJUZXh0dXJlKTtcbiAgICB2YXIgY29udm9sdXRpb25GaWx0ZXIgPSBuZXcgUElYSS5maWx0ZXJzLkNvbnZvbHV0aW9uRmlsdGVyKFtcbiAgICAgICAgMC4xLCAwLjQsIDAuMSxcbiAgICAgICAgMC40LCAwLjAsIDAuNCxcbiAgICAgICAgMC4xLCAwLjQsIDAuMVxuICAgIF0sIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgc2hhZG93U3ByaXRlLmFscGhhID0gMC40OTtcbiAgICAvL3NoYWRvd1Nwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLlNPRlRfTElHSFQ7XG5cbiAgICAvKiB2YXIgZmlsdGVyID0gbmV3IFBJWEkuZmlsdGVycy5Db252b2x1dGlvbkZpbHRlcihbXG4gICAgIDAuMSwwLjEsMC4xLFxuICAgICAwLjEsMC4yLDAuMSxcbiAgICAgMC4xLDAuMSwwLjFcbiAgICAgXSx3aWR0aCxoZWlnaHQpOyovXG4gICAgc2hhZG93U3ByaXRlLmZpbHRlcnMgPSBbY29udm9sdXRpb25GaWx0ZXJdO1xuICAgIC8vc2hhZG93U3ByaXRlLmJsZW5kTW9kZSA9IFBJWEkuQkxFTkRfTU9ERVMuT1ZFUkxBWTtcbiAgICAvL3NoYWRvd1Nwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLkFERDtcbiAgICAvL3NoYWRvd1Nwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLlNPRlRfTElHSFQ7XG4gICAgc3RhZ2UuYWRkQ2hpbGQoYmFja2dyb3VuZFNwcml0ZSk7XG5cblxuICAgIHZhciB0aHJlc2hvbGRTcXVhcmUgPSBNYXRoLnBvdyh0aHJlc2hvbGQsIDIpO1xuICAgIHZhciBtb3VzZVRocmVzaG9sZCA9IHRocmVzaG9sZCAqIDEwO1xuICAgIHZhciBtb3VzZVRocmVzaG9sZFNxdWFyZSA9IHRocmVzaG9sZFNxdWFyZSAqIDEwO1xuICAgIHZhciAkc2NvcGUgPSB7XG4gICAgICAgIG1heFNwZWVkOiAxMCxcbiAgICAgICAgbW91c2U6IG5ldyBWZWN0b3IyKCksXG4gICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgIHN0YWdlOiBzdGFnZSxcbiAgICAgICAgam9pbkxpbmVzOiBqb2luTGluZXMsXG4gICAgICAgIG5vZGVzOiBbXSxcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdGFyQ291bnQ7IHgrKykge1xuICAgICAgICAgICAgICAgIHZhciBwID0gbmV3IFBhcnRpY2xlKG5ldyBWZWN0b3IyKE1hdGgucmFuZG9tKCkgKiB3aWR0aCwgTWF0aC5yYW5kb20oKSAqIGhlaWdodCksICRzY29wZSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFkZE5vZGUocCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUubW91c2UuYWN0aXZlID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHN0YWdlLmFkZENoaWxkKGpvaW5MaW5lcyk7XG4gICAgICAgICAgICBzdGFnZS5hZGRDaGlsZChzaGFkb3dTcHJpdGUpO1xuICAgICAgICB9LFxuICAgICAgICBhZGROb2RlOiBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgJHNjb3BlLm5vZGVzLnB1c2gobm9kZSk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlbW92ZU5vZGU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAkc2NvcGUubm9kZXMuc3BsaWNlKCRzY29wZS5ub2Rlcy5pbmRleE9mKG5vZGUpLCAxKTtcbiAgICAgICAgfSxcbiAgICAgICAgdGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGRpc3RhbmNlO1xuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCRzY29wZS50aWNrKTtcbiAgICAgICAgICAgIGpvaW5MaW5lcy5jbGVhcigpO1xuICAgICAgICAgICAgJHNjb3BlLm5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGUsIGkpIHtcbiAgICAgICAgICAgICAgICAvL1BhcnRpY2xlc1xuICAgICAgICAgICAgICAgIG5vZGUudGljaygpO1xuICAgICAgICAgICAgICAgIC8vSm9pbiBsaW5lc1xuICAgICAgICAgICAgICAgICRzY29wZS5ub2Rlcy5zbGljZShpKS5mb3JFYWNoKGZ1bmN0aW9uIChqb2luTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZDIgPSBqb2luTm9kZS5wb3NpdGlvbi5kaXN0YW5jZVNxdWFyZShub2RlLnBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQyIDwgdGhyZXNob2xkU3F1YXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IE1hdGguc3FydChkMik7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxwaGEgPSAoKCh0aHJlc2hvbGQgLSBkaXN0YW5jZSkgLyB0aHJlc2hvbGQpICogMC40KSArIChNYXRoLnJhbmRvbSgpICogMC4wNSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubGluZVN0eWxlKGFscGhhICogKG5vZGUucmFkaXVzICsgam9pbk5vZGUucmFkaXVzKSAqIDMsIDB4MDBkYmZmLCBhbHBoYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubW92ZVRvKG5vZGUucG9zaXRpb24ueCwgbm9kZS5wb3NpdGlvbi55KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5saW5lVG8oam9pbk5vZGUucG9zaXRpb24ueCwgam9pbk5vZGUucG9zaXRpb24ueSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vTW91c2UgcmVwdWxzZVxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5tb3VzZS5hY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1EaXN0ID0gbm9kZS5wb3NpdGlvbi5kaXN0YW5jZVNxdWFyZSgkc2NvcGUubW91c2UpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobURpc3QgPCBtb3VzZVRocmVzaG9sZFNxdWFyZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBNYXRoLnNxcnQobURpc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhID0gKCgobW91c2VUaHJlc2hvbGQgLSBkaXN0YW5jZSkgLyBtb3VzZVRocmVzaG9sZCkgKiAwLjQpICsgKE1hdGgucmFuZG9tKCkgKiAwLjA1KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5saW5lU3R5bGUoMSwgMHgwMGRiZmYsIGFscGhhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5tb3ZlVG8obm9kZS5wb3NpdGlvbi54LCBub2RlLnBvc2l0aW9uLnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgam9pbkxpbmVzLmxpbmVUbygkc2NvcGUubW91c2UueCwgJHNjb3BlLm1vdXNlLnkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy9SZW5kZXIgc3RhcnMgdG8gdGV4dHVyZSwgYnV0IG1vdmUgaXQgb2Zmc2NyZWVuIChmb3IgbmV4dCBmcmFtZSlcbiAgICAgICAgICAgIGJhY2tncm91bmRTcHJpdGUuYWxwaGEgPSAwO1xuICAgICAgICAgICAgam9pbkxpbmVzLmFscGhhID0gMC4xO1xuICAgICAgICAgICAgcmVuZGVyVGV4dHVyZTIucmVuZGVyKCRzY29wZS5zdGFnZSwgbnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgICBqb2luTGluZXMuYWxwaGEgPSAxO1xuICAgICAgICAgICAgYmFja2dyb3VuZFNwcml0ZS5hbHBoYSA9IDE7XG5cbiAgICAgICAgICAgIC8vQnJpbmcgcHJldmlvdXMgZnJhbWVzIHN0YXJzIG9uc2NyZWVuIGZvciBnbG93c1xuICAgICAgICAgICAgdmFyIHRlbXAgPSByZW5kZXJUZXh0dXJlO1xuICAgICAgICAgICAgcmVuZGVyVGV4dHVyZSA9IHJlbmRlclRleHR1cmUyO1xuICAgICAgICAgICAgcmVuZGVyVGV4dHVyZTIgPSB0ZW1wO1xuICAgICAgICAgICAgc2hhZG93U3ByaXRlLnRleHR1cmUgPSByZW5kZXJUZXh0dXJlO1xuXG4gICAgICAgICAgICByZW5kZXJlci5yZW5kZXIoJHNjb3BlLnN0YWdlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgJHNjb3BlLmluaXQoKTtcbiAgICByZXR1cm4gJHNjb3BlO1xufTsiLCIvKipcbiAqXG4gKiBAYXV0aG9yIEFkYW0gQmVuc29uIDxhZGFtQHByZWNhcmlvdXNwYW50aGVyLm5ldD5cbiAqL1xuXG4vKipcbiAqXG4gKiBAcGFyYW0ge2ludH0gW3hdXG4gKiBAcGFyYW0ge2ludH0gW3ldXG4gKiBAY29uc3RydWN0b3JcbiAqL1xudmFyIFZlY3RvcjIgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBpZiAoIXgpeCA9IDA7XG4gICAgaWYgKCF5KXkgPSAwO1xuICAgIHZhciAkc2NvcGUgPSB7XG4gICAgICAgIHg6IHgsXG4gICAgICAgIHk6IHksXG4gICAgICAgIGFkZDogZnVuY3Rpb24gKHZlY3Rvciwgc2NhbGUpIHtcbiAgICAgICAgICAgIHNjYWxlID0gc2NhbGUgfHwgMTtcbiAgICAgICAgICAgICRzY29wZS54ICs9IHZlY3Rvci54ICogc2NhbGU7XG4gICAgICAgICAgICAkc2NvcGUueSArPSB2ZWN0b3IueSAqIHNjYWxlO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICAgICAgJHNjb3BlLnggPSB4O1xuICAgICAgICAgICAgJHNjb3BlLnkgPSB5O1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2NhbGU6IGZ1bmN0aW9uIChtdWx0aXBsaWVyKSB7XG4gICAgICAgICAgICAkc2NvcGUueCAqPSBtdWx0aXBsaWVyO1xuICAgICAgICAgICAgJHNjb3BlLnkgKj0gbXVsdGlwbGllcjtcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGU7XG4gICAgICAgIH0sXG4gICAgICAgIGNsYW1wOiBmdW5jdGlvbiAobWluLCBtYXgpIHtcbiAgICAgICAgICAgICRzY29wZS54ID0gTWF0aC5taW4oTWF0aC5tYXgoJHNjb3BlLngsIG1pbiksIG1heCk7XG4gICAgICAgICAgICAkc2NvcGUueSA9IE1hdGgubWluKE1hdGgubWF4KCRzY29wZS55LCBtaW4pLCBtYXgpO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgY2xhbXBBYnM6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICRzY29wZS5jbGFtcCgtdmFsLCB2YWwpO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgZGlzdGFuY2U6IGZ1bmN0aW9uICh2ZWN0b3IpIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQoJHNjb3BlLmRpc3RhbmNlU3F1YXJlKHZlY3RvcikpO1xuICAgICAgICB9LFxuICAgICAgICBkaXN0YW5jZVNxdWFyZTogZnVuY3Rpb24gKHZlY3Rvcikge1xuICAgICAgICAgICAgdmFyIGRYID0gTWF0aC5wb3codmVjdG9yLnggLSAkc2NvcGUueCwgMik7XG4gICAgICAgICAgICB2YXIgZFkgPSBNYXRoLnBvdyh2ZWN0b3IueSAtICRzY29wZS55LCAyKTtcbiAgICAgICAgICAgIHJldHVybiBkWCArIGRZO1xuICAgICAgICB9XG5cbiAgICB9O1xuICAgIHJldHVybiAkc2NvcGU7XG59OyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
