var CanvasTexture=function(cb){var canvas=document.createElement("canvas");return"function"==typeof cb&&cb(canvas),PIXI.Texture.fromCanvas(canvas)},Particle=function(position,app){"use strict";var sprite=new PIXI.Sprite;sprite.blendMode=PIXI.BLEND_MODES.SCREEN,app.stage.addChild(sprite);var state={ALIVE:"ALIVE",DYING:"DYING",DEAD:"DEAD"},$scope={alpha:1,state:state.ALIVE,sprite:sprite,stage:app,radius:0,haloRadius:0,colour:{red:255,green:255,blue:255},acceleration:new Vector2,velocity:new Vector2(Math.random()-.5,Math.random()-.5),position:position,init:function(){$scope.radius=1.1*Math.random()+1,Math.random()>.7&&($scope.colour.red=Math.round(100*Math.random()+55),$scope.colour.green=Math.round(100*Math.random()+55),$scope.colour.blue=255),$scope.createTexture($scope.radius)},createTexture:function(radius){$scope.haloRadius=Math.ceil(20*radius),sprite.texture=new CanvasTexture(function(canvas){canvas.width=$scope.haloRadius,canvas.height=$scope.haloRadius;var ctx=canvas.getContext("2d");ctx.fillStyle="rgb("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+")",ctx.beginPath(),ctx.arc($scope.haloRadius/2,$scope.haloRadius/2,radius,0,360,!1),ctx.fill();var grd=ctx.createRadialGradient($scope.haloRadius/2,$scope.haloRadius/2,radius,$scope.haloRadius/2,$scope.haloRadius/2,Math.ceil($scope.haloRadius));grd.addColorStop(0,"rgba("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+",0.05)"),grd.addColorStop(.3,"rgba("+$scope.colour.red+","+$scope.colour.green+","+$scope.colour.blue+",0)"),ctx.fillStyle=grd,ctx.beginPath(),ctx.arc($scope.haloRadius/2,$scope.haloRadius/2,$scope.haloRadius,0,360,!1)})},die:function(){$scope.state=state.DYING},tick:function(){if($scope.state!=state.DYING)sprite.alpha=.4*Math.random()+.6,$scope.acceleration.set(Math.random()-.5,Math.random()-.5).scale(app.maxSpeed),$scope.acceleration.clampAbs(app.maxSpeed),$scope.velocity.add($scope.acceleration,.1),($scope.position.x+$scope.velocity.x>window.innerWidth||$scope.position.x+$scope.velocity.x<1)&&($scope.velocity.x*=-.9,$scope.acceleration.x*=-.9),($scope.position.y+$scope.velocity.y>window.innerHeight||$scope.position.y+$scope.velocity.y<1)&&($scope.velocity.y*=-.9,$scope.acceleration.y*=-.9),$scope.velocity.clampAbs(app.maxSpeed),$scope.position.add($scope.velocity,.1),sprite.position.x=$scope.position.x-$scope.haloRadius/2,sprite.position.y=$scope.position.y-$scope.haloRadius/2;else if($scope.alpha-=.01,sprite.alpha=$scope.alpha,$scope.alpha<=0)return void($scope.state=state.DEAD)}};return $scope.init(),$scope},StarMap=function(width,height,maxStars){"use strict";var threshold=Math.max((width+height)/2/40,30),maxLines=7*maxStars,renderer=PIXI.autoDetectRenderer(width,height,{backgroundColor:1443889});document.body.appendChild(renderer.view);var stage=new PIXI.Container,joinLines=new PIXI.Graphics;joinLines.blendMode=PIXI.BLEND_MODES.ADD;var counter=$('<span class="counter"></span>').appendTo(document.body),backgroundTexture=new CanvasTexture(function(canvas){canvas.width=width,canvas.height=height;var ctx=canvas.getContext("2d"),grd=ctx.createRadialGradient(width/2,height/2,1,width/2,height/2,height);grd.addColorStop(0,"rgb(22,8,49)"),grd.addColorStop(.4,"rgb(22,8,49)"),grd.addColorStop(.6,"rgb(12,7,24)"),grd.addColorStop(1,"rgb(0,0,0)"),ctx.fillStyle=grd,ctx.fillRect(0,0,width,height)}),renderTexture=new PIXI.RenderTexture(renderer,width,height),renderTexture2=new PIXI.RenderTexture(renderer,width,height),backgroundSprite=new PIXI.Sprite(backgroundTexture),shadowSprite=new PIXI.Sprite(renderTexture),convolutionFilter=new PIXI.filters.ConvolutionFilter([.1,.4,.1,.4,0,.4,.1,.4,.1],width,height);shadowSprite.alpha=.41,shadowSprite.filters=[convolutionFilter],stage.addChild(backgroundSprite);var lineCount,joinCount,thresholdSquare=Math.pow(threshold,2),mouseThreshold=10*threshold,mouseThresholdSquare=10*thresholdSquare,$scope={maxSpeed:10,mouse:new Vector2,width:width,height:height,stage:stage,joinLines:joinLines,nodes:[],deadNodes:[],init:function(){for(var x=0;maxStars>x;x++)$scope.addStar(new Vector2(Math.random()*width,Math.random()*height),$scope);$scope.mouse.active=!1,stage.addChild(joinLines),stage.addChild(shadowSprite)},addStar:function(position){var p=new Particle(position,$scope);$scope.addNode(p),$scope.nodes.length>maxStars&&$scope.killNode()},addNode:function(node){$scope.nodes.push(node)},clear:function(){$scope.nodes.forEach(function(node,i){stage.removeChild(node.sprite)}),$scope.nodes=[]},killNode:function(){var dead=$scope.nodes.shift();$scope.deadNodes.push(dead),dead.die()},tick:function(){var distance;counter.html($scope.nodes.length+$scope.deadNodes.length),$scope.nodes.length>maxStars&&$scope.killNode(),lineCount=0,requestAnimationFrame($scope.tick),joinLines.clear(),$scope.nodes.forEach(function(node,i){if(node.tick(),maxLines>lineCount&&(joinCount=0,$scope.nodes.slice(i).forEach(function(joinNode){if(!(lineCount>maxLines||joinCount>12)){var d2=joinNode.position.distanceSquare(node.position);if(thresholdSquare>d2){lineCount++,joinCount++,distance=Math.sqrt(d2);var alpha=(threshold-distance)/threshold*.4+.05*Math.random();joinLines.lineStyle(alpha*(node.radius+joinNode.radius)*3,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo(joinNode.position.x,joinNode.position.y)}}})),$scope.mouse.active){var mDist=node.position.distanceSquare($scope.mouse);if(mouseThresholdSquare>mDist){distance=Math.sqrt(mDist);var alpha=(mouseThreshold-distance)/mouseThreshold*.4+.05*Math.random();joinLines.lineStyle(1,56319,alpha),joinLines.moveTo(node.position.x,node.position.y),joinLines.lineTo($scope.mouse.x,$scope.mouse.y)}}}),$scope.deadNodes.forEach(function(node,i){node.tick(),"DEAD"==node.state&&(stage.removeChild(node.sprite),$scope.deadNodes.splice($scope.deadNodes.indexOf(node),1))}),backgroundSprite.alpha=0,joinLines.alpha=.1,renderTexture2.render($scope.stage,null,!0),joinLines.alpha=1,backgroundSprite.alpha=1;var temp=renderTexture;renderTexture=renderTexture2,renderTexture2=temp,shadowSprite.texture=renderTexture,renderer.render($scope.stage)}};return $scope.init(),$scope},Vector2=function(x,y){"use strict";x||(x=0),y||(y=0);var $scope={x:x,y:y,add:function(vector,scale){return scale=scale||1,$scope.x+=vector.x*scale,$scope.y+=vector.y*scale,$scope},set:function(x,y){return $scope.x=x,$scope.y=y,$scope},scale:function(multiplier){return $scope.x*=multiplier,$scope.y*=multiplier,$scope},clamp:function(min,max){return $scope.x=Math.min(Math.max($scope.x,min),max),$scope.y=Math.min(Math.max($scope.y,min),max),$scope},clampAbs:function(val){return $scope.clamp(-val,val),$scope},distance:function(vector){return Math.sqrt($scope.distanceSquare(vector))},distanceSquare:function(vector){var dX=Math.pow(vector.x-$scope.x,2),dY=Math.pow(vector.y-$scope.y,2);return dX+dY}};return $scope};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhbnZhc1RleHR1cmUuanMiLCJQYXJ0aWNsZS5qcyIsIlN0YXJNYXAuanMiLCJWZWN0b3IyLmpzIl0sIm5hbWVzIjpbIkNhbnZhc1RleHR1cmUiLCJjYiIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsIlBJWEkiLCJUZXh0dXJlIiwiZnJvbUNhbnZhcyIsIlBhcnRpY2xlIiwicG9zaXRpb24iLCJhcHAiLCJzcHJpdGUiLCJTcHJpdGUiLCJibGVuZE1vZGUiLCJCTEVORF9NT0RFUyIsIlNDUkVFTiIsInN0YWdlIiwiYWRkQ2hpbGQiLCJzdGF0ZSIsIkFMSVZFIiwiRFlJTkciLCJERUFEIiwiJHNjb3BlIiwiYWxwaGEiLCJyYWRpdXMiLCJoYWxvUmFkaXVzIiwiY29sb3VyIiwicmVkIiwiZ3JlZW4iLCJibHVlIiwiYWNjZWxlcmF0aW9uIiwiVmVjdG9yMiIsInZlbG9jaXR5IiwiTWF0aCIsInJhbmRvbSIsImluaXQiLCJyb3VuZCIsImNyZWF0ZVRleHR1cmUiLCJjZWlsIiwidGV4dHVyZSIsIndpZHRoIiwiaGVpZ2h0IiwiY3R4IiwiZ2V0Q29udGV4dCIsImZpbGxTdHlsZSIsImJlZ2luUGF0aCIsImFyYyIsImZpbGwiLCJncmQiLCJjcmVhdGVSYWRpYWxHcmFkaWVudCIsImFkZENvbG9yU3RvcCIsImRpZSIsInRpY2siLCJzZXQiLCJzY2FsZSIsIm1heFNwZWVkIiwiY2xhbXBBYnMiLCJhZGQiLCJ4Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsInkiLCJpbm5lckhlaWdodCIsIlN0YXJNYXAiLCJtYXhTdGFycyIsInRocmVzaG9sZCIsIm1heCIsIm1heExpbmVzIiwicmVuZGVyZXIiLCJhdXRvRGV0ZWN0UmVuZGVyZXIiLCJiYWNrZ3JvdW5kQ29sb3IiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJ2aWV3IiwiQ29udGFpbmVyIiwiam9pbkxpbmVzIiwiR3JhcGhpY3MiLCJBREQiLCJjb3VudGVyIiwiJCIsImFwcGVuZFRvIiwiYmFja2dyb3VuZFRleHR1cmUiLCJmaWxsUmVjdCIsInJlbmRlclRleHR1cmUiLCJSZW5kZXJUZXh0dXJlIiwicmVuZGVyVGV4dHVyZTIiLCJiYWNrZ3JvdW5kU3ByaXRlIiwic2hhZG93U3ByaXRlIiwiY29udm9sdXRpb25GaWx0ZXIiLCJmaWx0ZXJzIiwiQ29udm9sdXRpb25GaWx0ZXIiLCJsaW5lQ291bnQiLCJqb2luQ291bnQiLCJ0aHJlc2hvbGRTcXVhcmUiLCJwb3ciLCJtb3VzZVRocmVzaG9sZCIsIm1vdXNlVGhyZXNob2xkU3F1YXJlIiwibW91c2UiLCJub2RlcyIsImRlYWROb2RlcyIsImFkZFN0YXIiLCJhY3RpdmUiLCJwIiwiYWRkTm9kZSIsImxlbmd0aCIsImtpbGxOb2RlIiwibm9kZSIsInB1c2giLCJjbGVhciIsImZvckVhY2giLCJpIiwicmVtb3ZlQ2hpbGQiLCJkZWFkIiwic2hpZnQiLCJkaXN0YW5jZSIsImh0bWwiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJzbGljZSIsImpvaW5Ob2RlIiwiZDIiLCJkaXN0YW5jZVNxdWFyZSIsInNxcnQiLCJsaW5lU3R5bGUiLCJtb3ZlVG8iLCJsaW5lVG8iLCJtRGlzdCIsInNwbGljZSIsImluZGV4T2YiLCJyZW5kZXIiLCJ0ZW1wIiwidmVjdG9yIiwibXVsdGlwbGllciIsImNsYW1wIiwibWluIiwidmFsIiwiZFgiLCJkWSJdLCJtYXBwaW5ncyI6IkFBT0EsR0FBQUEsZUFBQSxTQUFBQyxJQUNBLEdBQUFDLFFBQUFDLFNBQUFDLGNBQUEsU0FFQSxPQURBLGtCQUFBSCxLQUFBQSxHQUFBQyxRQUNBRyxLQUFBQyxRQUFBQyxXQUFBTCxTQ0xBTSxTQUFBLFNBQUFDLFNBQUFDLEtBQ0EsWUFFQSxJQUFBQyxRQUFBLEdBQUFOLE1BQUFPLE1BRUFELFFBQUFFLFVBQUFSLEtBQUFTLFlBQUFDLE9BQ0FMLElBQUFNLE1BQUFDLFNBQUFOLE9BRUEsSUFBQU8sUUFDQUMsTUFBQSxRQUNBQyxNQUFBLFFBQ0FDLEtBQUEsUUFJQUMsUUFDQUMsTUFBQSxFQUNBTCxNQUFB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QUFBLFNBQUFDLElBQUFuRSxLQUdBLE1BRkE1QyxRQUFBb0MsRUFBQXpCLEtBQUFvRyxJQUFBcEcsS0FBQWlDLElBQUE1QyxPQUFBb0MsRUFBQTJFLEtBQUFuRSxLQUNBNUMsT0FBQXVDLEVBQUE1QixLQUFBb0csSUFBQXBHLEtBQUFpQyxJQUFBNUMsT0FBQXVDLEVBQUF3RSxLQUFBbkUsS0FDQTVDLFFBRUFrQyxTQUFBLFNBQUE4RSxLQUVBLE1BREFoSCxRQUFBOEcsT0FBQUUsSUFBQUEsS0FDQWhILFFBRUE0RixTQUFBLFNBQUFnQixRQUNBLE1BQUFqRyxNQUFBd0YsS0FBQW5HLE9BQUFrRyxlQUFBVSxVQUVBVixlQUFBLFNBQUFVLFFBQ0EsR0FBQUssSUFBQXRHLEtBQUE2RCxJQUFBb0MsT0FBQXhFLEVBQUFwQyxPQUFBb0MsRUFBQSxHQUNBOEUsR0FBQXZHLEtBQUE2RCxJQUFBb0MsT0FBQXJFLEVBQUF2QyxPQUFBdUMsRUFBQSxFQUNBLE9BQUEwRSxJQUFBQyxJQUlBLE9BQUFsSCIsImZpbGUiOiJzdGFybWFwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICpcbiAqIEBwYXJhbSBjYlxuICogQHJldHVybnMge1BJWEkuQmFzZVRleHR1cmV8UElYSS5UZXh0dXJlfVxuICogQGNvbnN0cnVjdG9yXG4gKiBAYXV0aG9yIEFkYW0gQmVuc29uIDxhZGFtQHByZWNhcmlvdXNwYW50aGVyLm5ldD5cbiAqL1xudmFyIENhbnZhc1RleHR1cmUgPSBmdW5jdGlvbiAoY2IpIHtcbiAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgaWYgKHR5cGVvZiBjYiA9PSAnZnVuY3Rpb24nKSBjYihjYW52YXMpO1xuICAgIHJldHVybiBQSVhJLlRleHR1cmUuZnJvbUNhbnZhcyhjYW52YXMpO1xufTsiLCIvKipcbiAqXG4gKiBAYXV0aG9yIEFkYW0gQmVuc29uIDxhZGFtQHByZWNhcmlvdXNwYW50aGVyLm5ldD5cbiAqL1xuXG52YXIgUGFydGljbGUgPSBmdW5jdGlvbiAocG9zaXRpb24sIGFwcCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBzcHJpdGUgPSBuZXcgUElYSS5TcHJpdGUoKTtcblxuICAgIHNwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLlNDUkVFTjtcbiAgICBhcHAuc3RhZ2UuYWRkQ2hpbGQoc3ByaXRlKTtcblxuICAgIHZhciBzdGF0ZSA9IHtcbiAgICAgICAgQUxJVkU6IFwiQUxJVkVcIixcbiAgICAgICAgRFlJTkc6IFwiRFlJTkdcIixcbiAgICAgICAgREVBRDogXCJERUFEXCJcbiAgICB9O1xuXG4gICAgLy9hcHAuc3RhZ2UuYWRkQ2hpbGQoam9pbkxpbmVzKTtcbiAgICB2YXIgJHNjb3BlID0ge1xuICAgICAgICBhbHBoYTogMSxcbiAgICAgICAgc3RhdGU6IHN0YXRlLkFMSVZFLFxuICAgICAgICBzcHJpdGU6IHNwcml0ZSxcbiAgICAgICAgc3RhZ2U6IGFwcCxcbiAgICAgICAgcmFkaXVzOiAwLFxuICAgICAgICBoYWxvUmFkaXVzOiAwLFxuICAgICAgICBjb2xvdXI6IHtcbiAgICAgICAgICAgIHJlZDogMjU1LFxuICAgICAgICAgICAgZ3JlZW46IDI1NSxcbiAgICAgICAgICAgIGJsdWU6IDI1NVxuICAgICAgICB9LFxuICAgICAgICBhY2NlbGVyYXRpb246IG5ldyBWZWN0b3IyKCksXG4gICAgICAgIHZlbG9jaXR5OiBuZXcgVmVjdG9yMihNYXRoLnJhbmRvbSgpIC0gMC41LCBNYXRoLnJhbmRvbSgpIC0gMC41KSxcbiAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUucmFkaXVzID0gTWF0aC5yYW5kb20oKSAqIDEuMSArIDE7XG4gICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA+IDAuNykge1xuICAgICAgICAgICAgICAgICRzY29wZS5jb2xvdXIucmVkID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMTAwICsgNTUpO1xuICAgICAgICAgICAgICAgICRzY29wZS5jb2xvdXIuZ3JlZW4gPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMDAgKyA1NSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbG91ci5ibHVlID0gMjU1O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHNjb3BlLmNyZWF0ZVRleHR1cmUoJHNjb3BlLnJhZGl1cyk7XG4gICAgICAgIH0sXG4gICAgICAgIGNyZWF0ZVRleHR1cmU6IGZ1bmN0aW9uIChyYWRpdXMpIHtcbiAgICAgICAgICAgICRzY29wZS5oYWxvUmFkaXVzID0gTWF0aC5jZWlsKHJhZGl1cyAqIDIwKTtcbiAgICAgICAgICAgIHNwcml0ZS50ZXh0dXJlID0gbmV3IENhbnZhc1RleHR1cmUoZnVuY3Rpb24gKGNhbnZhcykge1xuICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9ICRzY29wZS5oYWxvUmFkaXVzO1xuICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSAkc2NvcGUuaGFsb1JhZGl1cztcbiAgICAgICAgICAgICAgICAvL0NvcmVcbiAgICAgICAgICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2IoJyArICRzY29wZS5jb2xvdXIucmVkICsgJywnICsgJHNjb3BlLmNvbG91ci5ncmVlbiArICcsJyArICRzY29wZS5jb2xvdXIuYmx1ZSArICcpJztcbiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICAgICAgY3R4LmFyYygkc2NvcGUuaGFsb1JhZGl1cyAvIDIsICRzY29wZS5oYWxvUmFkaXVzIC8gMiwgcmFkaXVzLCAwLCAzNjAsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBjdHguZmlsbCgpO1xuICAgICAgICAgICAgICAgIC8vSGFsb1xuICAgICAgICAgICAgICAgIHZhciBncmQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCAkc2NvcGUuaGFsb1JhZGl1cyAvIDIsIHJhZGl1cywgJHNjb3BlLmhhbG9SYWRpdXMgLyAyLCAkc2NvcGUuaGFsb1JhZGl1cyAvIDIsIE1hdGguY2VpbCgkc2NvcGUuaGFsb1JhZGl1cykpO1xuICAgICAgICAgICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoJyArICRzY29wZS5jb2xvdXIucmVkICsgJywnICsgJHNjb3BlLmNvbG91ci5ncmVlbiArICcsJyArICRzY29wZS5jb2xvdXIuYmx1ZSArICcsJyArIDAuMDUgKyAnKScpO1xuICAgICAgICAgICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMC4zLCAncmdiYSgnICsgJHNjb3BlLmNvbG91ci5yZWQgKyAnLCcgKyAkc2NvcGUuY29sb3VyLmdyZWVuICsgJywnICsgJHNjb3BlLmNvbG91ci5ibHVlICsgJywwKScpO1xuXG4gICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGdyZDtcbiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICAgICAgY3R4LmFyYygkc2NvcGUuaGFsb1JhZGl1cyAvIDIsICRzY29wZS5oYWxvUmFkaXVzIC8gMiwgJHNjb3BlLmhhbG9SYWRpdXMsIDAsIDM2MCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIC8vY3R4LmZpbGwoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBkaWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vVHJpZ2dlciBmYWRlXG4gICAgICAgICAgICAkc2NvcGUuc3RhdGUgPSBzdGF0ZS5EWUlORztcbiAgICAgICAgfSxcbiAgICAgICAgdGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5zdGF0ZSA9PSBzdGF0ZS5EWUlORykge1xuICAgICAgICAgICAgICAgIC8vRHlpbmdcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWxwaGEgLT0gMC4wMTtcbiAgICAgICAgICAgICAgICBzcHJpdGUuYWxwaGEgPSAkc2NvcGUuYWxwaGE7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hbHBoYSA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdGF0ZSA9IHN0YXRlLkRFQUQ7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vVHdpbmtsZVxuICAgICAgICAgICAgICAgIHNwcml0ZS5hbHBoYSA9IE1hdGgucmFuZG9tKCkgKiAwLjQgKyAwLjY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL01vdmVcbiAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24uc2V0KE1hdGgucmFuZG9tKCkgLSAwLjUsIE1hdGgucmFuZG9tKCkgLSAwLjUpLnNjYWxlKGFwcC5tYXhTcGVlZCk7XG4gICAgICAgICAgICAkc2NvcGUuYWNjZWxlcmF0aW9uLmNsYW1wQWJzKGFwcC5tYXhTcGVlZCk7XG5cbiAgICAgICAgICAgICRzY29wZS52ZWxvY2l0eS5hZGQoJHNjb3BlLmFjY2VsZXJhdGlvbiwgMC4xKTtcblxuICAgICAgICAgICAgaWYgKCRzY29wZS5wb3NpdGlvbi54ICsgJHNjb3BlLnZlbG9jaXR5LnggPiB3aW5kb3cuaW5uZXJXaWR0aCB8fCAkc2NvcGUucG9zaXRpb24ueCArICRzY29wZS52ZWxvY2l0eS54IDwgMSkge1xuICAgICAgICAgICAgICAgIC8vQm91bmNlIFhcbiAgICAgICAgICAgICAgICAkc2NvcGUudmVsb2NpdHkueCAqPSAtMC45O1xuICAgICAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24ueCAqPSAtMC45O1xuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJHNjb3BlLnBvc2l0aW9uLnkgKyAkc2NvcGUudmVsb2NpdHkueSA+IHdpbmRvdy5pbm5lckhlaWdodCB8fCAkc2NvcGUucG9zaXRpb24ueSArICRzY29wZS52ZWxvY2l0eS55IDwgMSkge1xuICAgICAgICAgICAgICAgIC8vQm91bmNlIFlcbiAgICAgICAgICAgICAgICAkc2NvcGUudmVsb2NpdHkueSAqPSAtMC45O1xuICAgICAgICAgICAgICAgICRzY29wZS5hY2NlbGVyYXRpb24ueSAqPSAtMC45O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHNjb3BlLnZlbG9jaXR5LmNsYW1wQWJzKGFwcC5tYXhTcGVlZCk7XG4gICAgICAgICAgICAkc2NvcGUucG9zaXRpb24uYWRkKCRzY29wZS52ZWxvY2l0eSwgMC4xKTtcbiAgICAgICAgICAgIHNwcml0ZS5wb3NpdGlvbi54ID0gJHNjb3BlLnBvc2l0aW9uLnggLSAoJHNjb3BlLmhhbG9SYWRpdXMgLyAyKTtcbiAgICAgICAgICAgIHNwcml0ZS5wb3NpdGlvbi55ID0gJHNjb3BlLnBvc2l0aW9uLnkgLSAoJHNjb3BlLmhhbG9SYWRpdXMgLyAyKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUuaW5pdCgpO1xuICAgIHJldHVybiAkc2NvcGU7XG59OyIsIi8qKlxuICpcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG5cbnZhciBTdGFyTWFwID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIG1heFN0YXJzKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciB0aHJlc2hvbGQgPSBNYXRoLm1heCgoKHdpZHRoICsgaGVpZ2h0KSAvIDIgKSAvIDQwLDMwKTtcbiAgICB2YXIgbWF4TGluZXMgPSBtYXhTdGFycyAqIDc7XG4gICAgdmFyIHJlbmRlcmVyID0gUElYSS5hdXRvRGV0ZWN0UmVuZGVyZXIod2lkdGgsIGhlaWdodCwge2JhY2tncm91bmRDb2xvcjogMHgxNjA4MzF9KTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHJlbmRlcmVyLnZpZXcpO1xuICAgIHZhciBzdGFnZSA9IG5ldyBQSVhJLkNvbnRhaW5lcigpO1xuICAgIHZhciBqb2luTGluZXMgPSBuZXcgUElYSS5HcmFwaGljcygpO1xuICAgIGpvaW5MaW5lcy5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLkFERDtcbiAgICB2YXIgY291bnRlciA9ICQoJzxzcGFuIGNsYXNzPVwiY291bnRlclwiPjwvc3Bhbj4nKS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KTtcblxuICAgIHZhciBiYWNrZ3JvdW5kVGV4dHVyZSA9IG5ldyBDYW52YXNUZXh0dXJlKGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgdmFyIGdyZCA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudCh3aWR0aCAvIDIsIGhlaWdodCAvIDIsIDEsIHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgaGVpZ2h0KTtcbiAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgwLCAncmdiKDIyLDgsNDkpJyk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMC40LCAncmdiKDIyLDgsNDkpJyk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMC42LCAncmdiKDEyLDcsMjQpJyk7XG4gICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMSwgJ3JnYigwLDAsMCknKTtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGdyZDtcbiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgIH0pO1xuXG4gICAgdmFyIHJlbmRlclRleHR1cmUgPSBuZXcgUElYSS5SZW5kZXJUZXh0dXJlKHJlbmRlcmVyLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB2YXIgcmVuZGVyVGV4dHVyZTIgPSBuZXcgUElYSS5SZW5kZXJUZXh0dXJlKHJlbmRlcmVyLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgIHZhciBiYWNrZ3JvdW5kU3ByaXRlID0gbmV3IFBJWEkuU3ByaXRlKGJhY2tncm91bmRUZXh0dXJlKTtcbiAgICB2YXIgc2hhZG93U3ByaXRlID0gbmV3IFBJWEkuU3ByaXRlKHJlbmRlclRleHR1cmUpO1xuICAgIHZhciBjb252b2x1dGlvbkZpbHRlciA9IG5ldyBQSVhJLmZpbHRlcnMuQ29udm9sdXRpb25GaWx0ZXIoW1xuICAgICAgICAwLjEsIDAuNCwgMC4xLFxuICAgICAgICAwLjQsIDAuMCwgMC40LFxuICAgICAgICAwLjEsIDAuNCwgMC4xXG4gICAgXSwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICAvL3NoYWRvd1Nwcml0ZS5hbHBoYSA9IDAuNDk7XG4gICAgc2hhZG93U3ByaXRlLmFscGhhID0gMC40MTtcbiAgICAvL3NoYWRvd1Nwcml0ZS5ibGVuZE1vZGUgPSBQSVhJLkJMRU5EX01PREVTLlNPRlRfTElHSFQ7XG5cbiAgICAvKiB2YXIgZmlsdGVyID0gbmV3IFBJWEkuZmlsdGVycy5Db252b2x1dGlvbkZpbHRlcihbXG4gICAgIDAuMSwwLjEsMC4xLFxuICAgICAwLjEsMC4yLDAuMSxcbiAgICAgMC4xLDAuMSwwLjFcbiAgICAgXSx3aWR0aCxoZWlnaHQpOyovXG4gICAgc2hhZG93U3ByaXRlLmZpbHRlcnMgPSBbY29udm9sdXRpb25GaWx0ZXJdO1xuICAgIHN0YWdlLmFkZENoaWxkKGJhY2tncm91bmRTcHJpdGUpO1xuXG4gICAgdmFyIGxpbmVDb3VudCxqb2luQ291bnQ7XG4gICAgdmFyIHRocmVzaG9sZFNxdWFyZSA9IE1hdGgucG93KHRocmVzaG9sZCwgMik7XG4gICAgdmFyIG1vdXNlVGhyZXNob2xkID0gdGhyZXNob2xkICogMTA7XG4gICAgdmFyIG1vdXNlVGhyZXNob2xkU3F1YXJlID0gdGhyZXNob2xkU3F1YXJlICogMTA7XG4gICAgdmFyICRzY29wZSA9IHtcbiAgICAgICAgbWF4U3BlZWQ6IDEwLFxuICAgICAgICBtb3VzZTogbmV3IFZlY3RvcjIoKSxcbiAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgc3RhZ2U6IHN0YWdlLFxuICAgICAgICBqb2luTGluZXM6IGpvaW5MaW5lcyxcbiAgICAgICAgbm9kZXM6IFtdLFxuICAgICAgICBkZWFkTm9kZXM6IFtdLFxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heFN0YXJzOyB4KyspIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkU3RhcihuZXcgVmVjdG9yMihNYXRoLnJhbmRvbSgpICogd2lkdGgsIE1hdGgucmFuZG9tKCkgKiBoZWlnaHQpLCAkc2NvcGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHNjb3BlLm1vdXNlLmFjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICBzdGFnZS5hZGRDaGlsZChqb2luTGluZXMpO1xuICAgICAgICAgICAgc3RhZ2UuYWRkQ2hpbGQoc2hhZG93U3ByaXRlKTtcbiAgICAgICAgfSxcbiAgICAgICAgYWRkU3RhcjogZnVuY3Rpb24gKHBvc2l0aW9uKSB7XG4gICAgICAgICAgICB2YXIgcCA9IG5ldyBQYXJ0aWNsZShwb3NpdGlvbiwgJHNjb3BlKTtcbiAgICAgICAgICAgICRzY29wZS5hZGROb2RlKHApO1xuICAgICAgICAgICAgaWYgKCRzY29wZS5ub2Rlcy5sZW5ndGggPiBtYXhTdGFycykge1xuICAgICAgICAgICAgICAgICRzY29wZS5raWxsTm9kZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBhZGROb2RlOiBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgJHNjb3BlLm5vZGVzLnB1c2gobm9kZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGNsZWFyOmZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkc2NvcGUubm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZSwgaSkge1xuICAgICAgICAgICAgICAgIHN0YWdlLnJlbW92ZUNoaWxkKG5vZGUuc3ByaXRlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJHNjb3BlLm5vZGVzID0gW107XG4gICAgICAgIH0sXG4gICAgICAgIGtpbGxOb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGVhZCA9ICRzY29wZS5ub2Rlcy5zaGlmdCgpO1xuICAgICAgICAgICAgJHNjb3BlLmRlYWROb2Rlcy5wdXNoKGRlYWQpO1xuICAgICAgICAgICAgZGVhZC5kaWUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgdGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGRpc3RhbmNlO1xuICAgICAgICAgICAgY291bnRlci5odG1sKCRzY29wZS5ub2Rlcy5sZW5ndGggKyAkc2NvcGUuZGVhZE5vZGVzLmxlbmd0aCk7XG4gICAgICAgICAgICAvL0N1bGwgdG9vIG1hbnkgc3RhcnNcbiAgICAgICAgICAgIGlmICgkc2NvcGUubm9kZXMubGVuZ3RoID4gbWF4U3RhcnMpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUua2lsbE5vZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGluZUNvdW50ID0gMDtcbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgkc2NvcGUudGljayk7XG4gICAgICAgICAgICBqb2luTGluZXMuY2xlYXIoKTtcbiAgICAgICAgICAgICRzY29wZS5ub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlLCBpKSB7XG4gICAgICAgICAgICAgICAgLy9QYXJ0aWNsZXNcbiAgICAgICAgICAgICAgICBub2RlLnRpY2soKTtcbiAgICAgICAgICAgICAgICBpZiAobGluZUNvdW50IDwgbWF4TGluZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgam9pbkNvdW50PTA7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5ub2Rlcy5zbGljZShpKS5mb3JFYWNoKGZ1bmN0aW9uIChqb2luTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmVDb3VudCA+IG1heExpbmVzIHx8IGpvaW5Db3VudCA+IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQyID0gam9pbk5vZGUucG9zaXRpb24uZGlzdGFuY2VTcXVhcmUobm9kZS5wb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZDIgPCB0aHJlc2hvbGRTcXVhcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2luQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IE1hdGguc3FydChkMik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhID0gKCgodGhyZXNob2xkIC0gZGlzdGFuY2UpIC8gdGhyZXNob2xkKSAqIDAuNCkgKyAoTWF0aC5yYW5kb20oKSAqIDAuMDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5saW5lU3R5bGUoYWxwaGEgKiAobm9kZS5yYWRpdXMgKyBqb2luTm9kZS5yYWRpdXMpICogMywgMHgwMGRiZmYsIGFscGhhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubW92ZVRvKG5vZGUucG9zaXRpb24ueCwgbm9kZS5wb3NpdGlvbi55KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubGluZVRvKGpvaW5Ob2RlLnBvc2l0aW9uLngsIGpvaW5Ob2RlLnBvc2l0aW9uLnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvL01vdXNlIGFjdGl2ZVxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUubW91c2UuYWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtRGlzdCA9IG5vZGUucG9zaXRpb24uZGlzdGFuY2VTcXVhcmUoJHNjb3BlLm1vdXNlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1EaXN0IDwgbW91c2VUaHJlc2hvbGRTcXVhcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gTWF0aC5zcXJ0KG1EaXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbHBoYSA9ICgoKG1vdXNlVGhyZXNob2xkIC0gZGlzdGFuY2UpIC8gbW91c2VUaHJlc2hvbGQpICogMC40KSArIChNYXRoLnJhbmRvbSgpICogMC4wNSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubGluZVN0eWxlKDEsIDB4MDBkYmZmLCBhbHBoYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luTGluZXMubW92ZVRvKG5vZGUucG9zaXRpb24ueCwgbm9kZS5wb3NpdGlvbi55KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5MaW5lcy5saW5lVG8oJHNjb3BlLm1vdXNlLngsICRzY29wZS5tb3VzZS55KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy9EcmF3IG91ciBkZWFkbm9kZXMgc2VwYXJhdGVseSAodGhleSBmYWRlIG91dCBidXQgc2hvdWxkbid0IGhhdmUgbGluZXMpXG4gICAgICAgICAgICAkc2NvcGUuZGVhZE5vZGVzLmZvckVhY2goZnVuY3Rpb24obm9kZSxpKXtcbiAgICAgICAgICAgICAgICBub2RlLnRpY2soKTtcbiAgICAgICAgICAgICAgICBpZihub2RlLnN0YXRlID09IFwiREVBRFwiKXtcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2UucmVtb3ZlQ2hpbGQobm9kZS5zcHJpdGUpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGVhZE5vZGVzLnNwbGljZSgkc2NvcGUuZGVhZE5vZGVzLmluZGV4T2Yobm9kZSksIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvL1JlbmRlciBzdGFycyB0byB0ZXh0dXJlLCBidXQgbW92ZSBpdCBvZmZzY3JlZW4gKGZvciBuZXh0IGZyYW1lKVxuICAgICAgICAgICAgYmFja2dyb3VuZFNwcml0ZS5hbHBoYSA9IDA7XG4gICAgICAgICAgICBqb2luTGluZXMuYWxwaGEgPSAwLjE7XG4gICAgICAgICAgICByZW5kZXJUZXh0dXJlMi5yZW5kZXIoJHNjb3BlLnN0YWdlLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgIGpvaW5MaW5lcy5hbHBoYSA9IDE7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kU3ByaXRlLmFscGhhID0gMTtcblxuICAgICAgICAgICAgLy9CcmluZyBwcmV2aW91cyBmcmFtZXMgc3RhcnMgb25zY3JlZW4gZm9yIGdsb3dzXG4gICAgICAgICAgICB2YXIgdGVtcCA9IHJlbmRlclRleHR1cmU7XG4gICAgICAgICAgICByZW5kZXJUZXh0dXJlID0gcmVuZGVyVGV4dHVyZTI7XG4gICAgICAgICAgICByZW5kZXJUZXh0dXJlMiA9IHRlbXA7XG4gICAgICAgICAgICBzaGFkb3dTcHJpdGUudGV4dHVyZSA9IHJlbmRlclRleHR1cmU7XG5cbiAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlcigkc2NvcGUuc3RhZ2UpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAkc2NvcGUuaW5pdCgpO1xuICAgIHJldHVybiAkc2NvcGU7XG59OyIsIi8qKlxuICpcbiAqIEBhdXRob3IgQWRhbSBCZW5zb24gPGFkYW1AcHJlY2FyaW91c3BhbnRoZXIubmV0PlxuICovXG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7aW50fSBbeF1cbiAqIEBwYXJhbSB7aW50fSBbeV1cbiAqIEBjb25zdHJ1Y3RvclxuICovXG52YXIgVmVjdG9yMiA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIGlmICgheCl4ID0gMDtcbiAgICBpZiAoIXkpeSA9IDA7XG4gICAgdmFyICRzY29wZSA9IHtcbiAgICAgICAgeDogeCxcbiAgICAgICAgeTogeSxcbiAgICAgICAgYWRkOiBmdW5jdGlvbiAodmVjdG9yLCBzY2FsZSkge1xuICAgICAgICAgICAgc2NhbGUgPSBzY2FsZSB8fCAxO1xuICAgICAgICAgICAgJHNjb3BlLnggKz0gdmVjdG9yLnggKiBzY2FsZTtcbiAgICAgICAgICAgICRzY29wZS55ICs9IHZlY3Rvci55ICogc2NhbGU7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgICAgICAkc2NvcGUueCA9IHg7XG4gICAgICAgICAgICAkc2NvcGUueSA9IHk7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBzY2FsZTogZnVuY3Rpb24gKG11bHRpcGxpZXIpIHtcbiAgICAgICAgICAgICRzY29wZS54ICo9IG11bHRpcGxpZXI7XG4gICAgICAgICAgICAkc2NvcGUueSAqPSBtdWx0aXBsaWVyO1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZTtcbiAgICAgICAgfSxcbiAgICAgICAgY2xhbXA6IGZ1bmN0aW9uIChtaW4sIG1heCkge1xuICAgICAgICAgICAgJHNjb3BlLnggPSBNYXRoLm1pbihNYXRoLm1heCgkc2NvcGUueCwgbWluKSwgbWF4KTtcbiAgICAgICAgICAgICRzY29wZS55ID0gTWF0aC5taW4oTWF0aC5tYXgoJHNjb3BlLnksIG1pbiksIG1heCk7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBjbGFtcEFiczogZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgJHNjb3BlLmNsYW1wKC12YWwsIHZhbCk7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlO1xuICAgICAgICB9LFxuICAgICAgICBkaXN0YW5jZTogZnVuY3Rpb24gKHZlY3Rvcikge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguc3FydCgkc2NvcGUuZGlzdGFuY2VTcXVhcmUodmVjdG9yKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRpc3RhbmNlU3F1YXJlOiBmdW5jdGlvbiAodmVjdG9yKSB7XG4gICAgICAgICAgICB2YXIgZFggPSBNYXRoLnBvdyh2ZWN0b3IueCAtICRzY29wZS54LCAyKTtcbiAgICAgICAgICAgIHZhciBkWSA9IE1hdGgucG93KHZlY3Rvci55IC0gJHNjb3BlLnksIDIpO1xuICAgICAgICAgICAgcmV0dXJuIGRYICsgZFk7XG4gICAgICAgIH1cblxuICAgIH07XG4gICAgcmV0dXJuICRzY29wZTtcbn07Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
